/*!
* flagwind-map v1.0.22 
* 
* Authors:
*      chendebao <hbchendb1985@gmail.com>
* 
* Licensed under the MIT License.
* Copyright (C) 2018-2018 Flagwind Inc. All rights reserved. 
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.flagwind={})}(this,function(exports){"use strict";var __extends=this&&this.__extends||(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),c,__assign=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},flagwind,q,r,flagwind,V,W,X,flagwind,Ba,Ca,flagwind,flagwind,flagwind,flagwind,jf,kf,flagwind,yf,zf,flagwind,rg,sg,flagwind,gh,hh,flagwind,oh,ph,flagwind,Ph,Qh,flagwind,ti,ui,flagwind,flagwind,flagwind,flagwind,flagwind,zo,Ao,flagwind,flagwind,tq,uq,flagwind,Cq,Dq,flagwind,flagwind,Br,Cr,flagwind,flagwind,Kr,Lr,flagwind,js,flagwind,flagwind,flagwind,flagwind,flagwind,Mt,Nt,flagwind,Ew,Fw,flagwind,Jw,Kw,flagwind,Ow,Pw,flagwind,qx,rx,flagwind,ay,by,flagwind,hy,iy,flagwind,ny,oy,flagwind,ty,uy,flagwind,yy,zy,flagwind,Dy,Ey,flagwind,Iy,Jy,flagwind,Sy,Ty,flagwind,Xy,Yy,flagwind,vz,wz,flagwind,Tz,Uz,flagwind,gA,hA,flagwind,uA,vA,flagwind,flagwind,LB,MB,flagwind,VB,WB,flagwind,FC,GC,flagwind,nD,oD,flagwind,PD,QD,flagwind,ZD,$D,flagwind,jE,kE,flagwind,flagwind,flagwind,uG,vG,flagwind,BG,CG,flagwind,RG,flagwind,TG,UG,flagwind;q=flagwind||(flagwind={}),r=function(){function t(){this.rawData=[]}return t.prototype.clientSideClustering=function(t,e,n,i){console.time("fake-server-side-cluster");for(var o,r,s,a,l,p,h=i.extent,c=Math.round(i.width/t),u=Math.round(i.height/t),d=(h.xmax-h.xmin)/c,y=(h.ymax-h.ymin)/u,f=this.rawData.length,g=[],m=0;m<c;m++){r=(o=h.xmin+d*m)+d;for(var v=0;v<u;v++){a=(s=h.ymin+y*v)+y;var w=new esri.geometry.Extent({xmin:o,xmax:r,ymin:s,ymax:a});w.setSpatialReference(new esri.SpatialReference({wkid:4326})),g.push({extent:w,clusterCount:0,subTypeCounts:[],singles:[],points:[]})}}for(m=0;m<f;m++)if(p=this.rawData[m],!((l=esri.geometry.lngLatToXY(p.x,p.y))[0]<h.xmin||l[0]>h.xmax||l[1]<h.ymin||l[1]>h.ymax)){v=0;for(var b=g.length;v<b;v++){var M=g[v];if(!(l[0]<M.extent.xmin||l[0]>M.extent.xmax||l[1]<M.extent.ymin||l[1]>M.extent.ymax)){M.x=0<M.clusterCount?(p.x+M.x*M.clusterCount)/(M.clusterCount+1):p.x,M.y=0<M.clusterCount?(p.y+M.y*M.clusterCount)/(M.clusterCount+1):p.y,n&&M.points.push([p.x,p.y]),M.clusterCount++;for(var L=!1,S=0,_=M.subTypeCounts.length;S<_;S++)if(M.subTypeCounts[S].name===p.facilityType){M.subTypeCounts[S].count++,L=!0;break}L||M.subTypeCounts.push({name:p.facilityType,count:1}),M.singles.push(p)}}}for(var E=[],k=(m=0,g.length);m<k;m++)1===g[m].clusterCount?E.push(g[m].singles[0]):0<g[m].clusterCount&&(g[m].singles.length>e&&(g[m].singles=[]),E.push(g[m]));return console.timeEnd("fake-server-side-cluster"),E},t.prototype.getData=function(){return this.rawData},t.prototype.setData=function(t){this.rawData=t},t}(),q.DataManager=r,V=flagwind||(flagwind={}),W=function(t,e,n,i){this.type=t,this.listener=e,this.scope=n,this.once=i},X=function(){function t(t){this._source=t||this,this._events=new V.Map}return t.prototype.addListener=function(t,e,n,i){if(void 0===n&&(n=this),void 0===i&&(i=!1),!t||!e)throw new V.ArgumentException;var o=this._events.get(t);o||(o=new Array,this._events.set(t,o));for(var r=0,s=o;r<s.length;r++){var a=s[r];if(a.listener===e&&a.scope===n)return}o.push(new W(t,e,n,i))},t.prototype.removeListener=function(t,e,n){if(void 0===n&&(n=this),!t||!e)throw new V.ArgumentException;var i=this._events.get(t);if(i){for(var o=0,r=i.length;o<r;o++){var s=i[o];if(s.listener===e&&s.scope===n){i.splice(o,1);break}}0===i.length&&this._events.delete(t)}},t.prototype.hasListener=function(t){var e=this._events.get(t);return!!e&&0<e.length},t.prototype.dispatchEvent=function(){var t,e=arguments;switch(e.length){case 1:e[0]instanceof V.EventArgs?t=e[0]:V.Type.isString(e[0])&&(t=new V.EventArgs(e[0]));break;case 2:t=new V.EventArgs(e[0],e[1])}t.source=this._source;var n=this._events.get(t.type);if(n&&0!==n.length){for(var i=new Array,o=0,r=n;o<r.length;o++){(s=r[o]).listener.call(s.scope,t),s.once&&i.push(s)}for(;i.length;){var s=i.pop();this.removeListener(s.type,s.listener,s.scope)}}},t}(),V.EventProvider=X,Ba=flagwind||(flagwind={}),Ca=function(i){function t(t,e){var n=i.call(this)||this;return n.id=t,n.title=e,n.isShow=!0,n.id=t,n}return __extends(t,i),Object.defineProperty(t.prototype,"graphics",{get:function(){return this.layer.graphics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this.graphics.map(function(t){return t.attributes})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this.layer?this.graphics.length:0},enumerable:!0,configurable:!0}),t.prototype.appendTo=function(t){this.layer.addToMap(t)},t.prototype.removeLayer=function(t){this.layer.removeFormMap(t)},t.prototype.clear=function(){this.layer.clear()},t.prototype.show=function(){this.isShow=!0,this.layer.show()},t.prototype.hide=function(){this.isShow=!1,this.layer.hide()},t.prototype.getGraphicById=function(t){for(var e=this.graphics,n=0;n<e.length;n++){if(e[n].attributes.id===t)return e[n]}return null},t.prototype.removeGraphicById=function(t){var e=this.getGraphicById(t);null!=e&&this.layer.remove(e)},t.prototype.on=function(t,e,n,i){void 0===n&&(n=this),void 0===i&&(i=!1),this.addListener(t,e,n,i)},t.prototype.off=function(t,e,n){void 0===n&&(n=this),this.removeListener(t,e,n)},t.prototype.add=function(t){this.layer.add(t)},t.prototype.remove=function(t){this.layer.remove(t)},t}(Ba.EventProvider),Ba.FlagwindFeatureLayer=Ca,function(r){r.BUSINESS_LAYER_OPTIONS={onLayerClick:function(t){console.log("onLayerClick")},onMapLoad:function(){console.log("onMapLoad")},onEvent:function(t,e){console.log("onEvent")},onCheckChanged:function(t){console.log("onCheckChanged")},onPositionChanged:function(t,e,n){console.log("onPositionChanged")},onVisibleChanged:function(t){console.log("onVisibleChanged")},changeStandardModel:function(t){return t},getInfoWindowContext:function(t){return{title:"\u8be6\u7ec6\u4fe1\u606f",content:"\u6ca1\u6709\u5b9a\u5236\u8be6\u7ec6\u4fe1\u606f"}},getDataList:function(){return new Promise(function(t,e){t([])})},getLastStatus:function(){return new Promise(function(t,e){t([])})},showInfoWindowCompleted:null,timeout:3e3,autoInit:!0,enableEdit:!0,selectMode:0,showTooltip:!1,showInfoWindow:!1,symbol:null,dataType:"point"};var t=function(o){function t(t,e,n){var i=o.call(this,e,n.title||"\u8bbe\u5907\u56fe\u5c42")||this;return i.flagwindMap=t,i.id=e,i.layerType=r.LayerType.point,i.isLoading=!1,i.options=__assign({},r.BUSINESS_LAYER_OPTIONS,n),i.layer=i.onCreateGraphicsLayer({id:i.id}),i.layerType=n.layerType,i.flagwindMap=t,i.options.autoInit&&i.onInit(),i}return __extends(t,o),Object.defineProperty(t.prototype,"map",{get:function(){return this.flagwindMap.map},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatial",{get:function(){return this.flagwindMap.spatial},enumerable:!0,configurable:!0}),t.prototype.saveGraphicList=function(t){for(var e=0;e<t.length;e++)this.saveGraphicByModel(t[e])},t.prototype.updateGraphicList=function(t){for(var e=0;e<t.length;e++)this.updateGraphicByModel(t[e])},t.prototype.addGraphicList=function(t){for(var e=0;e<t.length;e++){this.getGraphicById(t[e].id)?console.warn("\u5df2\u5b58\u5728id\uff1a"+t[e].id+"\u8981\u7d20\u70b9"):this.addGraphicByModel(t[e])}},t.prototype.saveGraphicByModel=function(t){if((t=this.onChangeStandardModel(t))&&t.id){var e=this.getGraphicById(t.id);return e?this.updateGraphicByModel(t,e):this.addGraphicByModel(t)}},t.prototype.addGraphicByModel=function(t){var e=this.creatGraphicByModel(t);e&&this.add(e)},t.prototype.creatGraphicByModel=function(t){return t=this.onChangeStandardModel(t),this.onValidModel(t)?(void 0===t.selected&&(t.selected=!1),this.onCreatGraphicByModel(t)):(console.warn("\u65e0\u6548\u7684\u8981\u7d20\uff1a"+t),null)},t.prototype.updateGraphicByModel=function(t,e){void 0===e&&(e=null),t=this.onChangeStandardModel(t),this.onValidModel(t)&&(e||(e=this.getGraphicById(t.id)),null!=e&&(t=__assign({},e.attributes,t),this.onUpdateGraphicByModel(t)))},t.prototype.clearSelectStatus=function(){for(var t=this.graphics,e=0;e<t.length;e++)(t[e].attributes.selected||"boolean"!=typeof t[e].attributes.selected)&&this.setSelectStatus(t[e].attributes,!1);this.options.onCheckChanged({target:t?t.map(function(t){return t.attributes}):[],check:!1,selectedItems:this.getSelectedGraphics().map(function(t){return t.attributes})})},t.prototype.setSelectStatusByModels=function(t,e){e&&this.clearSelectStatus();for(var n=0;n<t.length;n++){var i=this.onChangeStandardModel(t[n]),o=this.getGraphicById(i.id);o&&this.setSelectStatus(o.attributes,!0)}this.options.onCheckChanged({target:t,check:!0,selectedItems:this.getSelectedGraphics().map(function(t){return t.attributes})})},t.prototype.getSelectedGraphics=function(){return this.graphics.filter(function(t){return t.attributes&&t.attributes.selected})},t.prototype.setSelectStatus=function(t,e){t.selected=e,this.onUpdateGraphicByModel(t)},t.prototype.getPoint=function(t){return this.flagwindMap.getPoint(t)},t.prototype.formPoint=function(t){return this.flagwindMap.onFormPoint(t)},t.prototype.openInfoWindow=function(t,e,n){var i=this.getGraphicById(t);i?e?this.flagwindMap.onShowInfoWindow({graphic:i,context:e,options:n||{}}):this.showInfoWindow({graphic:i}):console.warn("\u8be5\u6761\u6570\u636e\u4e0d\u5728\u56fe\u5c42\u5185\uff01id:",t)},t.prototype.closeInfoWindow=function(){this.flagwindMap.closeInfoWindow()},t.prototype.gotoCenterById=function(t){var e=this.getGraphicById(t);if(e){var n=this.getPoint(e.attributes);this.flagwindMap.centerAt(n.x,n.y)}else console.trace("-----\u8be5\u6761\u6570\u636e\u4e0d\u5728\u56fe\u5c42\u5185\uff01id:",t)},t.prototype.addToMap=function(){this.onAddLayerBefor(),this.flagwindMap.addFeatureLayer(this),this.onAddLayerAfter()},t.prototype.removeFormMap=function(){this.flagwindMap.removeFeatureLayer(this.id)},t.prototype.showInfoWindow=function(t){var e=this.onGetInfoWindowContext(t.graphic.attributes);this.flagwindMap.onShowInfoWindow({graphic:t.graphic,context:{type:"html",title:e.title,content:e.content},options:{}}),this.options.showInfoWindowCompleted&&this.options.showInfoWindowCompleted(t.graphic.attributes)},t.prototype.showDataList=function(){var e=this;return this.isLoading=!0,this.fireEvent("showDataList",{action:"start"}),this.options.getDataList().then(function(t){e.isLoading=!1,e.saveGraphicList(t),e.fireEvent("showDataList",{action:"end",attributes:t})}).catch(function(t){e.isLoading=!1,console.log("\u52a0\u8f7d\u56fe\u5c42\u6570\u636e\u65f6\u53d1\u751f\u4e86\u9519\u8bef\uff1a",t),e.fireEvent("showDataList",{action:"error",attributes:t})})},t.prototype.start=function(){var t=this;this.timer=setInterval(function(){t.updateStatus()},this.options.timeout||2e4)},t.prototype.stop=function(){this.timer&&clearInterval(this.timer)},t.prototype.updateStatus=function(){var e=this;this.isLoading=!0,this.fireEvent("updateStatus",{action:"start"}),this.options.getLastStatus().then(function(t){e.isLoading=!1,e.saveGraphicList(t),e.fireEvent("updateStatus",{action:"end",attributes:t})}).catch(function(t){e.isLoading=!1,console.log("\u52a0\u8f7d\u5361\u53e3\u72b6\u6001\u65f6\u53d1\u751f\u4e86\u9519\u8bef\uff1a",t),e.fireEvent("updateStatus",{action:"error",attributes:t})})},t.prototype.onGetInfoWindowContext=function(t){return this.options.getInfoWindowContext(t)},t.prototype.onInit=function(){var t=this;this.addToMap(),this.flagwindMap.loaded?this.onLoad():this.flagwindMap.on("onLoad",function(){return t.onLoad()})},t.prototype.onAddLayerBefor=function(){},t.prototype.onAddLayerAfter=function(){},t.prototype.onLoad=function(){try{this.layer._map||(this.layer._map=this.flagwindMap.innerMap),this.registerEvent(),this.onMapLoad()}catch(t){console.error(t)}},t.prototype.onMapLoad=function(){this.options.onMapLoad()},t.prototype.registerEvent=function(){var e=this;this.on("onClick",function(t){e.onLayerClick(e,t.data)}),this.on("onMouseOver",function(t){e.options.showTooltip&&e.flagwindMap.onShowTooltip(t.data.graphic),e.fireEvent("onMouseOver",t.data)}),this.on("onMouseOut",function(t){e.options.showTooltip&&e.flagwindMap.onHideTooltip(),e.fireEvent("onMouseOut",t.data)})},t.prototype.onLayerClick=function(t,e){if(t.options.onLayerClick&&t.options.onLayerClick(e),t.options.showInfoWindow&&(e.graphic.attributes.eventName="",t.showInfoWindow(e)),t.options.selectMode){if(t.options.selectMode===r.SelectMode.single){var n=e.graphic.attributes;e.graphic.attributes.selected?t.setSelectStatus(n,!1):t.setSelectStatus(n,!0)}else{t.clearSelectStatus();n=e.graphic.attributes;t.setSelectStatus(n,!0)}t.options.onCheckChanged({target:[e.graphic.attributes],check:e.graphic.attributes.selected,selectedItems:t.getSelectedGraphics()})}},t.prototype.fireEvent=function(t,e){this.options.onEvent(t,e)},t.prototype.onValidModel=function(t){switch(this.layerType){case r.LayerType.point:return t.id&&t.longitude&&t.latitude;case r.LayerType.polyline:return t.id&&t.polyline;case r.LayerType.polygon:return t.id&&t.polygon;default:return t.id&&t.longitude&&t.latitude}},t.prototype.onChangeStandardModel=function(t){return this.options.changeStandardModel(t)},t}(r.FlagwindFeatureLayer);r.FlagwindBusinessLayer=t}(flagwind||(flagwind={})),function(l){l.ESRI_CLUSTER_LAYER_OPTIONS={onEvent:function(t,e){switch(t){case"onMouseOver":e.graphic.getNode()&&e.graphic.getNode().classList.add("marker-scale");break;case"onMouseOut":e.graphic.getNode()&&e.graphic.getNode().classList.remove("marker-scale")}},symbol:{width:32,height:32},enableCluster:!0,cluster:{font:{color:"#FF0000",outline:null,size:6},singleFlareAtCount:10,flareShowMode:"mouse",preClustered:!1,ratio:75,areaDisplay:!1,levels:{xl:{start:1001,end:1/0,size:32,color:{line:[200,52,59,.8],fill:[250,65,74,.8]}},lg:{start:151,end:1e3,size:28,color:{line:[41,163,41,.8],fill:[51,204,51,.8]}},md:{start:20,end:150,size:24,color:{line:[82,163,204,.8],fill:[102,204,255,.8]}},sm:{start:0,end:19,size:22,color:{line:[230,184,92,.8],fill:[255,204,102,.8]}}},clusteringBegin:function(){console.log("clustering begin")},clusteringComplete:function(){console.log("clustering complete")}},layerType:"point"};var t=function(o){function t(t,e,n){var i=o.call(this,t,e,__assign({},l.ESRI_CLUSTER_LAYER_OPTIONS,n))||this;return i.options.enableCluster&&(i.dataManager=new l.DataManager),i}return __extends(t,o),t.prototype.onCreateGraphicsLayer=function(t){var e,n=this;return(e=this.enableCluster?this.createClusterLayer(this.options.cluster):new esri.layers.GraphicsLayer(t)).on("mouse-over",function(t){return n.dispatchEvent("onMouseOver",t)}),e.on("mouse-out",function(t){return n.dispatchEvent("onMouseOut",t)}),e.on("mouse-up",function(t){return n.dispatchEvent("onMouseUp",t)}),e.on("mouse-down",function(t){return n.dispatchEvent("onMouseDown",t)}),e.on("click",function(t){return n.dispatchEvent("onClick",t)}),e.on("dbl-click",function(t){return n.dispatchEvent("onDblClick",t)}),e.addToMap=function(t){t.addLayer(this)},e.removeFormMap=function(t){try{this._map||(this._map=t),t.removeLayer(this)}catch(t){console.warn(t)}},e},t.prototype.createClusterLayer=function(t){var e=new esri.layers.ClusterLayer(__assign({id:this.id,spatialReference:this.flagwindMap.spatial,xPropertyName:"longitude",yPropertyName:"latitude",subTypeFlareProperty:"kind",singleFlareTooltipProperty:""},t)),n=(new esri.symbol.SimpleMarkerSymbol).setSize(6).setColor(t.font.color).setOutline(t.font.outline),i=new esri.renderer.ClassBreaksRenderer(n,"clusterCount"),o=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,t.levels.xl.size,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color(t.levels.xl.color.line),1),new dojo.Color(t.levels.xl.color.fill)),r=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,t.levels.lg.size,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color(t.levels.lg.color.line),1),new dojo.Color(t.levels.lg.color.fill)),s=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,t.levels.md.size,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color(t.levels.md.color.line),1),new dojo.Color(t.levels.md.color.fill)),a=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,t.levels.sm.size,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color(t.levels.sm.color.line),1),new dojo.Color(t.levels.sm.color.fill));if(i.addBreak(t.levels.sm.start,t.levels.sm.end,a),i.addBreak(t.levels.md.start,t.levels.md.end,s),i.addBreak(t.levels.lg.start,t.levels.lg.end,r),i.addBreak(t.levels.xl.start,t.levels.xl.end,o),t.areaDisplay){var l=(new esri.symbol.SimpleFillSymbol).setStyle(esri.symbol.SimpleFillSymbol.STYLE_SOLID).setColor(new dojo.Color([0,0,0,.2])).setOutline(new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([0,0,0,.3]),1)),p=new esri.renderer.ClassBreaksRenderer(l,"clusterCount"),h=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color(t.levels.xl.color.line),1),new dojo.Color(t.levels.xl.color.fill)),c=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color(t.levels.lg.color.line),1),new dojo.Color(t.levels.lg.color.fill)),u=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color(t.levels.md.color.line),1),new dojo.Color(t.levels.md.color.fill)),d=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color(t.levels.sm.color.line),1),new dojo.Color(t.levels.sm.color.fill));p.addBreak(t.levels.sm.start,t.levels.sm.end,d),p.addBreak(t.levels.md.start,t.levels.md.end,u),p.addBreak(t.levels.lg.start,t.levels.lg.end,c),p.addBreak(t.levels.xl.start,t.levels.xl.end,h),e.setRenderer(i,p)}else e.setRenderer(i);return e.allData=[],e._graphics=[],e},t.prototype.addClusters=function(){var t=this.graphics.map(function(t){return t.attributes});if(this.layer.clear(),this.dataManager.setData(t),this.options.cluster.preClustered)this.getPreClusteredGraphics();else{var e=this.dataManager.getData();this.layer.addData(e)}},t.prototype.getPreClusteredGraphics=function(){var t=this.options,e=t.displaySingleFlaresAtCount,n=t.ratio,i=this.dataManager.clientSideClustering(n,e,t.areaDisplay,this.flagwindMap.map);this.layer.addPreClusteredData(i)},t.prototype.getImageUrl=function(t){var e=this.options.symbol.imageUrl;if("string"==typeof e&&e){var n="imageUrl"+(t.status||"")+(t.selected?"checked":""),i=this.options[n]||this.options.symbol[n]||e,o=i.lastIndexOf("."),r=i.substring(0,o),s=i.substring(o+1);return t.selected?r+"_checked."+s:r+"."+s}var a=t.status;null==a&&(a="");n="image"+a+(t.selected?"checked":"");return this.options[n]||this.options.symbol[n]||this.options.image},Object.defineProperty(t.prototype,"enableCluster",{get:function(){return this.options.enableCluster},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"singles",{get:function(){return this.layer.singles||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clusters",{get:function(){return this.layer.clusters||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return this.enableCluster?this.layer._graphics:this.layer.graphics},enumerable:!0,configurable:!0}),t.prototype.saveGraphicList=function(t){for(var e=0;e<t.length;e++)this.saveGraphicByModel(t[e]);this.enableCluster&&this.addClusters()},t.prototype.addGraphicList=function(t){for(var e=0;e<t.length;e++)this.addGraphicByModel(t[e]);this.enableCluster&&this.addClusters()},t.prototype.updateGraphicList=function(t){for(var e=0;e<t.length;e++)this.updateGraphicByModel(t[e]);this.enableCluster&&this.addClusters()},t.prototype.onCreatGraphicByModel=function(t){var e=this.getImageUrl(t),n=this.getPoint(t),i=this.options.symbol.width,o=this.options.symbol.height,r=new esri.symbol.PictureMarkerSymbol(e,i,o),s=__assign({},t,{__type:this.layerType});return new esri.Graphic(n,r,s)},t.prototype.onUpdateGraphicByModel=function(t){var e=this.getImageUrl(t),n=this.getPoint(t),i=this.options.symbol.width,o=this.options.symbol.height,r=new esri.symbol.PictureMarkerSymbol(e,i,o),s=this.getGraphicById(t.id),a=s.geometry;s.setGeometry(n),s.setSymbol(r),s.attributes=__assign({},s.attributes,t,{__type:this.layerType}),s.draw(),l.MapUtils.isEqualPoint(n,a)||this.options.onPositionChanged(n,a,s.attributes)},t.prototype.add=function(t){this.enableCluster?this.layer._graphics.push(t):this.layer.add(t)},t.prototype.remove=function(t){if(this.enableCluster){var e=this.layer._graphics.indexOf(t);0<=e&&this.layer._graphics.splice(e,1)}else this.layer.remove(t)},t}(l.FlagwindBusinessLayer);l.EsriClusterLayer=t}(flagwind||(flagwind={})),function(r){var t;(t=r.MapType||(r.MapType={})).arcgis="arcgis",t.minemap="minemap",r.MAP_OPTIONS={onMapLoad:function(){console.log("onMapLoad")},onZoomStart:function(t){console.log("onZoomStart")},onZoom:function(t){console.log("onMapZoom")},onZoomEnd:function(t){console.log("onZoomEnd")},onMapClick:function(t){console.log("onMapClick")},formPoint:function(t,e){return{lat:t,lon:e}},toPoint:function(t,e){return{lat:t,lon:e}}};var e=function(o){function t(t,e,n){var i=o.call(this)||this;return i.mapSetting=t,i.mapElement=e,i.featureLayers=[],i.baseLayers=[],i.loaded=!1,i.options=__assign({},r.MAP_OPTIONS,n),i}return __extends(t,o),t.prototype.onFormPoint=function(t){var e={lat:t.y,lon:t.x};return t.latitude&&t.longitude&&(e.lon=t.longitude,e.lat=t.latitude),this.spatial.wkid!==this.mapSetting.wkidFromApp&&(e=3857===this.spatial.wkid&&4326===this.mapSetting.wkidFromApp?r.MapUtils.mercator2lonlat(e.lat,e.lon):102100===this.spatial.wkid&&4326===this.mapSetting.wkidFromApp?r.MapUtils.mercator_decrypt(e.lat,e.lon):4326===this.spatial.wkid&&3857===this.mapSetting.wkidFromApp?r.MapUtils.mercator_decrypt(e.lat,e.lon):4326===this.spatial.wkid&&3889===this.mapSetting.wkidFromApp?r.MapUtils.gcj_decrypt_exact(e.lat,e.lon):this.options.formPoint(e.lat,e.lon)),{longitude:parseFloat(e.lon.toFixed(8)),latitude:parseFloat(e.lat.toFixed(8))}},t.prototype.onToPoint=function(t){var e={lat:t.latitude||t.lat,lon:t.longitude||t.lon};return this.validGeometryModel(t)||(e.lon=t.x||e.lon,e.lat=t.y||e.lat),this.spatial.wkid!==this.mapSetting.wkidFromApp&&(e=102100===this.spatial.wkid&&4326===this.mapSetting.wkidFromApp?r.MapUtils.mercator_encrypt(e.lat,e.lon):4326===this.spatial.wkid&&3857===this.mapSetting.wkidFromApp?r.MapUtils.mercator_encrypt(e.lat,e.lon):4326===this.spatial.wkid&&3589===this.mapSetting.wkidFromApp?r.MapUtils.gcj_decrypt_exact(e.lat,e.lon):this.options.toPoint(e.lat,e.lon)),this.onCreatePoint({x:e.lon,y:e.lat,spatial:this.spatial})},t.prototype.validGeometryModel=function(t){return r.MapUtils.validGeometryModel(t)},t.prototype.on=function(t,e,n,i){void 0===n&&(n=this),void 0===i&&(i=!1),this.addListener(t,e,n,i)},t.prototype.off=function(t,e,n){void 0===n&&(n=this),this.removeListener(t,e,n)},Object.defineProperty(t.prototype,"map",{get:function(){return this.innerMap},enumerable:!0,configurable:!0}),t.prototype.closeInfoWindow=function(){this.onCloseInfoWindow()},t.prototype.centerAt=function(){var t,e=arguments;switch(e.length){case 0:this.mapSetting.center&&2===this.mapSetting.center.length&&(t=this.getPoint({x:this.mapSetting.center[0],y:this.mapSetting.center[1]}));break;case 1:case 2:t=this.onCreatePoint({x:e[0],y:e[1],spatial:this.spatial})}return t?this.onCenterAt(t):new Promise(function(t,e){t()})},t.prototype.setZoom=function(t){return this.onZoom(t)},t.prototype.getPoint=function(t){return this.onToPoint(t)},t.prototype.getBaseLayerById=function(e){var t=this.baseLayers.filter(function(t){return t.id===e});return t&&0<t.length?t[0]:null},t.prototype.showBaseLayers=function(){this.baseLayers&&this.baseLayers.forEach(function(t){return t.show()})},t.prototype.hideBaseLayers=function(){this.baseLayers&&this.baseLayers.forEach(function(t){return t.hide()})},t.prototype.showBaseLayer=function(t){var e=this.getBaseLayerById(t);return!!e&&(e.show(),!0)},t.prototype.hideBaseLayer=function(t){var e=this.getBaseLayerById(t);return!!e&&(e.hide(),!0)},t.prototype.destroy=function(){this.onDestroy()},t.prototype.getFeatureLayerById=function(e){var t=this.featureLayers.filter(function(t){return t.id===e});return null!=t&&0<t.length?t[0]:null},t.prototype.addFeatureLayer=function(t){if(this.getFeatureLayerById(t.id))throw Error("\u56fe\u5c42"+t.id+"\u5df2\u5b58\u5728");this.featureLayers.push(t),t.appendTo(this.innerMap)},t.prototype.removeFeatureLayer=function(t){var e=this.getFeatureLayerById(t);if(e){e.removeLayer(this.innerMap);var n=this.featureLayers.indexOf(e);return this.featureLayers.splice(n,1),!0}return!1},t.prototype.showFeatureLayer=function(t){var e=this.getFeatureLayerById(t);return!!e&&(e.show(),!0)},t.prototype.hideFeatureLayer=function(t){var e=this.getFeatureLayerById(t);return!!e&&(e.hide(),!0)},t.prototype.onInit=function(){var n=this;this.onCreateMap(),this.onCreateBaseLayers(),this.on("onLoad",function(){try{n.loaded=!0,n.centerAt(),n.onMapLoad()}catch(t){console.error(t)}});for(var t=Object.keys(this.options).filter(function(t){return 0<=t.indexOf("on")}),e=function(e){return"onMapClick"===e?"continue":"onMapLoad"===e?"continue":void(i.options[e]&&i.on(e,function(t){n.options[e](t.data)}))},i=this,o=0,r=t;o<r.length;o++){e(r[o])}this.on("onClick",function(t){n.options.onMapClick(t)})},t.prototype.onMapLoad=function(){this.options.onMapLoad&&this.options.onMapLoad()},t}(r.EventProvider);r.FlagwindMap=e}(flagwind||(flagwind={})),jf=flagwind||(flagwind={}),kf=function(){function t(t){this.flagwindMap=t,this.enabled=!1}return t.prototype.startup=function(e){var n=this,t=e.menus;this.menu=new dijit.Menu({onOpen:function(t){n.point=n.getMapPointFromMenuPosition(t,n.flagwindMap.innerMap)}});for(var i=0;i<t.length;i++)this.menu.addChild(new dijit.MenuItem({label:t[i],onClick:function(t){e.onClick(this.label)}}));this.menu.startup()},t.prototype.enable=function(){this.enabled?console.warn("\u5df2\u7ecf\u5f00\u542f\u5feb\u6377\u83dc\u5355"):(this.enabled=!0,this.menu.bindDomNode(this.flagwindMap.innerMap.container))},t.prototype.disable=function(){this.enabled=!1,this.menu.unBindDomNode(this.flagwindMap.innerMap.container)},t.prototype.getMapPointFromMenuPosition=function(t,e){var n=t.x,i=t.y;switch(t.corner){case"TR":n+=t.w;break;case"BL":i+=t.h;break;case"BR":n+=t.w,i+=t.h}var o=new esri.geometry.Point(n-e.position.x,i-e.position.y);return e.toMap(o)},t}(),jf.EsriContextMenu=kf,yf=flagwind||(flagwind={}),zf=function(o){function t(t,e){var n=o.call(this,"edit_"+t.id,"\u7f16\u8f91\u56fe\u5c42")||this;n.graphic=null,n.originInfo={},n.options=__assign({},yf.EDIT_LAYER_OPTIONS,e),n.layer=n.onCreateGraphicsLayer({id:n.id}),n.businessLayer=t;var i=n.businessLayer.options.getInfoWindowContext;return n.businessLayer.options.getInfoWindowContext=function(t){var e=i(t);return e.content+="<a key='"+t.id+"' id='edit_point_"+t.id+"' class='button-edit-point'>\u66f4\u65b0\u5750\u6807</a>",e},n.businessLayer.options.showInfoWindowCompleted=function(t){dojo.connect(dojo.byId("edit_point_"+t.id),"onclick",function(t){var e=t.target.attributes.key.value;n.activateEdit(e)})},n.flagwindMap=t.flagwindMap,n.editObj=new esri.toolbars.Edit(n.flagwindMap.innerMap),n.flagwindMap.addFeatureLayer(n),n.flagwindMap.innerMap.loaded?n.onLoad():n.flagwindMap.innerMap.on("load",function(){n.onLoad()}),n}return __extends(t,o),t.prototype.activateEdit=function(t){var e=this.businessLayer.getGraphicById(t);if(e){this.businessLayer.hide(),this.show();var n=this.businessLayer.creatGraphicByModel(e.attributes);this.layer.add(n),n.attributes.eventName="start";var i=esri.toolbars.Edit.MOVE;this.editObj.activate(i,n,null),this.graphic=n,this.originInfo=n.attributes,this.showInfoWindow()}else console.log("\u65e0\u6548\u7684\u4ee3\u7801\uff1a"+t)},t.prototype.cancelEdit=function(t){this.editObj.deactivate(),this.clear(),this.hide(),this.flagwindMap.innerMap.infoWindow.hide(),this.businessLayer.show();var e=this.businessLayer.getGraphicById(t);e.attributes.eventName="delete",this.businessLayer.showInfoWindow({graphic:e})},t.prototype.onLoad=function(){this.layer._map||(this.layer._map=this.flagwindMap.innerMap);try{this.registerEvent()}catch(t){console.error(t)}},Object.defineProperty(t.prototype,"map",{get:function(){return this.flagwindMap.map},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatial",{get:function(){return this.flagwindMap.spatial},enumerable:!0,configurable:!0}),t.prototype.onCreateGraphicsLayer=function(t){var e=new esri.layers.GraphicsLayer(t);return e.addToMap=function(t){t.addLayer(this)},e.removeFormMap=function(t){t.removeLayer(this)},e},t.prototype.onChanged=function(t,e){return this.options.onEditInfo(t,e)},t.prototype.showInfoWindow=function(){var n=this,t=this.businessLayer.title;this.map.infoWindow.setTitle(t);var e="";e='<div><span class=\'opertate-tooltip\'>\u64cd\u4f5c\u63d0\u793a\uff1a\u8bf7\u62d6\u52a8\u56fe\u6807\u81f3\u76ee\u6807\u4f4d\u7f6e\uff0c\u70b9\u51fb "\u5b8c\u6210" \u4f1a\u63d0\u793a\u4fdd\u5b58\u4fee\u6539\uff0c\u70b9\u51fb"\u53d6\u6d88"\u5c06\u53d6\u6d88\u4fee\u6539\uff01</span></div><br/>',e+="<a><span id='resetOrdinate'  class='btn btn-primary btn-transparent outline mt5 deleteOrdinate' key="+this.graphic.attributes.id+">\u53d6\u6d88</span></a>",e+="<a><span id='applyOrdinate'  class='btn btn-primary btn-transparent outline mt5 deleteOrdinate' key="+this.graphic.attributes.id+">\u5b8c\u6210</span></a>",this.map.infoWindow.setContent(e);var i=this.graphic.geometry;this.map.infoWindow.show(i),dojo.connect(dojo.byId("resetOrdinate"),"onclick",function(t){var e=t.target.attributes.key.value;n.cancelEdit(e)}),dojo.connect(dojo.byId("applyOrdinate"),"onclick",function(t){var e=t.target.attributes.key.value;n.confirm(e)})},t.prototype.confirm=function(i){var o=this;this.options.confirm({title:"\u786e\u5b9a\u8981\u8fdb\u884c\u66f4\u6539\u5417\uff1f",content:"\u521d\u59cb\u5750\u6807\u503c\uff08\u7ecf\u5ea6\uff09:"+this.originInfo.longitude+",\uff08\u7eac\u5ea6\uff09:"+this.originInfo.latitude+"\r\u5f53\u524d\u5750\u6807\u503c\uff08\u7ecf\u5ea6\uff09:"+this.graphic.geometry.x.toFixed(8)+",\uff08\u7eac\u5ea6\uff09:"+this.graphic.geometry.y.toFixed(8),onOk:function(){var t=o.graphic.geometry,e=o.businessLayer.formPoint(t),n=__assign({},o.graphic.attributes,e);o.options.onEditInfo({id:i,latitude:n.latitude,longitude:n.longitude},!0).then(function(t){o.businessLayer.removeGraphicById(n.id),o.businessLayer.addGraphicList([n])})},onCancel:function(){o.options.onEditInfo({id:i,latitude:o.originInfo.latitude,longitude:o.originInfo.longitude},!1)}}),this.graphic.attributes.eventName="stop",this.clear(),this.hide(),this.map.infoWindow.hide(),this.businessLayer.show()},t.prototype.registerEvent=function(){var e=this;dojo.connect(this.layer,"onClick",function(t){e.graphic=t.graphic,e.onLayerClick(e,t)}),console.log("\u7f16\u8f91\u5bf9\u8c61\uff1a"+this.editObj),dojo.on(this.editObj,"graphic-first-move",function(t){console.log("\u8981\u7d20\u79fb\u52a8---------graphic-first-move"),e.flagwindMap.innerMap.infoWindow.hide()}),dojo.on(this.editObj,"graphic-click",function(t){e.showInfoWindow()}),dojo.on(this.editObj,"graphic-move-stop",function(t){e.showInfoWindow()})},t.prototype.onLayerClick=function(t,e){t.businessLayer.options.onLayerClick&&t.businessLayer.options.onLayerClick(e),t.businessLayer.options.showInfoWindow&&t.businessLayer.showInfoWindow(e)},t}(yf.FlagwindFeatureLayer),yf.EsriEditLayer=zf,rg=flagwind||(flagwind={}),sg=function(n){function t(t){var e=n.call(this)||this;return e.options=t,e.isShow=!0,e.layer=e.onCreateGraphicsLayer(t),e}return __extends(t,n),Object.defineProperty(t.prototype,"graphics",{get:function(){return this.layer.graphics},enumerable:!0,configurable:!0}),t.prototype.appendTo=function(t){this.layer.addToMap(t)},t.prototype.removeLayer=function(t){this.layer.removeFormMap(t)},t.prototype.clear=function(){this.layer.clear()},t.prototype.show=function(){this.isShow=!0,this.layer.show()},t.prototype.hide=function(){this.isShow=!1,this.layer.hide()},t.prototype.setGeometry=function(t,e){this.getGraphicByName(t).forEach(function(t){t.setGeometry(e)})},t.prototype.setSymbol=function(t,e){this.getGraphicByName(t).forEach(function(t){t.setSymbol(e)})},t.prototype.showGraphic=function(t){this.getGraphicByName(t).forEach(function(t){t.show()})},t.prototype.hideGraphic=function(t){this.getGraphicByName(t).forEach(function(t){t.hide()})},t.prototype.addGraphic=function(i){for(var o=this,t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];void 0!==t&&t.forEach(function(t,e){if(t){var n=t.attributes;n.__master=0===e,n.__name=i,o.layer.add(t)}})},t.prototype.getMasterGraphicByName=function(n){return this.graphics.forEach(function(t){var e=t.attributes;if(n===e.__name&&e.__master)return t}),null},t.prototype.getGraphicByName=function(t){for(var e=[],n=0;n<this.graphics.length;n++){this.graphics[n].attributes.__name===t&&e.push(this.graphics[n])}return e},t.prototype.removeGraphicByName=function(t){var e=this,n=this.getGraphicByName(t);null!=n&&n.forEach(function(t){e.layer.remove(t)})},t.prototype.on=function(t,e,n,i){void 0===n&&(n=this),void 0===i&&(i=!1),this.addListener(t,e,n,i)},t.prototype.off=function(t,e,n){void 0===n&&(n=this),this.removeListener(t,e,n)},t}(rg.EventProvider),rg.FlagwindGroupLayer=sg,gh=flagwind||(flagwind={}),hh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onCreateGraphicsLayer=function(t){var e=new esri.layers.GraphicsLayer(t);return e.addToMap=function(t){t.addLayer(this)},e.removeFormMap=function(t){t.removeLayer(this)},e},e}(gh.FlagwindGroupLayer),gh.EsriGroupLayer=hh,oh=flagwind||(flagwind={}),ph=function(){function t(t,e,n){this.flagwindMap=t,this.isShow=!0,this.id=e||"heatmapLayer",this.options=__assign({},oh.HEATMAP_LAYER_OPTIONS,n),this.map=t.map,this.dataMap=new oh.Map,this.heatLayer=this.createHeatLayer(),this.appendTo(this.map)}return t.prototype.createHeatLayer=function(){var t={id:this.id,opacity:.7},e=new esri.layers.FeatureLayer({featureSet:null,layerDefinition:{geometryType:"esriGeometryPoint",fields:[{name:"count",type:"esriFieldTypeDouble",alias:"count"}]}},t);return this.heatmapRenderer=new esri.renderer.HeatmapRenderer(__assign({field:"count",blurRadius:this.options.blurRadius||12,colorStops:this.options.colorStops||[{ratio:0,color:"rgb(255, 219, 0, 0)"},{ratio:.6,color:"rgb(250, 146, 0)"},{ratio:.85,color:"rgb(250, 73, 0)"},{ratio:.95,color:"rgba(250, 0, 0)"}]},this.options)),e.setRenderer(this.heatmapRenderer),e},t.prototype.appendTo=function(t){t.addLayer(this.heatLayer)},t.prototype.removeLayer=function(t){t.removeLayer(this.heatLayer)},t.prototype.resize=function(){this.map.innerMap.resize()},t.prototype.clear=function(){this.dataMap.clear(),this.heatLayer.clear()},t.prototype.show=function(){this.isShow=!0,this.heatLayer.show()},t.prototype.hide=function(){this.isShow=!1,this.heatLayer.hide()},t.prototype.setMaxPixelIntensity=function(t){this.heatmapRenderer.setMaxPixelIntensity(t)},t.prototype.showDataList=function(t){var o=this,e=this.onChangeStandardModel(t);0!==e.length?(this.setMaxPixelIntensity(e.reduce(function(t,e){return Math.max(e.count,t)},1)),e.forEach(function(t){var e=o.flagwindMap.getPoint(t),n=new esri.symbol.SimpleMarkerSymbol,i=new esri.Graphic(e,n,t);o.heatLayer.add(i)})):console.log("\u672a\u4f20\u5165\u70ed\u70b9\u6570\u636e")},t.prototype.onChangeStandardModel=function(t){var o=this;return t.forEach(function(t){var e=o.options.changeStandardModel(t);if(e){var n=e.longitude+":"+e.latitude,i=o.dataMap.get(n);void 0!==i?(i.members.push(t),i.count=i.count+(e.count||1)):(i={longitude:e.longitude,latitude:e.latitude,members:[t],count:e.count||1},o.dataMap.set(n,i))}}),this.dataMap.values()},t}(),oh.EsriHeatmapLayer=ph,Ph=flagwind||(flagwind={}),Qh=function(i){function t(t,e){var n=i.call(this,e.id,e.title)||this;return n.flagwindMap=t,n.options=e,n.options=__assign({},Ph.LOCATION_LAYER_OPTIONS,n.options),n.layer=n.onCreateGraphicsLayer({id:n.id}),n.flagwindMap.addFeatureLayer(n),n.registerEvent(),n}return __extends(t,i),t.prototype.registerEvent=function(){var e=this;this.flagwindMap.on("onClick",function(t){e.point=t.data.mapPoint,e.locate()},this)},t.prototype.onCreateGraphicsLayer=function(t){var e=this,n=new esri.layers.GraphicsLayer(t);return n.on("mouse-over",function(t){return e.dispatchEvent("onMouseOver",t)}),n.on("mouse-out",function(t){return e.dispatchEvent("onMouseOut",t)}),n.on("mouse-up",function(t){return e.dispatchEvent("onMouseUp",t)}),n.on("mouse-down",function(t){return e.dispatchEvent("onMouseDown",t)}),n.on("click",function(t){return e.dispatchEvent("onClick",t)}),n.on("dbl-click",function(t){return e.dispatchEvent("onDblClick",t)}),n.addToMap=function(t){t.addLayer(this)},n.removeFormMap=function(t){t.removeLayer(this)},n},t.prototype.locate=function(){this.clear();var t=this.createGraphic(this.point);this.layer.add(t),this.options.onMapClick({point:this.point})},t.prototype.getFillSymbol=function(t,e){e=e||[38,101,196],t=t||2;var n=[60,137,253,.6];return new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color(n),t),new esri.Color(n))},t.prototype.createSymbol=function(t,e){var n=new esri.symbol.SimpleMarkerSymbol;return n.setPath(t),n.setSize(40),n.setColor(new dojo.Color(e)),n.setOutline(null),n},t.prototype.createGraphic=function(t){return new esri.Graphic(t,this.createSymbol("M511.999488 299.209616m-112.814392 0a110.245 110.245 0 1 0 225.628784 0 110.245 110.245 0 1 0-225.628784 0ZM47.208697 523.662621A0 11.396 0 1 1 47.208697 524.685927ZM511.949346 7.981788c-173.610036 0-314.358641 140.748604-314.358641 314.358641s314.358641 523.932774 314.358641 523.932774 314.358641-350.322737 314.358641-523.932774S685.558359 7.981788 511.949346 7.981788L511.949346 7.981788zM511.949346 453.323623c-86.805018 0-157.177785-70.371744-157.177785-157.176762 0-86.830601 70.372767-157.182902 157.177785-157.182902 86.825484 0 157.201322 70.352301 157.201322 157.182902C669.150668 382.952902 598.774831 453.323623 511.949346 453.323623L511.949346 453.323623zM511.949346 453.323623M583.236949 788.686646l-19.674085 34.075073c201.221908 3.617387 357.506347 30.455639 357.506347 63.026452 0 35.039028-180.857091 63.442938-403.955238 63.442938-309.208341 0-403.962401-28.404933-403.962401-63.442938 0-32.067346 151.486156-58.57507 348.201423-62.841234l-19.780509-34.259268c-214.366276 7.369851-378.251833 47.647183-378.251833 96.232738 0 53.81465 105.338117 97.443309 449.084065 97.443309 248.02077 0 449.082018-43.62559 449.082018-97.443309C961.487759 836.332806 797.602202 796.055474 583.236949 788.686646z","#13227a"))},t}(Ph.FlagwindFeatureLayer),Ph.EsriLocationLayer=Qh,ti=flagwind||(flagwind={}),ui=function(o){function t(t,e,n){var i=o.call(this,t,e,__assign({onMapClick:function(t){console.log("onMapClick:"+t.data.mapPoint.x+","+t.data.mapPoint.y)}},n))||this;return i.mapSetting=t,i.onInit(),i}return __extends(t,o),t.prototype.onAddEventListener=function(t,e){dojo.on(this.map,t,e)},t.prototype.onCenterAt=function(e){var n=this;return new Promise(function(t){n.map.centerAt(e).then(function(){t()})})},t.prototype.onCreatePoint=function(t){return new esri.geometry.Point(t.x,t.y,t.spatial||this.spatial)},t.prototype.onCreateMap=function(){var e=this;this.spatial=new esri.SpatialReference({wkid:this.mapSetting.wkid||4326});var t=this.mapSetting,n={wkid:t.wkid,center:t.center,logo:t.logo,slider:t.slider,sliderPosition:t.sliderPosition};if(void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.minZoom&&(n.minZoom=t.minZoom),void 0!==t.maxZoom&&(n.maxZoom=t.maxZoom),t.basemap&&(n.basemap=t.basemap),t.extent&&4===t.extent.length){var i=this.getPoint({x:t.extent[0],y:t.extent[1]}),o=this.getPoint({x:t.extent[2],y:t.extent[3]}),r=new esri.geometry.Extent(i.x,i.y,o.x,o.y,this.spatial);n.extent=r}var s=new esri.Map(this.mapElement,n);s.infoWindow.anchor="top",this.innerMap=s,this.tooltipElement=document.createElement("div"),this.tooltipElement.classList.add("flagwind-map-tooltip"),this.innerMap.root.appendChild(this.tooltipElement),s.on("load",function(t){e.dispatchEvent("onLoad",t)}),s.on("click",function(t){e.dispatchEvent("onClick",t)}),s.on("dbl-click",function(t){e.dispatchEvent("onDbClick",t)}),s.on("mouse-out",function(t){e.dispatchEvent("onMouseOut",t)}),s.on("mouse-over",function(t){e.dispatchEvent("onMouseOver",t)}),s.on("mouse-move",function(t){e.dispatchEvent("onMouseMove",t)}),s.on("mouse-wheel",function(t){e.dispatchEvent("onMouseWheel",t)}),s.on("zoom",function(t){e.dispatchEvent("onZoom",t)}),s.on("zoom-start",function(t){e.dispatchEvent("onZoomStart",t)}),s.on("zoom-end",function(t){e.dispatchEvent("onZoomEnd",t)}),s.on("pan",function(t){e.dispatchEvent("onPan",t)}),s.on("pan-start",function(t){e.dispatchEvent("onPanStart",t)}),s.on("pan-end",function(t){e.dispatchEvent("onPanEnd",t)}),s.on("update-start",function(t){e.dispatchEvent("onUpdateStart",t)}),s.on("update-end",function(t){e.dispatchEvent("onUpdateEnd",t)}),s.on("extent-change",function(t){e.dispatchEvent("onExtentChange",t)}),s.on("resize",function(t){e.dispatchEvent("onResize",t)})},t.prototype.onShowInfoWindow=function(t){if(this.innerMap.infoWindow&&this.innerMap.infoWindow.hide(),t.context){var e=this.getPoint(t.graphic.attributes);if(this.innerMap.infoWindow.setTitle(t.context.title),this.innerMap.infoWindow.setContent(t.context.content),t.options)if(t.options.width&&t.options.height&&this.innerMap.infoWindow.resize(t.options.width,t.options.height),t.options.offset){var n=this.innerMap.toScreen(e);n.x+=t.options.offset.x,n.y+=t.options.offset.y,this.innerMap.infoWindow.show(n)}else this.innerMap.infoWindow.show(e)}},t.prototype.onCloseInfoWindow=function(){this.innerMap.infoWindow&&this.innerMap.infoWindow.hide()},t.prototype.onCreateBaseLayers=function(){var n=this,i=new Array;if(this.mapSetting.baseUrl){var t=new ti.EsriTiledLayer("base_arcgis_tiled",this.mapSetting.baseUrl,this.spatial,"\u74e6\u7247\u56fe\u5c42");i.push(t)}return this.mapSetting.tiledUrls&&this.mapSetting.tiledUrls.forEach(function(t){if(t.url){var e=new ti.EsriTiledLayer(t.id,t.url,n.spatial,t.title);i.push(e)}}),this.baseLayers=i,this.baseLayers.forEach(function(t){t.appendTo(n.innerMap)}),i},t.prototype.toScreen=function(){var t,e=arguments;switch(e.length){case 1:t=this.onToPoint(e[0]);break;case 2:t=this.onCreatePoint({x:e[0],y:e[1],spatial:this.spatial})}return t?this.innerMap.toScreen(t):null},t.prototype.onZoom=function(e){var n=this;return new Promise(function(t){n.map.setZoom(e).then(function(){t()})})},t.prototype.onShowTooltip=function(t){var e=t.attributes,n=new esri.geometry.Point(e.longitude,e.latitude,this.spatial),i=this.innerMap.toScreen(n),o=e.name;this.tooltipElement.innerHTML="<div>"+o+"</div>",this.tooltipElement.style.left=i.x+15+"px",this.tooltipElement.style.top=i.y+15+"px",this.tooltipElement.style.display="block"},t.prototype.onHideTooltip=function(){this.tooltipElement.style.display="none"},t.prototype.onDestroy=function(){try{this.tooltipElement&&(this.tooltipElement.remove(),this.tooltipElement=null),this.featureLayers&&(this.featureLayers.forEach(function(t){t.clear()}),this.featureLayers=[]),this.baseLayers&&(this.baseLayers=[]),this.innerMap&&this.innerMap.destroy&&(this.innerMap.destroy(),this.innerMap=null)}catch(t){console.error(t)}},t}(ti.FlagwindMap),ti.EsriMap=ui,function(l){l.ESRI_POINT_LAYER_OPTIONS={onEvent:function(t,e){switch(t){case"onMouseOver":e.graphic.getNode()&&e.graphic.getNode().classList.add("marker-scale");break;case"onMouseOut":e.graphic.getNode()&&e.graphic.getNode().classList.remove("marker-scale")}},symbol:{width:32,height:32},layerType:"point"};var t=function(i){function t(t,e,n){return i.call(this,t,e,__assign({},l.ESRI_POINT_LAYER_OPTIONS,n))||this}return __extends(t,i),t.prototype.onCreateGraphicsLayer=function(t){var e=this,n=new esri.layers.GraphicsLayer(t);return n.on("mouse-over",function(t){return e.dispatchEvent("onMouseOver",t)}),n.on("mouse-out",function(t){return e.dispatchEvent("onMouseOut",t)}),n.on("mouse-up",function(t){return e.dispatchEvent("onMouseUp",t)}),n.on("mouse-down",function(t){return e.dispatchEvent("onMouseDown",t)}),n.on("click",function(t){return e.dispatchEvent("onClick",t)}),n.on("dbl-click",function(t){return e.dispatchEvent("onDblClick",t)}),n.addToMap=function(t){t.addLayer(this)},n.removeFormMap=function(t){try{this._map||(this._map=t),t.removeLayer(this)}catch(t){console.warn(t)}},n},t.prototype.getImageUrl=function(t){var e=this.options.symbol.imageUrl;if("string"==typeof e&&e){var n="imageUrl"+(t.status||"")+(t.selected?"checked":""),i=this.options[n]||this.options.symbol[n]||e,o=i.lastIndexOf("."),r=i.substring(0,o),s=i.substring(o+1);return t.selected?r+"_checked."+s:r+"."+s}var a=t.status;null==a&&(a="");n="image"+a+(t.selected?"checked":"");return this.options[n]||this.options.symbol[n]||this.options.image},t.prototype.onCreatGraphicByModel=function(t){var e=this.getImageUrl(t),n=this.getPoint(t),i=this.options.symbol.width,o=this.options.symbol.height,r=new esri.symbol.PictureMarkerSymbol(e,i,o),s=__assign({},t,{__type:this.layerType});return new esri.Graphic(n,r,s)},t.prototype.onUpdateGraphicByModel=function(t){var e=this.getImageUrl(t),n=this.getPoint(t),i=this.options.symbol.width,o=this.options.symbol.height,r=new esri.symbol.PictureMarkerSymbol(e,i,o),s=this.getGraphicById(t.id),a=s.geometry;s.setGeometry(n),s.setSymbol(r),s.attributes=__assign({},s.attributes,t,{__type:this.layerType}),s.draw(),l.MapUtils.isEqualPoint(n,a)||this.options.onPositionChanged(n,a,s.attributes)},t}(l.FlagwindBusinessLayer);l.EsriPointLayer=t}(flagwind||(flagwind={})),function(o){o.ESRI_POLYGON_LAYER_OPTIONS={onEvent:function(t,e){"onMouseOver"===t?(e.graphic.symbol.setColor([247,247,247,.05]),e.graphic.draw()):"onMouseOut"===t&&(e.graphic.symbol.setColor([0,49,0,.45]),e.graphic.draw())},symbol:{lineWidth:3,lineColor:[255,255,255,.6],fillColor:[0,49,0,.45],lineType:"STYLE_DASH",fillType:"STYLE_SOLID"},layerType:"polygon"};var t=function(i){function t(t,e,n){return i.call(this,t,e,__assign({},o.ESRI_POLYGON_LAYER_OPTIONS,n))||this}return __extends(t,i),t.prototype.onCreateGraphicsLayer=function(t){var e=this,n=new esri.layers.GraphicsLayer(t);return n.on("mouse-over",function(t){return e.dispatchEvent("onMouseOver",t)}),n.on("mouse-out",function(t){return e.dispatchEvent("onMouseOut",t)}),n.on("mouse-up",function(t){return e.dispatchEvent("onMouseUp",t)}),n.on("mouse-down",function(t){return e.dispatchEvent("onMouseDown",t)}),n.on("click",function(t){return e.dispatchEvent("onClick",t)}),n.on("dbl-click",function(t){return e.dispatchEvent("onDblClick",t)}),n.addToMap=function(t){t.addLayer(this)},n.removeFormMap=function(t){t.removeLayer(this)},n},t.prototype.onCreatGraphicByModel=function(t){var e=this.getPolygon(t.polygon),n=this.getFillSymbol(this.options.symbol),i=__assign({},t,{__type:"polygon"});return new esri.Graphic(e,n,i)},t.prototype.onUpdateGraphicByModel=function(t){var e=this.getPolygon(t.polygon),n=this.getFillSymbol(this.options.symbol),i=this.getGraphicById(t.id);i.setGeometry(e),i.setSymbol(n),i.attributes=__assign({},i.attributes,t,{__type:"polygon"}),i.draw()},t.prototype.getPolygon=function(t){if(!t)return null;for(var e=new esri.geometry.Polygon(this.spatial),n=t.split(";"),i=[],o=0;o<n.length;o++)if(n[o]&&!(n[o].length<=0)){var r=n[o].split(","),s=this.getPoint({x:parseFloat(r[0]),y:parseFloat(r[1])});i.push([s.x,s.y])}return e.addRing(i),e},t.prototype.getFillSymbol=function(t){return new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol[t.fillType],new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol[t.lineType],new esri.Color(t.lineColor),t.lineWidth),new esri.Color(t.fillColor))},t}(o.FlagwindBusinessLayer);o.EsriPolygonLayer=t}(flagwind||(flagwind={})),function(r){r.ESRI_POLYLINE_LAYER_OPTIONS={symbol:{lineWidth:4,lineColor:[255,0,0],lineType:"STYLE_DASH",lineMiterLimit:2},layerType:"polyline"};var t=function(o){function t(t,e,n){var i=o.call(this,t,e,__assign({},r.ESRI_POLYLINE_LAYER_OPTIONS,n))||this;return i.onInit(),i}return __extends(t,o),t.prototype.onCreateGraphicsLayer=function(t){var e=this,n=new esri.layers.GraphicsLayer(t);return n.on("mouse-over",function(t){return e.dispatchEvent("onMouseOver",t)}),n.on("mouse-out",function(t){return e.dispatchEvent("onMouseOut",t)}),n.on("mouse-up",function(t){return e.dispatchEvent("onMouseUp",t)}),n.on("mouse-down",function(t){return e.dispatchEvent("onMouseDown",t)}),n.on("click",function(t){return e.dispatchEvent("onClick",t)}),n.on("dbl-click",function(t){return e.dispatchEvent("onDblClick",t)}),n.addToMap=function(t){t.addLayer(this)},n.removeFormMap=function(t){t.removeLayer(this)},n},t.prototype.onCreatGraphicByModel=function(t){var e=this.getPolyline(t.polyline),n=this.getLineSymbol(this.options.symbol),i=__assign({},t,{__type:"polyline"});return new esri.Graphic(e,n,i)},t.prototype.onUpdateGraphicByModel=function(t){var e=this.getPolyline(t.polyline),n=this.getLineSymbol(this.options.symbol),i=this.getGraphicById(t.id);i.setGeometry(e),i.setSymbol(n),i.attributes=__assign({},i.attributes,t,{__type:"polyline"}),i.draw()},t.prototype.setSelectStatus=function(t,e){t.selected=e,this.onUpdateGraphicByModel(t)},t.prototype.getLineSymbol=function(t){return new esri.symbol.CartographicLineSymbol(esri.symbol.CartographicLineSymbol[t.lineType],new esri.Color(t.lineColor),t.lineWidth,esri.symbol.CartographicLineSymbol.CAP_ROUND,esri.symbol.CartographicLineSymbol.JOIN_MITER,t.lineMiterLimit)},t.prototype.getPolyline=function(t){if(!t)return null;for(var e=new esri.geometry.Polyline(this.spatial),n=t.split(";"),i=1;i<n.length;i++)if(n[i]&&!(n[i].length<=0)){var o=n[i-1].split(","),r=n[i].split(","),s=this.getPoint({x:parseFloat(o[0]),y:parseFloat(o[1])}),a=this.getPoint({x:parseFloat(r[0]),y:parseFloat(r[1])});e.addPath([[s.x,s.y],[a.x,a.y]])}return e},t}(r.FlagwindBusinessLayer);r.EsriPolylineLayer=t}(flagwind||(flagwind={})),function(d){d.ROUTE_LAYER_OPTIONS={routeType:"Line",routeUrl:"http://120.202.26.98:6080/arcgis/rest/services/Features/NAServer/Route",speed:100,minSpeedRatio:.25,maxSpeedRatio:4,trackLevel:2,autoCenterAt:!0,getImageUrl:null,getImageAngle:null,onMessageEvent:function(t,e){console.log(t+" "+e)},onCreateSegmentCompleteEvent:function(t){console.log("onCreateSegmentCompleteEvent")},onLineStartEvent:function(t,e,n){console.log("onLineStartEvent")},onLineEndEvent:function(t,e,n){console.log("onLineEndEvent")},onMoveEvent:function(t,e,n,i){console.log("onMoveEvent")},onStationEvent:function(t,e,n,i,o){console.log("onStationEvent")}},d.TRACKLINE_OPTIONS={autoShowSegmentLine:!0,symbol:{imageUrl:"",height:null,width:null}};var t=function(){function t(t,e,n){var i=this;this.flagwindMap=t,this.layerName=e,this.options=n,this.isShow=!0,this.trackLines=[],this.options=__assign({},d.ROUTE_LAYER_OPTIONS,n),this.moveLineLayer=this.onCreateLineLayer(e+"LineLayer"),this.moveMarkLayer=this.onCreateMovingLayer(e+"MarkerLayer"),this.onAddLayerBefor(),this.moveLineLayer.appendTo(this.flagwindMap.innerMap),this.moveMarkLayer.appendTo(this.flagwindMap.innerMap),this.onAddLayerAfter(),this.flagwindMap.loaded?this.onLoad():this.flagwindMap.on("load",function(){return i.onLoad()},this)}return Object.defineProperty(t.prototype,"spatial",{get:function(){return this.flagwindMap.spatial},enumerable:!0,configurable:!0}),t.prototype.show=function(){this.moveMarkLayer&&this.moveMarkLayer.show(),null!=this.moveLineLayer&&this.moveLineLayer.show()},t.prototype.hide=function(){this.moveMarkLayer&&this.moveMarkLayer.hide(),this.moveLineLayer&&this.moveLineLayer.hide()},t.prototype.clearAll=function(){this.checkMapSetting(),this.stopAll(),this.moveMarkLayer&&this.moveMarkLayer.clear(),this.moveLineLayer&&this.moveLineLayer.clear(),this.trackLines=[]},t.prototype.clear=function(t){if(t){var e=this.getTrackLine(t);if(null==e)return void console.warn("\u65e0\u6548\u7684\u8def\u5f84\uff1a"+t);e.stop(),this.moveMarkLayer.removeGraphicByName(t),this.moveLineLayer.removeGraphicByName(t),e.markerGraphic=null;var n=this.trackLines.indexOf(e);0<=n&&this.trackLines.splice(n,1)}else this.stopAll(),this.moveMarkLayer&&this.moveMarkLayer.clear(),this.moveLineLayer&&this.moveLineLayer.clear(),this.trackLines=[]},t.prototype.clearLine=function(t){t?this.moveLineLayer.removeGraphicByName(t):console.error("\u6ca1\u6709\u6307\u5b9a\u6e05\u9664\u7684\u7ebf\u8def\u540d\u79f0")},t.prototype.getTrackLine=function(e){var t=this.trackLines.filter(function(t){return t.name===e});return t&&0<t.length?t[0]:null},t.prototype.addTrackSegment=function(t,e,n){var i=this.getTrackLine(t);i||(i=new d.TrackLine(this.flagwindMap,t,n),this.trackLines.push(i)),i.add(e)},t.prototype.getNextSegmentIndex=function(t){var e=this.getTrackLine(t);return e?e.nextSegmentIndex:0},t.prototype.getNextSegment=function(t,e){var n=this.getTrackLine(t);if(n)return n.getNextSegment(e)},t.prototype.getLastSegment=function(t){var e=this.getTrackLine(t);if(e)return e.lastSegment},t.prototype.getActiveCompletedSegment=function(t){var e=this.getTrackLine(t);if(e)return e.activeCompletedSegment},t.prototype.getIsRunning=function(t){var e=this.getTrackLine(t);return!!e&&e.isRunning},t.prototype.stop=function(t){var e=this.getTrackLine(t);null!=e?e.stop():console.warn("\u65e0\u6548\u7684\u8def\u5f84\uff1a"+t)},t.prototype.stopAll=function(){var e=this;this.trackLines?this.trackLines.forEach(function(t){e.stop(t.name)}):console.warn("\u6ca1\u6709\u8def\u5f84\u4fe1\u606f")},t.prototype.move=function(t){var e=this.getTrackLine(t);e?e.move():console.warn("\u65e0\u6548\u7684\u8def\u5f84\uff1a"+t)},t.prototype.start=function(t){var e=this.getTrackLine(t);e?(e.stop(),e.start()):console.warn("\u65e0\u6548\u7684\u8def\u5f84\uff1a"+t)},t.prototype.pause=function(t){var e=this.getTrackLine(t);e?e.pause():console.warn("\u65e0\u6548\u7684\u8def\u5f84\uff1a"+t)},t.prototype.continue=function(t){var e=this.getTrackLine(t);e?e.continue():console.warn("\u65e0\u6548\u7684\u8def\u5f84\uff1a"+t)},t.prototype.changeSpeed=function(t,e){var n=this.getTrackLine(t);n?n.changeSpeed(e):console.warn("\u65e0\u6548\u7684\u8def\u5f84\uff1a"+t)},t.prototype.speedUp=function(t){var e=this.getTrackLine(t);return e?e.speedUp():(console.warn("\u65e0\u6548\u7684\u8def\u5f84\uff1a"+t),"\u5f53\u524d\u8def\u7ebf\u4e3a\u7a7a\uff01")},t.prototype.speedDown=function(t){var e=this.getTrackLine(t);return e?e.speedDown():(console.warn("\u65e0\u6548\u7684\u8def\u5f84\uff1a"+t),"\u5f53\u524d\u8def\u7ebf\u4e3a\u7a7a\uff01")},t.prototype.solveSegment=function(t,e,n){var i=this;n=__assign({},d.TRACKLINE_OPTIONS,n),this.checkMapSetting();var o=[];if(e.forEach(function(t){t=i.changeStandardModel(t),i.validGeometryModel(t)&&o.push(t)}),o.length<1)throw Error("\u4f9d\u9760\u70b9\u4e0d\u80fd\u5c11\u4e8e2");this.activedTrackLineName=t;var r=this.getLastSegment(t),s=r?r.index+1:0;if(s+o.length<2)throw Error("\u505c\u9760\u70b9\u4e0d\u80fd\u5c11\u4e8e2");var a=this.onGetStandardStops(t,o);if(r){var l=this.onEqualGraphic(r.endGraphic,a[0]);"NA"===this.options.routeType&&!l&&(this.post(s,t,r.endGraphic,a[0],n),s+=1)}if(2<=a.length){var p=a.splice(0,1)[0],h=a.splice(a.length-1,1)[0],c=a;this.post(s,t,p,h,n,c)}},t.prototype.solveLine=function(t,e,n){var i=this,o=__assign({},d.TRACKLINE_OPTIONS,n);this.checkMapSetting();var r=[];if(e.forEach(function(t){t=i.changeStandardModel(t),i.validGeometryModel(t)&&r.push(t)}),r.length<1)throw Error("\u505c\u9760\u70b9\u4e0d\u80fd\u5c11\u4e8e2");this.activedTrackLineName=t;var s=this.getLastSegment(t),a=s?s.index+1:0;if(a+r.length<2)throw Error("\u505c\u9760\u70b9\u4e0d\u80fd\u5c11\u4e8e2");var l=this.onGetStandardStops(t,r);if(s){var p=this.onEqualGraphic(s.endGraphic,l[0]);"NA"===this.options.routeType&&!p&&(this.post(a,t,s.endGraphic,l[0],o),a+=1)}for(var h=0;h<l.length-1;h++){var c=l[h],u=l[h+1];this.post(a+h,t,c,u,o)}},t.prototype.post=function(t,e,n,i,o,r){void 0===r&&(r=[]);var s=this,a=o;a.onShowSegmentLineEvent=function(t){s.onShowSegmentLineEvent(s,t,a)},a.onMoveStartEvent=function(t,e,n){s.onMoveStartEvent(s,t,e,n)},a.onMoveEvent=function(t,e,n){s.onMoveEvent(s,t,e,n)},a.onMoveEndEvent=function(t,e,n){s.onMoveEndEvent(s,t,e,n)};var l=new d.TrackSegment(this,t,e,n,i,a);r&&(l.waypoints=r),this.addTrackSegment(e,l,a),"NA"===this.options.routeType?this.onSolveByService(l,n,i,r):(this.onSolveByJoinPoint(l),this.onCreateSegmentComplete(l))},t.prototype.solveComplete=function(t,e){var n=t.polyline,i=t.length;e.setPolyLine(n,i),this.onCreateSegmentComplete(e)},t.prototype.errorHandler=function(t,e){console.log("\u8def\u7531\u5206\u6790\u5f02\u5e38"+t);var n=[];if(n.push(e.startGraphic.geometry),e.waypoints)for(var i=0;i<e.waypoints.length;i++)n.push(e.waypoints[i].geometry);n.push(e.endGraphic.geometry),e.setMultPoints(n),this.onCreateSegmentComplete(e)},t.prototype.onCreateSegmentComplete=function(t){this.options.onCreateSegmentCompleteEvent(t)},t.prototype.onShowSegmentLineEvent=function(t,e,n){n.autoShowSegmentLine&&t.onShowSegmentLine(e)},t.prototype.onMoveStartEvent=function(t,e,n,i){var o=t.getTrackLine(e.name);void 0!==o&&(o.markerGraphic||t.onCreateMoveMark(o,n,i),t.options.autoCenterAt&&t.flagwindMap.centerAt(n.geometry.x,n.geometry.y),e.lineGraphic||t.onShowSegmentLine(e),t.options.onStationEvent(e.name,e.index,n,!0,t.getTrackLine(e.name)),0===e.index&&this.options.onLineStartEvent(e.name,e.index,t.getTrackLine(e.name)))},t.prototype.onMoveEndEvent=function(t,e,n,i){var o=t.getNextSegment(e.name,e.index),r=t.getTrackLine(e.name);o?(t.options.onStationEvent(e.name,e.index,n,!1,r),o.start()):(t.options.onStationEvent(e.name,e.index,n,!1,r),e.stop(),t.options.onLineEndEvent(e.name,e.index,r))},t.prototype.onMoveEvent=function(t,e,n,i){var o=this.flagwindMap.onCreatePoint({x:parseFloat(n[0]),y:parseFloat(n[1]),spatial:t.flagwindMap.spatial}),r=t.getTrackLine(e.name);r&&(t.onUpdateMoveGraphic(r,o,i),t.options.onMoveEvent(e.name,e.index,n,i))},t.prototype.onAddLayerBefor=function(){console.log("onAddLayerBefor")},t.prototype.onAddLayerAfter=function(){console.log("onAddLayerAfter")},t.prototype.onLoad=function(){var e=this;this.moveMarkLayer.on("onClick",function(t){e.options.onMovingClick&&e.options.onMovingClick(t)},this)},t.prototype.checkMapSetting=function(){},t.prototype.changeStandardModel=function(t){return this.options.changeStandardModel?this.options.changeStandardModel(t):t},t.prototype.validGeometryModel=function(t){return d.MapUtils.validGeometryModel(t)},t}();d.FlagwindRouteLayer=t}(flagwind||(flagwind={})),zo=flagwind||(flagwind={}),Ao=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.trackLines=[],t}return __extends(t,e),t.prototype.onSetSegmentByLine=function(t,e){if(e.polyline=t.polyline,e.length=t.length,e.polyline.paths&&0<e.polyline.paths.length){var n=e.options.numsOfKilometer?e.options.numsOfKilometer:100;e.line=zo.MapUtils.vacuate(e.polyline.paths,e.length,n)}else e.line=[]},t.prototype.onSetSegmentByPoint=function(t,e){for(var n=t.points,i=e.options.numsOfKilometer?e.options.numsOfKilometer:100,o=new esri.geometry.Polyline(this.flagwindMap.spatial),r=0;r<n.length-1;r++){var s=n[r],a=n[r+1],l=new esri.geometry.Polyline(this.flagwindMap.spatial).addPath([s,a]),p=esri.geometry.geodesicLengths([l],esri.Units.KILOMETERS)[0],h=zo.MapUtils.extractPoints(s,a,p*i);o.addPath(h)}e.length=esri.geometry.geodesicLengths([o],esri.Units.KILOMETERS)[0],e.polyline=o,e.line=zo.MapUtils.vacuate(e.polyline.paths,e.length,i)},t.prototype.onShowSegmentLine=function(t){var e=new esri.symbol.CartographicLineSymbol(esri.symbol.CartographicLineSymbol.STYLE_SOLID,new esri.Color([48,254,62,.8]),4,esri.symbol.CartographicLineSymbol.CAP_ROUND,esri.symbol.CartographicLineSymbol.JOIN_MITER,2);t.lineGraphic=new esri.Graphic(t.polyline,e,{__type:"segment",__index:t.index,__line:t.name}),this.moveLineLayer.addGraphic(t.name,t.lineGraphic)},t.prototype.onCreateMoveMark=function(t,e,n){var i=this.getImageUrl(t,n),o=t.options.symbol.height||this.options.symbol.height,r=t.options.symbol.width||this.options.symbol.width;i||console.warn("\u8f68\u8ff9\u79fb\u52a8\u8981\u7d20\u56fe\u7247\u672a\u5b9a\u4e49");var s=new esri.symbol.PictureMarkerSymbol(i,o,r),a=new esri.Graphic(e.geometry,s,{__type:"point",__line:t.name});t.markerGraphic=a,this.moveMarkLayer.addGraphic(t.name,a)},t.prototype.onUpdateMoveGraphic=function(t,e,n){if(void 0!==t){var i=t.markerGraphic.symbol,o=this.getImageUrl(t,n);i.setUrl(o);var r=this.getImageAngle(t,n);null!==r&&i.setAngle(r),t.markerGraphic.setSymbol(i),t.markerGraphic.setGeometry(e),t.markerGraphic.draw()}},t.prototype.getImageUrl=function(t,e){if(this.options.getImageUrl)return this.options.getImageUrl(t,e);if(t.options.getImageUrl)return t.options.getImageUrl(t,e);var n=1;(e<45||315<=e)&&(n=3),45<=e&&e<135&&(n=4),135<=e&&e<225&&(n=2),225<=e&&e<315&&(n=1),null===t.step&&(t.step=-1),t.direction!==n?t.step=0:t.step=(t.step+1)%4,t.direction=n;var i=""+t.direction+(t.step+1);return t.options.symbol["imageUrl"+i]},t.prototype.getImageAngle=function(t,e){return this.options.getImageAngle?this.options.getImageAngle(t,e):t.options.getImageAngle?t.options.getImageAngle(t,e):360-e},t.prototype.onCreateLineLayer=function(t){return new zo.EsriGroupLayer({id:t})},t.prototype.onCreateMovingLayer=function(t){return new zo.EsriGroupLayer({id:t})},t.prototype.onEqualGraphic=function(t,e){return zo.MapUtils.isEqualPoint(t.geometry,e.geometry)},t.prototype.onGetStandardStops=function(t,e){for(var n=[],i=(new esri.symbol.SimpleMarkerSymbol).setStyle(esri.symbol.SimpleMarkerSymbol.STYLE_CROSS).setSize(15).outline.setWidth(3),o=0;o<e.length;o++)e[o]instanceof Array?n.push(new esri.Graphic(new esri.geometry.Point(e[o][0],e[o][1]),i,{__type:"stop",__line:t})):0<(e[o].declaredClass||"").indexOf("Point")?n.push(new esri.Graphic(e[o],i,{__type:"stop",__line:t})):0<(e[o].declaredClass||"").indexOf("Graphic")?n.push(new esri.Graphic(e[o].geometry,i,{__type:"stop",__model:e[o].attributes,__line:t})):n.push(new esri.Graphic(this.flagwindMap.getPoint(e[o]),i,{__type:"stop",__model:e[o],__line:t}));return n},t.prototype.onSolveByService=function(o,t,e,n){if(this.options.routeUrl){var i=new esri.tasks.RouteTask(this.options.routeUrl),r=new esri.tasks.RouteParameters;r.stops=new esri.tasks.FeatureSet,r.returnRoutes=!0,r.returnDirections=!0,r.directionsLengthUnits=esri.Units.MILES,r.outSpatialReference=this.getSpatialReferenceFormNA();var s=this;if(i.on("solve-complete",function(t){var e=t.result.routeResults[0],n=e.route.geometry,i=e.directions.totalLength;s.solveComplete({polyline:n,length:i},o)}),i.on("error",function(t){console.warn("\u8f68\u8ff9\u8def\u7531\u670d\u52a1\u8bf7\u6c42\u5f02\u5e38\uff1a",t),s.errorHandler(t,o)}),r.stops.features.push(this.cloneStopGraphic(t)),n)for(var a=0;a<n.length;a++)r.stops.features.push(this.cloneStopGraphic(n[a]));r.stops.features.push(this.cloneStopGraphic(e)),i.solve(r)}else console.error("routeUrl\u5730\u5740\u4e3a\u7a7a\uff01")},t.prototype.onSolveByJoinPoint=function(t){var e=[];if(e.push(t.startGraphic.geometry),t.waypoints)for(var n=0;n<t.waypoints.length;n++)e.push(t.waypoints[n].geometry);e.push(t.endGraphic.geometry),t.setMultPoints(e)},t.prototype.onAddEventListener=function(t,e,n){t.layer.on(e,n)},t.prototype.getSpatialReferenceFormNA=function(){return new esri.SpatialReference({wkid:this.flagwindMap.spatial.wkid})},t.prototype.cloneStopGraphic=function(t){return new esri.Graphic(t.geometry,t.symbol,{__type:t.attributes.__type,__model:t.attributes.__model,__line:t.attributes.__line})},t}(zo.FlagwindRouteLayer),zo.EsriRouteLayer=Ao,function(o){o.SELECT_BOX_OPTIONS_ESRI={id:"select-box",selectMode:2,onCheckChanged:function(t,e){}};var t=function(i){function t(t,e){var n=i.call(this,null)||this;return n.flagwindMap=t,n.layers=[],e=__assign({},o.SELECT_BOX_OPTIONS_ESRI,e),n.options=e,n.id=e.id||"select-box",n.flagwindMap.featureLayers.forEach(function(t){t instanceof o.FlagwindBusinessLayer&&n.addLayer(t)}),n.draw=new esri.toolbars.Draw(t.map,{drawTime:75,showTooltips:!0,tolerance:8,tooltipOffset:15}),n.draw.on("draw-complete",function(t){n.onCreateRecord(n,t)}),e.element?n.element=e.element:n.showSelectBar(),n}return __extends(t,i),t.prototype.onCreateRecord=function(t,e){var i=this,o=e.geometry;t.layers.forEach(function(t){var e=[];t.graphics.forEach(function(t){o.contains(t.geometry)&&(console.log(t),e.push(t))});var n=e.map(function(t){return t.attributes});t.setSelectStatusByModels(n,!1),i.options.onCheckChanged(n,t)}),t.clear()},t.prototype.getLayerById=function(e){var t=this.layers.filter(function(t){return t.id===e});return 0<t.length?t[0]:null},t.prototype.addLayer=function(t){t.options.selectMode=this.options.selectMode,t.options.showInfoWindow=!1,this.layers.push(t)},t.prototype.removeLayer=function(t){t.options.selectMode=o.SelectMode.none;var e=this.layers.indexOf(t);0<=e&&this.layers.splice(e,1)},t.prototype.show=function(){this.element.style.display="black"},t.prototype.hide=function(){this.element.style.display="none"},t.prototype.deleteSelectBar=function(){this.element&&this.element.remove()},t.prototype.showSelectBar=function(){if(this.element)return console.log("\u7ed8\u5236\u63a7\u4ef6\u5df2\u7ecf\u521b\u5efa\uff0c\u4e0d\u53ef\u91cd\u590d\u521b\u5efa\uff01"),void(this.element.style.display="block");var t=this,e=this.flagwindMap.innerMap.root;this.element=document.createElement("div"),this.element.setAttribute("id",this.id),this.element.innerHTML='<div class="edit-btn" title="\u753b\u5706" data-operate="circle"><span class="iconfont icon-draw-circle"></span></div>\n                <div class="edit-btn" title="\u753b\u77e9\u5f62" data-operate="rectangle"><span class="iconfont icon-draw-square"></span></div>\n                <div class="edit-btn" title="\u753b\u591a\u8fb9\u5f62" data-operate="polygon"><span class="iconfont icon-draw-polygon1"></span></div>',e.appendChild(this.element);for(var n=document.querySelectorAll("#"+this.element.id+" .edit-btn"),i=0;i<n.length;i++)n[i].onclick=function(){t.active(this.dataset.operate)}},t.prototype.clear=function(){this.draw&&(this.draw.deactivate(),this.flagwindMap.map.enableMapNavigation(),this.mode="trash")},t.prototype.active=function(t){if(this.draw&&t){var e=t.toUpperCase().replace(/ /g,"_");this.flagwindMap.map.disableMapNavigation(),this.draw.activate(esri.toolbars.Draw[e]),this.mode=t}},t.prototype.destroy=function(){this.clear(),this.deleteSelectBar()},t}(o.EventProvider);o.EsriSelectBox=t}(flagwind||(flagwind={})),tq=flagwind||(flagwind={}),uq=function(){function t(t,e,n,i){this.id=t,this.url=e,this.spatial=n,this.title=i,this.isShow=!0,e&&(this.layer=this.onCreateTiledLayer({url:e,id:t,title:i,spatial:n}))}return t.prototype.appendTo=function(t){this.layer&&this.layer.addToMap(t)},t.prototype.removeLayer=function(t){this.layer&&this.layer.removeFromMap(t)},t.prototype.show=function(){this.isShow=!0,this.layer&&this.layer.show()},t.prototype.hide=function(){this.isShow=!1,this.layer&&this.layer.hide()},t}(),tq.FlagwindTiledLayer=uq,Cq=flagwind||(flagwind={}),Dq=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onCreateTiledLayer=function(t){var e=new esri.layers.ArcGISTiledMapServiceLayer(t.url,{id:t.id});return e.addToMap=function(t){t.addLayer(this)},e.removeFromMap=function(t){t.removeLayer(this)},e},e}(Cq.FlagwindTiledLayer),Cq.EsriTiledLayer=Dq,function(i){i.TRACK_LAYER_OPTIONS={solveMode:"Line",speed:100,onPointChanged:function(t,e){console.log("onPointChanged index:"+t)},onMessageEvent:function(t,e){console.log("onMessageEvent")},onMoveEvent:function(t,e,n,i){console.log("onMoveEvent")},onLineEndEvent:function(t,e,n){console.log("onLineEndEvent")}};var t=function(){function t(t,e,n){var r=this;this.businessLayer=t,this.routeLayer=e,this.options=n,this.isShow=!0,this.options=__assign({},i.TRACK_LAYER_OPTIONS,n),this.businessLayer.removeFormMap(),this.businessLayer.addToMap(),this.id=this.options.id||"flagwind_track_layer",this.id&&(this.activedTrackLineName=this.id+"_track"),e.options.onStationEvent=function(t,e,n,i,o){0===e&&i&&(r.businessLayer.saveGraphicList([n.attributes.__model]),r.options.onPointChanged(e,n.attributes.__model)),i||(r.businessLayer.saveGraphicList([n.attributes.__model]),r.options.onPointChanged(e+1,n.attributes.__model))},e.options.onMoveEvent=function(t,e,n,i){r.options.onMessageEvent("info","\u6b63\u5728\u64ad\u653e"),r.options.onMoveEvent(t,e,n,i)},e.options.onLineEndEvent=function(t,e,n){r.options.onMessageEvent("success","\u64ad\u653e\u7ed3\u675f"),r.options.onLineEndEvent(t,e,n)},e.options.onMovingClick=function(t){r.trackLine.isRunning?r.stop():r.continue()}}return Object.defineProperty(t.prototype,"toolBoxId",{get:function(){return this.id+"_toolbox"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"flagwindMap",{get:function(){return this.businessLayer.flagwindMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRunning",{get:function(){return!!this.trackLine&&this.trackLine.isRunning},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCompleted",{get:function(){return!!this.trackLine&&this.trackLine.isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMovingGraphicHide",{get:function(){return!!this.trackLine&&this.trackLine.isMovingGraphicHide},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trackLine",{get:function(){return this.activedTrackLineName?this.routeLayer.getTrackLine(this.activedTrackLineName):null},enumerable:!0,configurable:!0}),t.prototype.deleteTrackToolBox=function(){this._trackToolBox&&this._trackToolBox.parentNode.removeChild(this._trackToolBox),this._trackToolBox=null,this._playButton=null,this._pauseButton=null,this._speedUpButton=null,this._speedDownButton=null,this._clearButton=null,this._toolBoxText=null},t.prototype.showTrackToolBox=function(){var t=this;if(document.getElementById(this.toolBoxId))return console.log("TrackToolBox\u5df2\u7ecf\u521b\u5efa\uff0c\u4e0d\u53ef\u91cd\u590d\u521b\u5efa\uff01"),void(document.getElementById(this.toolBoxId).style.display="block");this._trackToolBox=document.createElement("div"),this._trackToolBox.setAttribute("id",this.toolBoxId),this._trackToolBox.innerHTML='<div class="tool-btns"><span class="route-btn icon-continue" title="\u64ad\u653e" data-operate="continue"></span>\n                <span class="route-btn icon-pause" title="\u6682\u505c" data-operate="pause" style="display:none;"></span>\n                <span class="route-btn icon-speedDown" title="\u51cf\u901f" data-operate="speedDown"></span>\n                <span class="route-btn icon-speedUp" title="\u52a0\u901f" data-operate="speedUp"></span>\n                <span class="route-btn icon-clear" title="\u6e05\u9664\u8f68\u8ff9" data-operate="clear"></span></div>\n                <div class="tool-text"><span></span></div>',this.flagwindMap.innerMap.container.appendChild(this._trackToolBox),this._playButton=document.querySelector("#"+this.toolBoxId+" .icon-continue"),this._pauseButton=document.querySelector("#"+this.toolBoxId+" .icon-pause"),this._speedUpButton=document.querySelector("#"+this.toolBoxId+" .icon-speedUp"),this._speedDownButton=document.querySelector("#"+this.toolBoxId+" .icon-speedDown"),this._clearButton=document.querySelector("#"+this.toolBoxId+" .icon-clear"),this._toolBoxText=document.querySelector("#"+this.toolBoxId+" .tool-text span"),this._playButton.onclick=function(){t.continue()},this._pauseButton.onclick=function(){t.pause()},this._speedUpButton.onclick=function(){t.speedUp()},this._speedDownButton.onclick=function(){t.speedDown()},this._clearButton.onclick=function(){t.clear()}},t.prototype.showTrack=function(t,e,n){e?this.activedTrackLineName=e:e=this.activedTrackLineName,this.isShow||this.show();var i=__assign({},this.options,n);"Segment"===i.solveMode?this.routeLayer.solveSegment(e,t,i):this.routeLayer.solveLine(e,t,i)},t.prototype.startTrack=function(t,e,n){if(e?this.activedTrackLineName=e:e=this.activedTrackLineName,this.routeLayer.stop(this.activedTrackLineName),this.clear(),null==t||0===t.length)return this.options.onMessageEvent("warning","\u6ca1\u6709\u8f68\u8ff9\u6570\u636e"),void console.warn("\u6ca1\u6709\u8f68\u8ff9\u6570\u636e\uff01");this.showTrack(t,e,n),this.routeLayer.start(this.activedTrackLineName)},t.prototype.move=function(t,e){name?this.activedTrackLineName=e:e=this.activedTrackLineName,this.showTrack(t,e),this.routeLayer.move(this.activedTrackLineName)},t.prototype.clearAll=function(){this.clear()},t.prototype.clear=function(){this.routeLayer.clearAll(),this.businessLayer.clear(),this._trackToolBox&&(this._toolBoxText.innerHTML="")},t.prototype.show=function(){this.isShow=!0,this.routeLayer.show(),this.businessLayer.show()},t.prototype.hide=function(){this.isShow=!1,this.routeLayer.hide(),this.businessLayer.hide()},t.prototype.start=function(){this.options.onMessageEvent("info","\u64ad\u653e"),this.options.onMessageEvent("start","\u64ad\u653e"),this.routeLayer.start(this.activedTrackLineName),this._trackToolBox&&(this._playButton.style.display="none",this._pauseButton.style.display="block",this._toolBoxText.innerHTML="\u5f53\u524d\u72b6\u6001\uff1a\u6b63\u5728\u64ad\u653e")},t.prototype.stop=function(){this.options.onMessageEvent("info","\u5df2\u505c\u6b62"),this.options.onMessageEvent("stop","\u5df2\u505c\u6b62"),this.routeLayer.stop(this.activedTrackLineName),this._trackToolBox&&(this._playButton.style.display="block",this._pauseButton.style.display="none",this._toolBoxText.innerHTML="\u5df2\u505c\u6b62")},t.prototype.pause=function(){this.options.onMessageEvent("info","\u5df2\u6682\u505c"),this.options.onMessageEvent("pause","\u5df2\u6682\u505c"),this.routeLayer.pause(this.activedTrackLineName),this._trackToolBox&&(this._playButton.style.display="block",this._pauseButton.style.display="none",this._toolBoxText.innerHTML="\u5f53\u524d\u72b6\u6001\uff1a\u5df2\u6682\u505c")},t.prototype.continue=function(){this.options.onMessageEvent("continue","\u7ee7\u7eed"),this.routeLayer.continue(this.activedTrackLineName),this._trackToolBox&&(this._playButton.style.display="none",this._pauseButton.style.display="block",this._toolBoxText.innerHTML="\u5f53\u524d\u72b6\u6001\uff1a\u6b63\u5728\u64ad\u653e")},t.prototype.speedUp=function(){this.options.onMessageEvent("speedUp","\u52a0\u901f");var t=this.routeLayer.speedUp(this.activedTrackLineName);return this._trackToolBox&&(this._toolBoxText.innerHTML=t),t},t.prototype.speedDown=function(){this.options.onMessageEvent("speedDown","\u51cf\u901f");var t=this.routeLayer.speedDown(this.activedTrackLineName);return this._trackToolBox&&(this._toolBoxText.innerHTML=t),t},t.prototype.changeSpeed=function(t){this.routeLayer.changeSpeed(this.activedTrackLineName,t)},t.prototype.changeTrackLine=function(t){this.activedTrackLineName=t},t}();i.FlagwindTrackLayer=t}(flagwind||(flagwind={})),Br=flagwind||(flagwind={}),Cr=function(i){function t(t,e){var n=i.call(this,t,new Br.EsriRouteLayer(t.flagwindMap,t.id+"_track",e.route||e),e)||this;return n.businessLayer=t,n}return __extends(t,i),t}(Br.FlagwindTrackLayer),Br.EsriTrackLayer=Cr,(flagwind||(flagwind={})).DRAW_LAYER_OPTIONS={onDrawCompleteEvent:function(t){}},Kr=flagwind||(flagwind={}),Lr=function(){function t(t,e){var n=this;this.options={drawTime:75,showTooltips:!0,tolerance:8,tooltipOffset:15,onEvent:function(t,e){}},this.flagwindMap=t,this.options=__assign({},Kr.DRAW_LAYER_OPTIONS,this.options,e),this.draw=new esri.toolbars.Draw(t.map,this.options),this.draw.on("draw-complete",function(t){return n.onDrawComplete(t)})}return t.prototype.activate=function(t,e){if(this.draw&&e&&this.setSymbol(t,e),this.draw&&t){var n=t.toUpperCase().replace(/ /g,"_");this.draw.activate(esri.toolbars.Draw[n])}},t.prototype.finish=function(){this.draw&&this.draw.deactivate()},t.prototype.setSymbol=function(t,e){switch(this.symbolSetting=__assign({},e),t){case"POLYLINE":this.draw.setLineSymbol(this.lineSymbol);break;case"POLYGON":case"FREEHAND_POLYGON":this.draw.setFillSymbol(this.fillSymbol)}},t.prototype.onDrawComplete=function(t){this.finish(),this.options.onEvent("draw-complete",t.geometry),this.options.onDrawCompleteEvent(t.geometry)},Object.defineProperty(t.prototype,"lineSymbol",{get:function(){var t=this.symbolSetting.lineColor||[255,0,0],e=this.symbolSetting.lineWidth||4,n=this.symbolSetting.lineType||"STYLE_DASH",i=this.symbolSetting.lineMiterLimit||2;return new esri.symbol.CartographicLineSymbol(esri.symbol.CartographicLineSymbol[n],new esri.Color(t),e,esri.symbol.CartographicLineSymbol.CAP_ROUND,esri.symbol.CartographicLineSymbol.JOIN_MITER,i)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillSymbol",{get:function(){var t=this.symbolSetting.lineColor||[151,249,0,.8],e=this.symbolSetting.lineWidth||3,n=this.symbolSetting.lineType||"STYLE_DOT",i=this.symbolSetting.fillType||"STYLE_SOLID",o=this.symbolSetting.fillColor||[255,49,0,.45];return new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol[i],new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol[n],new esri.Color(t),e),new esri.Color(o))},enumerable:!0,configurable:!0}),t}(),Kr.EsriDraw=Lr,js=function(){this.units=.03,this.center=[116.46,39.92],this.wkidFromApp=4326,this.logo=!1,this.slider=!0,this.sliderPosition="bottom-left"},(flagwind||(flagwind={})).EsriSetting=js,(flagwind||(flagwind={})).EDIT_LAYER_OPTIONS={confirm:function(t){window.confirm(t.content)?t.onOk():t.onCancel()},onEditInfo:function(t,e){return new Promise(function(t,e){t(!0)})}},(flagwind||(flagwind={})).HEATMAP_LAYER_OPTIONS={changeStandardModel:function(t){return{longitude:t.longitude||t.x,latitude:t.latitude||t.y}}},(flagwind||(flagwind={})).LOCATION_LAYER_OPTIONS={onMapClick:function(t){console.log("onMapClick")}},function(s){var t,e;s.TRACKSEGMENT_OPTIONS={speed:100,maxSpeed:800,numsOfKilometer:50,autoShowLine:!1,onShowSegmentLineEvent:function(t){console.log("onShowSegmentLineEvent")},onMoveStartEvent:function(t,e,n){console.log("onMoveStartEvent")},onMoveEndEvent:function(t,e,n){console.log("onMoveEndEvent")},onMoveEvent:function(t,e,n){console.log("onMoveEvent")}},(t=s.SelectMode||(s.SelectMode={}))[t.none=0]="none",t[t.single=1]="single",t[t.multiple=2]="multiple",(e=s.LayerType||(s.LayerType={})).point="point",e.polyline="polyline",e.polygon="polygon";var n=function(){function t(t,e,n,i,o,r){this.flagwindRouteLayer=t,this.index=e,this.name=n,this.startGraphic=i,this.endGraphic=o,this.options=r,this.position=-1,this.isCompleted=!1,this.isRunning=!1,this.time=200,this.waypoints=[],this.options=__assign({},s.TRACKSEGMENT_OPTIONS,r)}return t.prototype.setPolyLine=function(t,e){this.flagwindRouteLayer.onSetSegmentByLine({polyline:t,length:e},this),this.speed||this.changeSpeed(),this.options.onShowSegmentLineEvent(this)},t.prototype.setMultPoints=function(t){this.flagwindRouteLayer.onSetSegmentByPoint({points:t,spatial:this.flagwindRouteLayer.flagwindMap.spatial},this),this.speed||this.changeSpeed(),console.debug("\u8def\u6bb5"+this.index+"\u957f\u5ea6\uff1a"+this.length+"km"),console.debug("\u8def\u6bb5"+this.index+"\u53d6\u70b9\uff1a"+this.line.length+"\u4e2a"),console.debug("\u8def\u6bb5"+this.index+"\u901f\u5ea6\uff1a"+this.speed+"km/h"),console.debug("\u8def\u6bb5"+this.index+"\u5b9a\u65f6\uff1a"+this.time+"ms"),this.options.onShowSegmentLineEvent(this)},t.prototype.changeSpeed=function(t){void 0===t&&(t=null),0===this.options.numsOfKilometer||0===this.line.length?(this.speed=1e7,this.time=1):(this.speed=t||this.options.speed,this.time=3600*(this.length||0)/(15*(this.speed||100)*this.line.length)),this.timer&&(this.pause(),this.start())},t.prototype.move=function(){this.position=this.position+1;var t=0;if(0===this.position)return 1<this.line.length&&(t=s.MapUtils.getAngle(this.startGraphic.geometry,{x:this.line[0][0],y:this.line[0][1]})||0),this.options.onMoveStartEvent(this,this.startGraphic,t),void this.options.onMoveEvent(this,[this.startGraphic.geometry.x,this.startGraphic.geometry.y],t);if(this.position>=this.line.length)return 1<this.line.length&&(t=s.MapUtils.getAngle({x:this.line[this.line.length-1][0],y:this.line[this.line.length-1][1]},this.endGraphic.geometry)||0),this.isCompleted=!0,this.stop(),this.options.onMoveEvent(this,[this.endGraphic.geometry.x,this.endGraphic.geometry.y],t),void this.options.onMoveEndEvent(this,this.endGraphic,t);t=s.MapUtils.getAngle({x:this.line[this.position-1][0],y:this.line[this.position-1][1]},{x:this.line[this.position][0],y:this.line[this.position][1]});var e=parseFloat(this.line[this.position-1][0]).toFixed(5),n=parseFloat(this.line[this.position-1][1]).toFixed(5);this.options.onMoveEvent(this,[e,n],t)},t.prototype.start=function(){var t=this;return this.isRunning=!0,this.timer=window.setInterval(function(){t.line?t.move():console.log("\u7ebf\u8def"+t.name+"\u7684\u7b2c"+(t.index+1)+"\u8def\u6bb5\u7b49\u5f85\u8bbe\u7f6e")},this.time),!0},Object.defineProperty(t.prototype,"isPaused",{get:function(){return!this.timer&&this.isRunning},enumerable:!0,configurable:!0}),t.prototype.pause=function(){window.clearInterval(this.timer),this.timer=null},t.prototype.stop=function(){this.timer&&window.clearInterval(this.timer),this.timer=null,this.isRunning=!1,this.position=-1},t.prototype.reset=function(){this.timer=null,this.isRunning=!1,this.position=-1,this.isCompleted=!1},t}();s.TrackSegment=n;var i=function(){function t(t,e,n){this.flagwindMap=t,this.name=e,this.options=n,this.segments=[],this.isMovingGraphicHide=!1,this.options=__assign({},s.TRACKSEGMENT_OPTIONS,n)}return Object.defineProperty(t.prototype,"activeCompletedSegment",{get:function(){var t=null;if(0!==this.segments.length){for(var e=0;e<this.segments.length;e++){var n=this.segments[e];n.isCompleted&&(null==t||n.index>t.index)&&(t=n)}return t}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextSegmentIndex",{get:function(){if(0===this.segments.length)return 0;for(var t=0,e=0;e<this.segments.length;e++){var n=this.segments[e];n.index>t&&(t=n.index)}return 0<t&&(t+=1),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastSegment",{get:function(){if(0===this.segments.length)return null;for(var t=null,e=0;e<this.segments.length;e++){var n=this.segments[e];(!t||n.index>t.index)&&(t=n)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRunning",{get:function(){if(0===this.segments.length)return!1;for(var t=0;t<this.segments.length;t++){if(!0===this.segments[t].isRunning)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCompleted",{get:function(){if(0===this.segments.length)return!1;for(var t=0;t<this.segments.length;t++){if(!1===this.segments[t].isCompleted)return!1}return!0},enumerable:!0,configurable:!0}),t.prototype.hideMovingGraphic=function(){this.isMovingGraphicHide=!0,this.markerGraphic.hide()},t.prototype.showMovingGraphic=function(){this.isMovingGraphicHide&&(this.isMovingGraphicHide=!1,this.markerGraphic.show())},t.prototype.changeSpeed=function(t){if(0!==this.segments.length)for(var e=0;e<this.segments.length;e++){this.segments[e].changeSpeed(t)}},t.prototype.speedUp=function(){return this.speed||(this.speed=this.options.speed),this.speed<this.options.maxSpeed&&(this.speed=Math.max(2*this.speed,this.options.speed),this.changeSpeed(this.speed)),"\u5f53\u524d\u72b6\u6001\uff1a"+this.speed/this.options.speed+"\u500d\u64ad\u653e"},t.prototype.speedDown=function(){return this.speed||(this.speed=this.options.speed),this.speed=Math.max(this.speed/2,this.options.speed),this.changeSpeed(this.speed),"\u5f53\u524d\u72b6\u6001\uff1a"+this.speed/this.options.speed+"\u500d\u64ad\u653e"},t.prototype.start=function(){if(!this.isRunning){for(var t=this.segments[0],e=0;e<this.segments.length;e++){var n=this.segments[e];t.index>n.index&&(t=n)}t.start()}},t.prototype.stop=function(){for(var t=0;t<this.segments.length;t++){this.segments[t].stop()}},t.prototype.reset=function(){for(var t=0;t<this.segments.length;t++){this.segments[t].reset()}},t.prototype.pause=function(){for(var t=0;t<this.segments.length;t++){var e=this.segments[t];if(e.isRunning)return void e.pause()}},t.prototype.continue=function(){this.isRunning||this.start();for(var t=0;t<this.segments.length;t++){var e=this.segments[t];if(e.isRunning&&!e.timer)return void e.start()}},t.prototype.move=function(){if(!this.isRunning){var t=this.activeCompletedSegment,e=null;(e=t?this.getSegment(t.index+1):this.getSegment(0))&&e.start()}},t.prototype.add=function(t){this.segments.push(t)},t.prototype.getNextSegment=function(t){return 0===this.segments.length?null:this.getSegment(t+1)},t.prototype.getSegment=function(t){var e=null;if(0===this.segments.length)return null;for(var n=0;n<this.segments.length;n++){var i=this.segments[n];i.name===this.name&&i.index===t&&(e=i)}return e},t}();s.TrackLine=i}(flagwind||(flagwind={})),Mt=flagwind||(flagwind={}),Nt=function(){function u(){}return u.density=function(t,e,n){var i=[];if(0===n)return i.push(t),i.push(e),i;for(var o=(e.x-t.x)/n,r=(e.y-t.y)/n,s=0;s<n;s++)i.push(new Mt.MinemapPoint(t.x+s*o,t.y+s*r));return i.push({x:e.x,y:e.y}),i},u.extractPoints=function(t,e,n){var i=[];if(0===n)return i.push({x:t.x,y:t.y}),i.push({x:e.x,y:e.y}),i;for(var o=(e.x-t.x)/n,r=(e.y-t.y)/n,s=0;s<n;s++)i.push({x:t.x+s*o,y:t.y+s*r});return i.push({x:e.x,y:e.y}),i},u.vacuate=function(t,e,n){if(0===n){var i=t[0],o=t[t.length-1];return[i[0],o[o.length-1]]}for(var r=[],s=0;s<t.length;s++)r=r.concat(t[s]);var a=e*n;if(r.length>a){for(var l=0,p=Math.max(Math.floor(r.length/a),1),h=[];l<a;)h.push(r[l]),l+=p;return l!==r.length-1&&h.push(r[r.length-1]),h}return r},u.isEqualPoint=function(t,e){return null==t&&null==e&&(t.x===e.x&&t.y===e.y)},u.getAngle=function(t,e){var n=t.x,i=t.y,o=e.x-n,r=e.y-i;return 0<o&&0<=r?Math.round(Math.atan(r/o)/Math.PI*180):0<o&&r<0?360+Math.round(Math.atan(r/o)/Math.PI*180):o<0&&0<=r?180+Math.round(Math.atan(r/o)/Math.PI*180):o<0&&r<0?180+Math.round(Math.atan(r/o)/Math.PI*180):0===o?90:0},u.validGeometryModel=function(t){return t.longitude&&t.latitude},u.delta=function(t,e){var n=.006693421622965943,i=u.transformLat(e-105,t-35),o=u.transformLon(e-105,t-35),r=t/180*u.PI,s=Math.sin(r);s=1-n*s*s;var a=Math.sqrt(s);return{lat:i=180*i/(6378245*(1-n)/(s*a)*u.PI),lon:o=180*o/(6378245/a*Math.cos(r)*u.PI)}},u.point25To2=function(t,e){var n=629486.1,i=850786,o=106392700,r=321586.1,s=380061.7;return{lat:(0-r*t-n*e+23949170*n-o*r)/(0-i*r-n*s),lon:(s*t-i*e+23949170*i+s*o)/(n*s+i*r)}},u.point2To25=function(t,e){return{lat:380061.7*e-321586.1*t+23949170,lon:629486.1*t+850786*e-106392700}},u.mercatorUnproject=function(t,e){for(var n=180/Math.PI,i=6378137,o=.9966471893352525,r=Math.sqrt(1-o*o),s=Math.exp(-e/i),a=Math.PI/2-2*Math.atan(s),l=.1,p=0,h=0;h<15&&1e-7<Math.abs(l);h++)p=r*Math.sin(a),p=Math.pow((1-p)/(1+p),r/2),a+=l=Math.PI/2-2*Math.atan(s*p)-a;return{lat:a*n,lon:t*n/i}},u.gcj_encrypt=function(t,e){if(u.outOfChina(t,e))return{lat:t,lon:e};var n=u.delta(t,e);return{lat:t+n.lat,lon:e+n.lon}},u.gcj_decrypt=function(t,e){if(u.outOfChina(t,e))return{lat:t,lon:e};var n=u.delta(t,e);return{lat:t-n.lat,lon:e-n.lon}},u.gcj_decrypt_exact=function(t,e){for(var n,i,o=.01,r=.01,s=t-o,a=e-r,l=t+o,p=e+r,h=0;;){var c=u.gcj_encrypt(n=(s+l)/2,i=(a+p)/2);if(o=c.lat-t,r=c.lon-e,Math.abs(o)<1e-9&&Math.abs(r)<1e-9)break;if(0<o?l=n:s=n,0<r?p=i:a=i,1e4<++h)break}return{lat:n,lon:i}},u.bd_encrypt=function(t,e){var n=e,i=t,o=Math.sqrt(n*n+i*i)+2e-5*Math.sin(i*u.X_PI),r=Math.atan2(i,n)+3e-6*Math.cos(n*u.X_PI),s=o*Math.cos(r)+.0065;return{lat:o*Math.sin(r)+.006,lon:s}},u.bd_decrypt=function(t,e){var n=e-.0065,i=t-.006,o=Math.sqrt(n*n+i*i)-2e-5*Math.sin(i*u.X_PI),r=Math.atan2(i,n)-3e-6*Math.cos(n*u.X_PI),s=o*Math.cos(r);return{lat:o*Math.sin(r),lon:s}},u.mercator_encrypt=function(t,e){var n=20037508.34*e/180,i=Math.log(Math.tan((90+t)*u.PI/360))/(u.PI/180);return{lat:i=20037508.34*i/180,lon:n}},u.lonlat2mercator=function(t,e){var n={lon:0,lat:0},i=20037508.34*e/180,o=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return o=20037508.34*o/180,n.lon=i,n.lat=o,n},u.mercator2lonlat=function(t,e){var n={lon:0,lat:0},i=e/20037508.34*180,o=t/20037508.34*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),n.lon=i,n.lat=o,n},u.mercator_decrypt=function(t,e){var n=e/20037508.34*180,i=t/20037508.34*180;return{lat:i=180/u.PI*(2*Math.atan(Math.exp(i*u.PI/180))-u.PI/2),lon:n}},u.distance=function(t,e,n,i){var o=Math.cos(t*u.PI/180)*Math.cos(n*u.PI/180)*Math.cos((e-i)*u.PI/180)+Math.sin(t*u.PI/180)*Math.sin(n*u.PI/180);return 1<o&&(o=1),o<-1&&(o=-1),6371e3*Math.acos(o)},u.outOfChina=function(t,e){return e<72.004||137.8347<e||(t<.8293||55.8271<t)},u.transformLat=function(t,e){var n=2*t-100+3*e+.2*e*e+.1*t*e+.2*Math.sqrt(Math.abs(t));return n+=2*(20*Math.sin(6*t*u.PI)+20*Math.sin(2*t*u.PI))/3,n+=2*(20*Math.sin(e*u.PI)+40*Math.sin(e/3*u.PI))/3,n+=2*(160*Math.sin(e/12*u.PI)+320*Math.sin(e*u.PI/30))/3},u.transformLon=function(t,e){var n=300+t+2*e+.1*t*t+.1*t*e+.1*Math.sqrt(Math.abs(t));return n+=2*(20*Math.sin(6*t*u.PI)+20*Math.sin(2*t*u.PI))/3,n+=2*(20*Math.sin(t*u.PI)+40*Math.sin(t/3*u.PI))/3,n+=2*(150*Math.sin(t/12*u.PI)+300*Math.sin(t/30*u.PI))/3},u.PI=3.141592653589793,u.X_PI=52.35987755982988,u}(),Mt.MapUtils=Nt,Ew=flagwind||(flagwind={}),Fw=function(){function t(t){if(!t)throw new Ew.ArgumentException("items");this._index=0,this._current=void 0,this._items=t}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),t.prototype.next=function(){var t=this._items;return this._index<t.length&&(this._current=t[this._index++],!0)},t}(),Ew.Enumerator=Fw,Jw=flagwind||(flagwind={}),Kw=function(){function t(t,e){this._key=t,this._value=e}return Object.defineProperty(t.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return"["+(this._key||"")+", "+(this._value||"")+"]"},t}(),Jw.KeyValuePair=Kw,Ow=flagwind||(flagwind={}),Pw=function(){function i(){this._keys=[],this._values=[]}return Object.defineProperty(i.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),i.prototype.set=function(t,e){var n=this._keys,i=n.indexOf(t);return-1===i&&(n[i=n.length]=t),this._values[i]=e,this},i.prototype.get=function(t){var e=this._keys.indexOf(t);return-1!==e?this._values[e]:void 0},i.prototype.has=function(t){return-1!==this._keys.indexOf(t)},i.prototype.delete=function(t){var e=this._keys.indexOf(t);return-1!==e&&(this._keys.splice(e,1),this._values.splice(e,1),!0)},i.prototype.clear=function(){this._keys.length=0,this._values.length=0},i.prototype.getEnumerator=function(){var t=this.entries();return new Ow.Enumerator(t)},i.prototype.forEach=function(t,e){for(var n=this._keys,i=this._values,o=0,r=n.length;o<r;o++)t.call(e,new Ow.KeyValuePair(n[o],i[o]),this)},i.prototype.keys=function(){return this._keys},i.prototype.values=function(){return this._values},i.prototype.entries=function(){var n=new Array;return this.forEach(function(t,e){n.push(new Ow.KeyValuePair(t.key,t.value))}),n},i.prototype.toString=function(){var n=Object.create(null);return this.forEach(function(t,e){n[t.key]=t.value}),JSON.stringify(n)},i.of=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(null==t)return null;var n=new i;return t.forEach(function(t){if(!(t instanceof Array))throw new Ow.Exception("\u53c2\u6570\u4e0d\u6b63\u786e");var e=t;n.set(e[0],e[1])}),n},i}(),Ow.Map=Pw,qx=flagwind||(flagwind={}),rx=function(){function t(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._values=[],(t=this._values).push.apply(t,e)}return Object.defineProperty(t.prototype,"size",{get:function(){return this._values.length},enumerable:!0,configurable:!0}),t.prototype.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,i=t;n<i.length;n++){var o=i[n];this.has(o)||this._values.push(o)}return this},t.prototype.get=function(t){return this._values[t]},t.prototype.set=function(t,e){var n=this._values;0<=t&&t<n.length&&(this.has(e)||(n[t]=e))},t.prototype.delete=function(t){var e=this._values,n=e.indexOf(t);return-1!==n&&(e.splice(n,1),!0)},t.prototype.deleteAt=function(t){var e=this._values;0<=t&&t<e.length&&e.splice(t,1)},t.prototype.clear=function(){this._values.length=0},t.prototype.indexOf=function(t,e){return this._values.indexOf(t,e)},t.prototype.has=function(t){return-1!==this._values.indexOf(t)},t.prototype.getEnumerator=function(){return new qx.Enumerator(this._values)},t.prototype.forEach=function(){for(var t=this._values,e=arguments[0],n=arguments[1],i=2===e.length,o=0,r=t.length;o<r;o++)i?e.call(n,t[o],this):e.call(n,t[o],o,this)},t.prototype.find=function(t,e){for(var n=this._values,i=0,o=n.length;i<o;i++)if(t.call(e,n[i],i,this))return n[i]},t.prototype.sort=function(t){var e=this._values;this._values=e.sort(t)},t.prototype.union=function(t){var e=t.values();return 0<e.length&&this.add.apply(this,e),this},t.prototype.values=function(){return this._values.concat()},t.prototype.toString=function(){return Array.prototype.toString.call(this._values)},t}(),qx.Set=rx,ay=flagwind||(flagwind={}),by=function(){function t(t,e){if(!t)throw new ay.ArgumentException;this._type=t,this._data=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this._source},set:function(t){if(!t)throw new ay.ArgumentException;this._source=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),t}(),ay.EventArgs=by,hy=flagwind||(flagwind={}),iy=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._cancel=!1,t}return __extends(t,e),Object.defineProperty(t.prototype,"cancel",{get:function(){return this._cancel},set:function(t){this._cancel=t},enumerable:!0,configurable:!0}),t}(hy.EventArgs),hy.CancelEventArgs=iy,ny=flagwind||(flagwind={}),oy=function(){function t(){this._providers=new ny.Map}return Object.defineProperty(t.prototype,"providers",{get:function(){return this._providers},enumerable:!0,configurable:!0}),Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.getProvider=function(t){if(!t)throw new ny.ArgumentException;var e=this._providers.get(t);return e||(e=this.createProvider(t),this._providers.set(t,e)),e},t.prototype.createProvider=function(t){return new ny.EventProvider(t)},t}(),ny.EventProviderFactory=oy,ty=flagwind||(flagwind={}),uy=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(Error),ty.Exception=uy,yy=flagwind||(flagwind={}),zy=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(yy.Exception),yy.ArgumentException=zy,Dy=flagwind||(flagwind={}),Ey=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(Dy.Exception),Dy.InvalidOperationException=Ey,Iy=flagwind||(flagwind={}),Jy=function(n){function t(t){var e=n.call(this,null)||this;return e.kind="circle",e.id=t.id,e.attributes=t.attributes,e.symbol=t.symbol,e.circle=new minemap.Polyline(t.path,e.symbol),e._geometry=new Iy.MinemapCircle,e._geometry.center=t.center,e._geometry.radius=t.radius,e}return __extends(t,n),Object.defineProperty(t.prototype,"isInsided",{get:function(){return this._isInsided},enumerable:!0,configurable:!0}),t.prototype.show=function(){if(!this.layer)throw new Iy.Exception("\u8be5\u8981\u7d20\u6ca1\u6709\u6dfb\u52a0\u5230\u56fe\u5c42\u4e0a\uff0c\u82e5\u60f3\u663e\u793a\u8be5\u8981\u7d20\u8bf7\u8c03\u7528addToMap\u65b9\u6cd5");this.circle.addTo(this.layer.map),this.isShow=!1},t.prototype.hide=function(){this.circle.remove(),this.isShow=!1},t.prototype.remove=function(){this._isInsided&&(this.circle.remove(),this._isInsided=!1)},t.prototype.delete=function(){this._isInsided&&(this.circle.remove(),this._isInsided=!1),this.layer&&this.layer.remove(this)},t.prototype.setSymbol=function(t){this.symbol=t,this.symbol&&this.symbol.strokeColor&&this.circle.setStrokeColor(this.symbol.strokeColor),this.symbol&&this.symbol.fillOpacity&&this.circle.setFillOpacity(this.symbol.fillOpacity),this.symbol&&this.symbol.strokeOpacity&&this.circle.setStrokeOpacity(this.symbol.strokeOpacity),this.symbol&&this.symbol.strokeDashArray&&this.circle.setStrokeDashArray(this.symbol.strokeDashArray),this.symbol&&this.symbol.ay&&this.circle.ay(this.symbol.ay)},t.prototype.setGeometry=function(t){this._geometry=t,this.circle.setCenter(t.center),this.circle.setRadius(t.radius)},Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),t.prototype.addTo=function(t){this._isInsided=!0,this.circle.addTo(t)},t.prototype.setAngle=function(t){throw new Iy.Exception("\u672a\u5b9e\u73b0setAngle\u65b9\u6cd5")},t}(Iy.EventProvider),Iy.MinemapCircleGraphic=Jy,Sy=flagwind||(flagwind={}),Ty=function(){function t(t){this.flagwindMap=t,this.enabled=!1}return t.prototype.startup=function(t){throw new Error("\u672a\u5b9e\u73b0")},t.prototype.enable=function(){throw new Error("\u672a\u5b9e\u73b0")},t.prototype.disable=function(){throw new Error("\u672a\u5b9e\u73b0")},t}(),Sy.MinemapContextMenu=Ty,Xy=flagwind||(flagwind={}),Yy=function(){function t(t,e){this.businessLayer=t,this.draggingFlag=!1,this.cursorOverPointFlag=!1,this.isShow=!0,this.options=__assign({EDIT_LAYER_OPTIONS:Xy.EDIT_LAYER_OPTIONS},e)}return Object.defineProperty(t.prototype,"map",{get:function(){return this.businessLayer.flagwindMap.map},enumerable:!0,configurable:!0}),t.prototype.appendTo=function(t){this.graphic.addTo(t)},t.prototype.removeLayer=function(t){this.graphic.remove()},t.prototype.show=function(){this.graphic.show(),this.isShow=!0},t.prototype.hide=function(){this.graphic.show(),this.isShow=!1},t.prototype.registerEvent=function(t){var e=this;t.on("onMouseOver",function(t){e.cursorOverPointFlag=!0}),t.on("onMouseOut",function(t){e.cursorOverPointFlag=!1,e.map.dragPan.enable()}),t.on("onMouseDown",function(t){e.cursorOverPointFlag&&(e.draggingFlag=!0,console.log("test---\x3eonMouseDown"),window._editLayer=e,console.log("test---\x3emap.on.mousemove"),e.map.on("mousemove",e.mouseMovePoint),e.map.dragPan.disable())}),t.on("onMouseUp",function(t){console.log("test---\x3eonMouseUp"),e.draggingFlag&&(e.draggingFlag=!1,console.log("test---\x3emap.off.mousemove"),e.map.off("mousemove",e.mouseMovePoint),window._editLayer=null,e.updatePoint())})},t.prototype.updatePoint=function(){var t=confirm("\u786e\u5b9a\u8981\u66f4\u65b0\u5750\u6807\u4e3ax:"+this.graphic.geometry.x+",y:"+this.graphic.geometry.y);if(t){var e=this.businessLayer.getGraphicById(this.graphic.attributes.id);e.setGeometry(new Xy.MinemapPoint(this.graphic.geometry.x,this.graphic.geometry.y,e.geometry.spatial));var n=this.businessLayer.flagwindMap.onFormPoint(this.graphic.geometry);this.onChanged({key:this.graphic.attributes.id,longitude:n.longitude,latitude:n.latitude},t)}else this.cancelEdit(this.graphic.attributes.id)},t.prototype.mouseMovePoint=function(t){var e=window._editLayer;if(e&&(console.log("test--\x3estatus  over:"+e.cursorOverPointFlag+".drag:"+e.draggingFlag),e.draggingFlag)){console.log("test--\x3eupdate  x:"+t.lngLat.lng+".y:"+t.lngLat.lat);var n=new Xy.MinemapPoint(t.lngLat.lng,t.lngLat.lat);e.graphic.geometry=n}},t.prototype.activateEdit=function(t){var e=this.businessLayer.getGraphicById(t);e&&(this.graphic=e.clone(e.id+"_copy")),this.businessLayer.hide(),this.graphic.addTo(this.map),this.registerEvent(this.graphic)},t.prototype.cancelEdit=function(t){this.graphic.remove(),this.map.off("mousemove",this.mouseMovePoint),this.businessLayer.show(),this.map.dragPan.enable(),this.cursorOverPointFlag=!1,this.draggingFlag=!1},t.prototype.onChanged=function(t,e){return new Promise(function(t,e){t(!0)})},t}(),Xy.MinemapEditLayer=Yy,vz=flagwind||(flagwind={}),wz=function(n){function t(t){var e=n.call(this)||this;return e.options=t,e.GRAPHICS_MAP=new vz.Map,e._isInsided=!1,e.isShow=!0,e.id=t.id,e}return __extends(t,n),Object.defineProperty(t.prototype,"isInsided",{get:function(){return this._isInsided},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return 0===this.GRAPHICS_MAP.size?new Array:this.GRAPHICS_MAP.values()},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,n,i){void 0===n&&(n=this),void 0===i&&(i=!1),this.addListener(t,e,n,i)},t.prototype.off=function(t,e,n){void 0===n&&(n=this),this.removeListener(t,e,n)},t.prototype.show=function(){this.GRAPHICS_MAP.forEach(function(t){t.value.isShow||t.value.show()}),this.isShow=!0},t.prototype.hide=function(){this.GRAPHICS_MAP.forEach(function(t){t.value.isShow&&t.value.hide()}),this.isShow=!0},t.prototype.remove=function(t){this.GRAPHICS_MAP.delete(t.attributes.id),t.isInsided&&t.delete()},t.prototype.clear=function(){this.GRAPHICS_MAP.forEach(function(t){return t.value.remove()}),this.GRAPHICS_MAP.clear()},t.prototype.add=function(t){this.GRAPHICS_MAP.set(t.attributes.id,t),(t.layer=this).map&&t.addTo(this.map)},t.prototype.appendTo=function(t){return this.addToMap(t)},t.prototype.removeLayer=function(t){return this.removeFromMap(t)},t.prototype.addToMap=function(e){this.map||this.GRAPHICS_MAP.forEach(function(t){t.value.addTo(e)}),this.map=e,this.isShow=!0,this._isInsided=!0},t.prototype.removeFromMap=function(t){this.GRAPHICS_MAP.forEach(function(t){t.value.remove()}),this._isInsided=!1},t}(vz.EventProvider),vz.MinemapGraphicsLayer=wz,Tz=flagwind||(flagwind={}),Uz=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.addListener=function(t,e,n,i){this.layer.addListener(t,e,n,i)},e.prototype.removeListener=function(t,e,n){this.layer.removeListener(t,e,n)},e.prototype.hasListener=function(t){return this.layer.hasListener(t)},e.prototype.dispatchEvent=function(t,e){return this.layer.dispatchEvent(t,e)},e.prototype.onCreateGraphicsLayer=function(t){return new Tz.MinemapGraphicsLayer(t)},e}(Tz.FlagwindGroupLayer),Tz.MinemapGroupLayer=Uz,gA=flagwind||(flagwind={}),hA=function(){function t(t,e){this.flagwindMap=t,this.isShow=!1,this.options=__assign({},gA.HEATMAP_LAYER_OPTIONS,e),this.dataMap=new gA.Map,this.chartOptions={GLMap:{roam:!0},coordinateSystem:"GLMap",title:{text:e.title||"\u70ed\u529b\u56fe\u5c55\u793a",subtext:"",left:"center",textStyle:{color:"#fff"}},tooltip:{trigger:"item"},visualMap:{show:!1,top:"top",min:0,max:10,seriesIndex:0,calculable:!0,inRange:{color:["blue","blue","green","yellow","red"]}},series:[{type:"heatmap",data:[],coordinateSystem:"GLMap",pointSize:8,blurSize:12}]}}return Object.defineProperty(t.prototype,"echartslayer",{get:function(){return null==this._echartslayer&&(this._echartslayer=minemap.Template.create({map:this.flagwindMap.map,type:"heatmap"})),this._echartslayer},enumerable:!0,configurable:!0}),t.prototype.appendTo=function(t){throw new Error("Method not implemented.")},t.prototype.removeLayer=function(t){throw new Error("Method not implemented.")},t.prototype.resize=function(){this.echartslayer.resize()},t.prototype.clear=function(){this.dataMap.clear(),this.chartOptions.series[0].data=[],this.echartslayer.chart.setOption(this.chartOptions)},t.prototype.show=function(){this.isShow=!0,this.echartslayer._container.style.display=""},t.prototype.hide=function(){this.isShow=!1,this.echartslayer._container.style.display="none"},t.prototype.showDataList=function(t){this.chartOptions.series[0].data=this.onChangeStandardModel(t),this.echartslayer.chart.setOption(this.chartOptions)},t.prototype.onChangeStandardModel=function(t){var o=this;return t.forEach(function(t){var e=o.options.changeStandardModel(t);if(e){var n=e.longitude+":"+e.latitude,i=o.dataMap.get(n);void 0!==i?(i.members.push(t),i.count=i.count+(e.count||1)):(i={longitude:e.longitude,latitude:e.latitude,members:[t],count:e.count||1},o.dataMap.set(n,i))}}),this.dataMap.values()},t}(),gA.MinemapHeatmapLayer=hA,uA=flagwind||(flagwind={}),vA=function(n){function t(t){var e=n.call(this,null)||this;return e.kind="label",e.id=t.id,e.attributes=t.attributes,e.symbol=t.symbol,t.point&&(e._geometry=new uA.MinemapPoint(t.point.x,t.point.y)),t.geometry&&(e._geometry=t.geometry),e.label=new minemap.Symbol([e._geometry.x,e._geometry.y],t.symbol),e}return __extends(t,n),Object.defineProperty(t.prototype,"isInsided",{get:function(){return this._isInsided},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},set:function(t){this._geometry=t,this.label.setPoint([t.x,t.y])},enumerable:!0,configurable:!0}),t.prototype.show=function(){if(!this.layer)throw new uA.Exception("\u8be5\u8981\u7d20\u6ca1\u6709\u6dfb\u52a0\u5230\u56fe\u5c42\u4e0a\uff0c\u82e5\u60f3\u663e\u793a\u8be5\u8981\u7d20\u8bf7\u8c03\u7528addToMap\u65b9\u6cd5");this.label.addTo(this.layer.map),this.isShow=!1},t.prototype.hide=function(){this.label.remove(),this.isShow=!1},t.prototype.remove=function(){this._isInsided&&(this.label.remove(),this._isInsided=!1)},t.prototype.delete=function(){this._isInsided&&(this.label.remove(),this._isInsided=!1),this.layer&&this.layer.remove(this)},t.prototype.setSymbol=function(t){this.symbol=t,this.symbol&&this.symbol.textColor&&this.label.setTextColor(this.symbol.textColor),this.symbol&&this.symbol.textOffset&&this.label.setTextOffset(this.symbol.textOffset),this.symbol&&this.symbol.text&&this.label.setText(this.symbol.text),this.symbol&&this.symbol.icon&&this.label.setIcon(this.symbol.icon),this.symbol&&this.symbol.symbolSize&&this.label.setSymbolSize(this.symbol.symbolSize),this.symbol&&this.symbol.opacity&&this.label.setOpacity(this.symbol.opacity)},t.prototype.setGeometry=function(t){this._geometry=t,this.label.setPoint([t.x,t.y])},t.prototype.addTo=function(t){this._isInsided=!0,this.label.addTo(t)},t.prototype.setAngle=function(t){throw new uA.Exception("\u672a\u5b9e\u73b0setAngle\u65b9\u6cd5")},t}(uA.EventProvider),uA.MinemapLabelGraphic=vA,function(t){var e=function(t,e){this.type=t,this.spatial=e},n=function(n){function t(t){void 0===t&&(t=null);var e=n.call(this,"Polyline",t)||this;return e.path=[],e}return __extends(t,n),t.prototype.getPoint=function(t){return this.path[t]},t.prototype.insertPoint=function(t,e){this.path.splice(t,0,e)},t.prototype.removePoint=function(t){this.path.splice(t,1)},t.prototype.toJson=function(){return{type:"geojson",data:{type:"Feature",properties:this.attributes||{},geometry:{type:"LineString",coordinates:this.path}}}},t}(t.MinemapGeometry=e);t.MinemapPolyline=n;var i=function(n){function t(t){void 0===t&&(t=null);var e=n.call(this,"Line",t)||this;return e.rings=[],e}return __extends(t,n),t.prototype.addRing=function(t){this.rings.push(t)},t.prototype.removeRing=function(t){if(t>this.rings.length)throw new Error("\u6570\u7ec4\u8d8a\u754c");this.rings=this.rings.splice(t,1)},t.prototype.getPoint=function(t,e){if(t>this.rings.length)throw new Error("\u6570\u7ec4\u8d8a\u754c");return this.rings[t][e]},t.prototype.insertPoint=function(t,e,n){if(t>this.rings.length)throw new Error("\u6570\u7ec4\u8d8a\u754c");this.rings[t].splice(e,0,n)},t.prototype.removePoint=function(t,e){if(t>this.rings.length)throw new Error("\u6570\u7ec4\u8d8a\u754c");this.rings[t].splice(e,1)},t.prototype.inside=function(t){for(var e=t[0],n=t[1],i=this.rings[0],o=!1,r=0,s=i.length-1;r<i.length;s=r++){var a=i[r][0],l=i[r][1],p=i[s][0],h=i[s][1];n<l!=n<h&&e<(p-a)*(n-l)/(h-l)+a&&(o=!o)}return o},t.prototype.toJson=function(){return{type:"geojson",data:{type:"Feature",properties:this.attributes||{},geometry:{type:"Polygon",coordinates:this.rings}}}},t}(e);t.MinemapPolygon=i;var o=function(n){function t(t){void 0===t&&(t=null);var e=n.call(this,"Circle",t)||this;return e.center=[],e}return __extends(t,n),t.prototype.toJson=function(){return{type:"geojson",data:{type:"Feature",properties:this.attributes||{radius:this.radius},geometry:{type:"Point",coordinates:this.center}}}},t.prototype.inside=function(t){var e=new r(this.center[0],this.center[1]),n=new r(t[0],t[1]);return turf.distance(e.toJson(),n.toJson(),"meters")<=this.radius},t}(e);t.MinemapCircle=o;var r=function(o){function t(t,e,n){void 0===n&&(n=null);var i=o.call(this,"Point",n)||this;return i.x=t,i.y=e,i.spatial=n,i}return __extends(t,o),t.prototype.toJson=function(){return{type:"Feature",properties:this.attributes||{},geometry:{type:"Point",coordinates:[this.x,this.y]}}},t}(e);t.MinemapPoint=r;var s=function(t){this.wkid=t};t.MinemapSpatial=s}(flagwind||(flagwind={})),LB=flagwind||(flagwind={}),MB=function(i){function t(t,e){var n=i.call(this,e)||this;return n.flagwindMap=t,n.options=__assign({},LB.LOCATION_LAYER_OPTIONS,n.options),n.appendTo(t.map),n.registerEvent(),n}return __extends(t,i),t.prototype.registerEvent=function(){var e=this;this.flagwindMap.on("onClick",function(t){e.point=new LB.MinemapPoint(t.data.lngLat.lng,t.data.lngLat.lat),e.locate()},this)},t.prototype.locate=function(){this.clear();var t=new LB.MinemapPointGraphic({id:"flagwind_map_location",type:"Point",geometry:this.point,symbol:{className:"flagwind-map-location"}});t.element.innerHTML="<div class='breathing'><div class='pulse'></div></div>",this.add(t),this.options.onMapClick({point:this.point})},t}(LB.MinemapGraphicsLayer),LB.MinemapLocationLayer=MB,VB=flagwind||(flagwind={}),WB=function(o){function t(t,e,n){var i=o.call(this,t,e,n)||this;return i.mapSetting=t,i.onInit(),i}return __extends(t,o),t.prototype.toScreen=function(){throw new Error("Method not implemented.")},t.prototype.onZoom=function(t){throw new Error("Method not implemented.")},t.prototype.onCenterAt=function(e){var n=this;return new Promise(function(t){n.innerMap.flyTo({center:[e.x,e.y]}),t()})},t.prototype.onCreatePoint=function(t){return new VB.MinemapPoint(t.x,t.y,t.spatial||this.spatial)},t.prototype.onCreateMap=function(){var e=this;minemap.domainUrl="http://"+this.mapSetting.mapDomain,minemap.spriteUrl="http://"+this.mapSetting.mapDomain+"/minemapapi/"+this.mapSetting.mapVersion+"/sprite/sprite",minemap.serviceUrl="http://"+this.mapSetting.mapDomain+"/service",minemap.accessToken=this.mapSetting.accessToken||"25cc55a69ea7422182d00d6b7c0ffa93",minemap.solution=this.mapSetting.wkid||2365;var t=new minemap.Map({container:this.mapElement,style:"http://"+this.mapSetting.mapDomain+"/service/solu/style/id/"+minemap.solution,center:this.mapSetting.center||[116.46,39.92],zoom:this.mapSetting.zoom,pitch:0,maxZoom:this.mapSetting.maxZoom||17,minZoom:this.mapSetting.minZoom||9});this.spatial=new VB.MinemapSpatial(minemap.solution);var n=new minemap.Popup({closeOnClick:!1,closeButton:!0,offset:[0,-14]});return(t.infoWindow=n).addTo(t),this.tooltipElement=document.createElement("div"),this.tooltipElement.id="flagwind-map-tooltip",this.tooltipElement.classList.add("flagwind-map-tooltip"),t._container.appendChild(this.tooltipElement),(this.innerMap=t).on("load",function(t){e.dispatchEvent("onLoad",t)}),t.on("click",function(t){e.dispatchEvent("onClick",t)}),t.on("dbclick",function(t){e.dispatchEvent("onDbClick",t)}),t.on("mouseout",function(t){e.dispatchEvent("onMouseOut",t)}),t.on("mousedown",function(t){e.dispatchEvent("onMouseDown",t)}),t.on("mousemove",function(t){e.dispatchEvent("onMouseMove",t)}),t.on("mouseup",function(t){e.dispatchEvent("onMouseUp",t)}),t.on("movestart",function(t){e.dispatchEvent("onMoveStart",t)}),t.on("move",function(t){e.dispatchEvent("onMove",t)}),t.on("moveend",function(t){e.dispatchEvent("onMoveEnd",t)}),t},t.prototype.onShowInfoWindow=function(t){if(this.innerMap.infoWindow&&this.innerMap.infoWindow.remove(),t.options){var e=t.options,n={};"boolean"==typeof e.closeButton&&(n.closeButton=e.closeButton),"boolean"==typeof e.closeOnClick&&(n.closeOnClick=e.closeOnClick),e.offset&&(n.offset=e.offset),n=__assign({closeOnClick:!1,closeButton:!0,offset:[0,-14]},n),this.innerMap.infoWindow=new minemap.Popup(n)}else this.innerMap.infoWindow=new minemap.Popup({closeOnClick:!1,closeButton:!0,offset:[0,-14]});if(this.innerMap.infoWindow.addTo(this.innerMap),t.context)switch(t.context.type){case"dom":this.innerMap.infoWindow.setDOMContent(document.getElementById(t.context.content)||"");break;case"html":this.innerMap.infoWindow.setHTML("<h4 class='info-window-title'>"+t.context.title+"</h4><div class='info-window-content'>"+t.context.content+"</div>");break;case"text":this.innerMap.infoWindow.setText(t.context.content||"");break;default:this.innerMap.infoWindow.setHTML("<h4 class='info-window-title'>"+t.context.title+"</h4><div class='info-window-content'>"+t.context.content+"</div>")}this.innerMap.infoWindow.setLngLat([t.graphic.geometry.x,t.graphic.geometry.y]);var i=document.querySelector(".minemap-map .minemap-popup");i&&(i.style.height=i.offsetHeight)},t.prototype.onCloseInfoWindow=function(){this.innerMap.infoWindow&&this.innerMap.infoWindow.remove()},t.prototype.onCreateBaseLayers=function(){var t=new Array;return this.baseLayers=t},t.prototype.onShowTooltip=function(t){var e=t.attributes,n=t.geometry,i=this.innerMap.project([n.x,n.y]),o=e.name;this.tooltipElement.innerHTML="<div>"+o+"</div>",this.tooltipElement.style.left=i.x+8+"px",this.tooltipElement.style.top=i.y+8+"px",this.tooltipElement.style.display="block"},t.prototype.onHideTooltip=function(){this.tooltipElement.style.display="none"},t.prototype.onDestroy=function(){try{this.tooltipElement&&(this.tooltipElement.remove(),this.tooltipElement=null),this.featureLayers&&(this.featureLayers.forEach(function(t){t.clear()}),this.featureLayers=[]),this.baseLayers&&(this.baseLayers=[]),this.innerMap&&this.innerMap.destroy&&(this.innerMap.destroy(),this.innerMap=null)}catch(t){console.error(t)}},t}(VB.FlagwindMap),VB.MinemapMap=WB,FC=flagwind||(flagwind={}),GC=function(n){function e(t){var e=n.call(this)||this;return e._kind="point",e._isInsided=!1,e.isShow=!0,e.id=t.id,e.symbol=t.symbol?t.symbol:{},e.attributes=t.attributes?t.attributes:{},e.icon=t.icon,!e.icon&&e.symbol.imageUrl&&(e.icon=new minemap.Icon({imageUrl:e.symbol.imageUrl,imageSize:e.symbol.imageSize,imgOffset:e.symbol.imgOffset})),e.marker=new minemap.Marker(e.icon,{}),e.element=e.marker.getElement(),t.point&&(e.geometry=new FC.MinemapPoint(t.point.x,t.point.y,t.point.spatial)),t.geometry&&(e.geometry=t.geometry),t&&t.className&&(e.addClass(t.className),e.symbol.className=""),t.symbol&&t.symbol.className&&(e.addClass(t.symbol.className),e.symbol.className=""),e}return __extends(e,n),e.prototype.addClass=function(t){if(" "!==(this.symbol.className=t)&&null!=t)for(var e=t.split(" "),n=0;n<e.length;n++)this.marker.getElement().classList.add(e[n])},e.prototype.removeClass=function(t){if(" "!==t&&null!=t)for(var e=t.split(" "),n=0;n<e.length;n++)this.marker.getElement().classList.remove(e[n])},e.prototype.clone=function(t){return new e({id:t,symbol:this.symbol,attributes:this.attributes,point:this.geometry})},Object.defineProperty(e.prototype,"kind",{get:function(){return this._kind},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInsided",{get:function(){return this._isInsided},enumerable:!0,configurable:!0}),e.prototype.on=function(t,e,n,i){void 0===n&&(n=this),void 0===i&&(i=!1),this.addListener(t,e,n,i)},e.prototype.off=function(t,e,n){void 0===n&&(n=this),this.removeListener(t,e,n)},e.prototype.show=function(){if(!this.layer)throw new FC.Exception("\u8be5\u8981\u7d20\u6ca1\u6709\u6dfb\u52a0\u5230\u56fe\u5c42\u4e0a\uff0c\u82e5\u60f3\u663e\u793a\u8be5\u8981\u7d20\u8bf7\u8c03\u7528addToMap\u65b9\u6cd5");this.addTo(this.layer.map),this.isShow=!0},e.prototype.hide=function(){this.marker.remove(),this.isShow=!1},e.prototype.remove=function(){this._isInsided&&(this.marker.remove(),this._isInsided=!1)},e.prototype.delete=function(){this._isInsided&&(this.marker.remove(),this._isInsided=!1),this.layer&&this.layer.remove(this)},e.prototype.setAngle=function(t){this.marker.getElement().style.transform="rotate("+t+"deg)",this.marker.getElement().style["-ms-transform"]="rotate("+t+"deg)",this.marker.getElement().style["-moz-transform"]="rotate("+t+"deg)",this.marker.getElement().style["-webkit-transform"]="rotate("+t+"deg)",this.marker.getElement().style["-o-transform"]="rotate("+t+"deg)";var e=this.marker.getElement().querySelector(".graphic-moving .minemap-icon");e&&(e.style.transform="rotate("+t+"deg)")},e.prototype.setSymbol=function(t){t.className&&(this.symbol&&this.symbol.className&&this.removeClass(this.symbol.className),this.addClass(t.className)),t.icon&&this.marker.setIcon(t.icon),t.imageUrl&&this.icon.setImageUrl(t.imageUrl),t.title&&this.marker.setTitle(t.title),t.titleFontSize&&this.marker.setTitleFontSize(t.titleFontSize),t.titleColor&&this.marker.setTitleColor(t.titleColor),t.titleColor&&this.marker.setTitleColor(t.titleColor),t.titlePosition&&this.marker.setTitlePosition(t.titlePosition),this.symbol=__assign({},this.symbol,t)},e.prototype.draw=function(){console.log("draw")},Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(t){this._geometry=t,this.marker.setLngLat([t.x,t.y])},enumerable:!0,configurable:!0}),e.prototype.setGeometry=function(t){if(!(t instanceof FC.MinemapPoint))throw new Error("\u4e0d\u5339\u914d\u7c7b\u578b");this.geometry=t},e.prototype.addTo=function(t){var e=this;this._isInsided=!0,this.marker.addTo(t),this.marker.on("mouseover",function(t){console.log("fire marker onMouseOver"),e.fireEvent("onMouseOver",{graphic:e,mapPoint:e.geometry,orgion:t})}),this.marker.on("mouseout",function(t){console.log("fire marker onMouseOut"),e.fireEvent("onMouseOut",{graphic:e,mapPoint:e.geometry,orgion:t})}),this.marker.on("mouseup",function(t){console.log("fire marker onMouseUp"),e.fireEvent("onMouseUp",{graphic:e,mapPoint:e.geometry,orgion:t})}),this.marker.on("mousedown",function(t){console.log("fire marker onMouseDown"),e.fireEvent("onMouseDown",{graphic:e,mapPoint:e.geometry,orgion:t})}),this.marker.on("dblclick",function(t){console.log("fire marker onClick"),e.fireEvent("onDblClick",{graphic:e,mapPoint:e.geometry,orgion:t})}),this.marker.on("click",function(t){console.log("fire marker onClick"),e.fireEvent("onClick",{graphic:e,mapPoint:e.geometry,orgion:t})})},e.prototype.fireEvent=function(t,e){this.dispatchEvent(t,e),this.layer&&this.layer.dispatchEvent(t,e)},e}(FC.EventProvider),FC.MinemapPointGraphic=GC,nD=flagwind||(flagwind={}),oD=function(i){function t(t,e,n){return i.call(this,t,e,__assign({autoInit:!0},n,{layerType:nD.LayerType.point}))||this}return __extends(t,i),t.prototype.onCreateGraphicsLayer=function(t){return new nD.MinemapGraphicsLayer(t)},t.prototype.getImageUrl=function(t){var e=this.options.symbol.imageUrl;if("string"==typeof e&&e){var n="imageUrl"+(t.status||"")+(t.selected?"checked":""),i=this.options[n]||this.options.symbol[n]||e,o=i.lastIndexOf("."),r=i.substring(0,o),s=i.substring(o+1);return t.selected?r+"_checked."+s:r+"."+s}var a=t.status;null==a&&(a="");n="image"+a+(t.selected?"checked":"");return this.options[n]||this.options.symbol[n]||this.options.image},t.prototype.getClassName=function(t){return null==t.selected?"":t.selected?"checked":"unchecked"},t.prototype.onCreatGraphicByModel=function(t){var e=this.options.symbol.className||"graphic-point",n=this.options.symbol.imageUrl||this.options.imageUrl,i=__assign({},t,{__type:this.layerType});return new nD.MinemapPointGraphic({id:t.id,className:e,symbol:{imageUrl:n,imageSize:this.options.symbol.imageSize||[20,28],imgOffset:this.options.symbol.imgOffset||[-10,-14]},point:{y:this.getPoint(t).y,x:this.getPoint(t).x,spatial:{wkid:minemap.solution}},attributes:i})},t.prototype.onUpdateGraphicByModel=function(t){var e=this.getGraphicById(t.id);if(e){var n=e.geometry,i=new nD.MinemapPoint(t.longitude,t.latitude);e.geometry=i;var o=__assign({},e.attributes,t,{__type:this.layerType});this.setGraphicStatus(o),nD.MapUtils.isEqualPoint(i,n)||this.options.onPositionChanged(i,n,e.attributes)}else console.warn("\u5f85\u4fee\u6539\u7684\u8981\u7d20\u4e0d\u5b58\u5728")},t.prototype.setGraphicStatus=function(t){this.getGraphicById(t.id).setSymbol({className:this.getClassName(t),imageUrl:this.getImageUrl(t)})},t}(nD.FlagwindBusinessLayer),nD.MinemapPointLayer=oD,PD=flagwind||(flagwind={}),QD=function(n){function t(t){var e=n.call(this,null)||this;return e.attributes={},e.kind="polygon",e.id=t.id,e.attributes=__assign({},e.attributes,t.attributes),e.symbol=t.symbol,e.polygon=new minemap.Polygon(t.path,e.symbol),e._geometry=new PD.MinemapPolygon,e._geometry.addRing(t.path),e}return __extends(t,n),Object.defineProperty(t.prototype,"isInsided",{get:function(){return this._isInsided},enumerable:!0,configurable:!0}),t.prototype.show=function(){if(!this.layer)throw new PD.Exception("\u8be5\u8981\u7d20\u6ca1\u6709\u6dfb\u52a0\u5230\u56fe\u5c42\u4e0a\uff0c\u82e5\u60f3\u663e\u793a\u8be5\u8981\u7d20\u8bf7\u8c03\u7528addToMap\u65b9\u6cd5");this.polygon.addTo(this.layer.map),this.isShow=!1},t.prototype.hide=function(){this.polygon.remove(),this.isShow=!1},t.prototype.remove=function(){this._isInsided&&(this.polygon.remove(),this._isInsided=!1)},t.prototype.delete=function(){this._isInsided&&(this.polygon.remove(),this._isInsided=!1),this.layer&&this.layer.remove(this)},t.prototype.setSymbol=function(t){this.symbol=t,this.symbol&&this.symbol.strokeColor&&this.polygon.setStrokeColor(this.symbol.strokeColor),this.symbol&&this.symbol.fillOpacity&&this.polygon.setFillOpacity(this.symbol.fillOpacity),this.symbol&&this.symbol.strokeOpacity&&this.polygon.setStrokeOpacity(this.symbol.strokeOpacity),this.symbol&&this.symbol.strokeDashArray&&this.polygon.setStrokeDashArray(this.symbol.strokeDashArray),this.symbol&&this.symbol.ay&&this.polygon.ay(this.symbol.ay)},t.prototype.setGeometry=function(t){0<(this._geometry=t).rings.length?this.polygon.setPath(t.rings[0]):this.polygon.setPath([])},Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),t.prototype.addTo=function(t){this._isInsided=!0,this.polygon.addTo(t)},t.prototype.setAngle=function(t){throw new PD.Exception("\u672a\u5b9e\u73b0setAngle\u65b9\u6cd5")},t}(PD.EventProvider),PD.MinemapPolygonGraphic=QD,ZD=flagwind||(flagwind={}),$D=function(o){function t(t,e){var n=o.call(this,null)||this;n.attributes={},n.kind="polyline",n.layer=t,n.id=e.id,n.attributes=__assign({},n.attributes,e.attributes),n.symbol=e.symbol,e.geometry?n._geometry=e.geometry:n._geometry=new ZD.MinemapPolyline;var i=n._geometry.path;return e.path&&(i=e.path),n.polyline=new minemap.Polyline(i,n.symbol),n._geometry.path=i,n}return __extends(t,o),Object.defineProperty(t.prototype,"isInsided",{get:function(){return this._isInsided},enumerable:!0,configurable:!0}),t.prototype.show=function(){if(!this.layer)throw new ZD.Exception("\u8be5\u8981\u7d20\u6ca1\u6709\u6dfb\u52a0\u5230\u56fe\u5c42\u4e0a\uff0c\u82e5\u60f3\u663e\u793a\u8be5\u8981\u7d20\u8bf7\u8c03\u7528addToMap\u65b9\u6cd5");this.polyline.addTo(this.layer.map),this.isShow=!1},t.prototype.hide=function(){this.polyline.remove(),this.isShow=!1},t.prototype.remove=function(){this._isInsided&&(this.polyline.remove(),this._isInsided=!1)},t.prototype.delete=function(){this._isInsided&&(this.polyline.remove(),this._isInsided=!1),this.layer&&this.layer.remove(this)},t.prototype.setSymbol=function(t){this.symbol=t,this.symbol&&this.symbol.strokeColor&&this.polyline.setStrokeColor(this.symbol.strokeColor),this.symbol&&this.symbol.opacity&&this.polyline.setOpacity(this.symbol.opacity),this.symbol&&this.symbol.strokeDashArray&&this.polyline.setStrokeDashArray(this.symbol.strokeDashArray)},t.prototype.setGeometry=function(t){this._geometry=t,this.polyline.setPath(t.path)},Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),t.prototype.addTo=function(t){this._isInsided=!0,this.polyline.addTo(t)},t.prototype.setAngle=function(t){throw new ZD.Exception("\u672a\u5b9e\u73b0setAngle\u65b9\u6cd5")},t}(ZD.EventProvider),ZD.MinemapPolylineGraphic=$D,jE=flagwind||(flagwind={}),kE=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onSetSegmentByLine=function(t,e){if(e.polyline=t.polyline,e.length=t.length,e.polyline.path&&0<e.polyline.path.length){var n=e.options.numsOfKilometer;e.line=jE.MapUtils.vacuate([e.polyline.path],e.length,n)}},e.prototype.onSetSegmentByPoint=function(t,e){for(var n=t.points,i=t.length||jE.MinemapUtils.distance(n),o=e.options.numsOfKilometer,r=new jE.MinemapPolyline,s=[],a=0;a<n.length-1;a++){var l=n[a],p=n[a+1];jE.MapUtils.density(l,p,i*o).forEach(function(t){s.push([t.x,t.y])})}r.path=s,e.length=i,e.polyline=r,e.line=jE.MapUtils.vacuate([e.polyline.path],e.length,o)},e.prototype.onCreateMovingLayer=function(t){return new jE.MinemapGroupLayer({id:t})},e.prototype.onCreateLineLayer=function(t){return new jE.MinemapGroupLayer({id:t})},e.prototype.onEqualGraphic=function(t,e){return null!=t&&null!=e&&(t.geometry.x!==e.geometry.x||t.geometry.y!==e.geometry.y)},e.prototype.onShowSegmentLine=function(t){var e=new jE.MinemapPolylineGraphic(this.moveLineLayer.layer,{id:t.name+"_"+t.index,geometry:t.polyline,attributes:{id:t.name+"_"+t.index},symbol:{strokeDashArray:[1,1]}});t.lineGraphic=e,this.moveLineLayer.addGraphic(t.name,e)},e.prototype.onGetStandardStops=function(e,t){var n=[];return null==t||0===t.length||t.forEach(function(t){if(!(t instanceof jE.MinemapPointGraphic))throw new Error("\u672a\u77e5\u7684\u505c\u9760\u70b9\u5b9a\u4e49.");t.attributes.__type="stop",t.attributes.__line=e,n.push(t)}),n},e.prototype.onSolveByService=function(i,t,e,n){var o=this,r=i.startGraphic.geometry.x+","+i.startGraphic.geometry.y,s=i.endGraphic.geometry.x+","+i.endGraphic.geometry.y,a=null;n&&(a=n.join(",")),minemap.service.queryRouteDrivingResult3(r,s,a,2,"",function(t,e){if(t)o.errorHandler(t,i);else if(0===e.errcode&&e.data){var n=new jE.RouteResult(e);o.solveComplete({polyline:n.getLine(o.spatial),length:n.data.rows[0].distance},i)}else o.errorHandler(e.errmsg,i)})},e.prototype.onSolveByJoinPoint=function(t){var e=[];if(e.push(t.startGraphic.geometry),t.waypoints)for(var n=0;n<t.waypoints.length;n++)e.push(t.waypoints[n].geometry);e.push(t.endGraphic.geometry),t.setMultPoints(e)},e.prototype.onCreateMoveMark=function(t,e,n){var i=this.getImageUrl(t,n),o=new jE.MinemapPointGraphic({id:t.name,symbol:{imageUrl:i,className:"graphic-moving"},point:e.geometry,attributes:e.attributes});t.markerGraphic=o,this.moveMarkLayer.addGraphic(t.name,o)},e.prototype.onUpdateMoveGraphic=function(t,e,n){if(void 0!==t){var i=this.getImageUrl(t,n),o=this.getImageAngle(t,n);t.markerGraphic.setSymbol({imageUrl:i,className:"graphic-moving"}),null!==o&&t.markerGraphic.setAngle(o),t.markerGraphic.setGeometry(e)}},e.prototype.getImageUrl=function(t,e){if(this.options.getImageUrl)return this.options.getImageUrl(t,e);if(t.options.getImageUrl)return t.options.getImageUrl(t,e);var n=1;(e<45||315<=e)&&(n=3),45<=e&&e<135&&(n=4),135<=e&&e<225&&(n=2),225<=e&&e<315&&(n=1),null===t.step&&(t.step=-1),t.direction!==n?t.step=0:t.step=(t.step+1)%4,t.direction=n;var i=""+t.direction+(t.step+1);return t.options.symbol["imageUrl"+i]},e.prototype.getImageAngle=function(t,e){return this.options.getImageAngle?this.options.getImageAngle(t,e):t.options.getImageAngle?t.options.getImageAngle(t,e):360-e},e}(jE.FlagwindRouteLayer),jE.MinemapRouteLayer=kE,function(r){var t=function(){function t(t){var e=this;console.log(t),this.success=!t.errcode,this.message=t.message,t.data&&(this.data={error:null,rows:null},t.data.error&&(this.data.error=t.data.error),t.data.rows&&(this.data.rows=[],t.data.rows.forEach(function(t){e.data.rows.push(new n(t))})))}return t.prototype.getLine=function(n){var t=new r.MinemapPolyline(n),i=[];return this.data&&this.data.rows&&this.data.rows.forEach(function(t){var e=t.getPoints(n);i=i.concat(e.map(function(t){return[t.x,t.y]}))}),t.path=i,t},t}();r.RouteResult=t;var s=function(t){t.strguide&&(this.guide=t.strguide),this.streetName=t.streetName,t.distance&&(this.distance=parseFloat(t.distance)),t.duration&&(this.duration=parseFloat(t.duration))};r.RouteItem=s;var n=function(){function t(t){var e=this;if(t.mapinfo){if(t.mapinfo.center){var n=t.mapinfo.center.split(",");this.center=new r.MinemapPoint(parseFloat(n[0]),parseFloat(n[1]),null)}t.mapinfo.scale&&(this.scale=parseFloat(t.mapinfo.scale))}if(t.distance&&(this.distance=parseFloat(t.distance)),t.duration&&(this.duration=parseFloat(t.duration)),t.routelatlon){this.points=[];for(var i=t.routelatlon.split(";"),o=0;o<i.length;o++)if(i[o]){n=i[o].split(",");this.points.push([parseFloat(n[0]),parseFloat(n[1])])}}t.routes&&(this.items=[],t.routes.item.forEach(function(t){e.items.push(new s(t))}))}return t.prototype.getPoints=function(e){var n=[];return this.points.forEach(function(t){n.push(new r.MinemapPoint(t[0],t[1],e))}),n},t.prototype.getLine=function(t){var e=new r.MinemapPolyline(t),n=[];return this.points.forEach(function(t){n.push([t[0],t[1]])}),e.path=n,e},t}();r.RouteRow=n}(flagwind||(flagwind={})),function(r){r.SELECT_BOX_OPTIONS={id:"select-box",selectMode:2,onCheckChanged:function(t,e){console.log("onCheckChanged")}};var t=function(i){function t(t,e){var n=i.call(this,null)||this;return n.flagwindMap=t,n.layers=[],e=__assign({},r.SELECT_BOX_OPTIONS,e),n.options=e,n.id=e.id,n.edit=new minemap.edit.init(t.map,{boxSelect:!0,touchEnabled:!1,displayControlsDefault:!0,showButtons:!1}),n.flagwindMap.map.on("edit.record.create",function(t){n.onCreateRecord(n,t)}),e.element?n.element=e.element:n.showSelectBar(),n}return __extends(t,i),t.prototype.onCreateRecord=function(t,e){var i=this,o=new r.MinemapPolygon(null);o.addRing(e.record.features[0].geometry.coordinates[0]),t.layers.forEach(function(t){var e=[];t.graphics.forEach(function(t){o.inside([t.geometry.x,t.geometry.y])&&(console.log(t),e.push(t))});var n=e.map(function(t){return t.attributes});t.setSelectStatusByModels(n,!1),i.options.onCheckChanged(n,t)}),t.clear()},t.prototype.getLayerById=function(e){var t=this.layers.filter(function(t){return t.id===e});return 0<t.length?t[0]:null},t.prototype.addLayer=function(t){t.options.selectMode=this.options.selectMode,t.options.showInfoWindow=!1,this.layers.push(t)},t.prototype.removeLayer=function(t){t.options.selectMode=r.SelectMode.none;var e=this.layers.indexOf(t);0<=e&&this.layers.splice(e,1)},t.prototype.deleteSelectBar=function(){this.element&&this.element.remove()},t.prototype.show=function(){this.element.style.display="block"},t.prototype.hide=function(){this.element.style.display="none"},t.prototype.showSelectBar=function(){if(this.element)return console.log("\u7ed8\u5236\u63a7\u4ef6\u5df2\u7ecf\u521b\u5efa\uff0c\u4e0d\u53ef\u91cd\u590d\u521b\u5efa\uff01"),void this.show();var t=this.flagwindMap.map._container;this.element=document.createElement("div"),this.element.setAttribute("id",this.id),this.element.innerHTML='<div class="edit-btn" title="\u753b\u5706" data-operate="circle"><span class="iconfont icon-draw-circle"></span></div>\n                <div class="edit-btn" title="\u753b\u77e9\u5f62" data-operate="rectangle"><span class="iconfont icon-draw-square"></span></div>\n                <div class="edit-btn" title="\u753b\u591a\u8fb9\u5f62" data-operate="polygon"><span class="iconfont icon-draw-polygon1"></span></div>',t.appendChild(this.element);for(var e=document.querySelectorAll("#"+this.id+" .edit-btn"),n=this,i=0;i<e.length;i++)e[i].onclick=function(){n.active(this.dataset.operate)}},t.prototype.clear=function(){this.edit&&(this.edit.onBtnCtrlActive("trash"),this.mode="trash")},t.prototype.active=function(t){this.edit&&t&&(this.edit.onBtnCtrlActive(t),this.mode=t)},t.prototype.destroy=function(){this.clear(),this.deleteSelectBar()},t}(r.EventProvider);r.MinemapSelectBox=t}(flagwind||(flagwind={})),uG=flagwind||(flagwind={}),vG=function(i){function t(t,e){var n=i.call(this,t,new uG.MinemapRouteLayer(t.flagwindMap,t.id+"_track",e),e)||this;return n.businessLayer=t,n}return __extends(t,i),t}(uG.FlagwindTrackLayer),uG.MinemapTrackLayer=vG,BG=flagwind||(flagwind={}),CG=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.showTrack=function(t,e,n){var i=__assign({solveMode:"Line"},n),o=this.getStopsGraphicList(e);"Segment"===i.solveMode?this.solveSegment(t,o,i):this.solveLine(t,o,i)},e.prototype.getStopsGraphicList=function(t){var e=this,n=[];return t.forEach(function(t){t=e.changeStandardModel(t),e.validGeometryModel(t)&&n.push(new BG.MinemapPointGraphic({id:t.id,symbol:e.options.stopSymbol,point:e.toStopPoint(t),attributes:t}))}),n},e.prototype.toStopPoint=function(t){var e={lat:t.latitude,lon:t.longitude};return this.validGeometryModel(t)||(e.lon=t.x,e.lat=t.y),this.flagwindMap.onToPoint(t)},e}(BG.MinemapRouteLayer),BG.MinemapVehicleRouteLayer=CG,RG=function(){this.mapDomain="minedata.cn",this.mapVersion="v1.3",this.accessToken="25cc55a69ea7422182d00d6b7c0ffa93",this.units=.03,this.center=[116.46,39.92],this.wkidFromApp=4326,this.minZoom=9,this.maxZoom=17,this.zoom=16,this.logo=!1,this.slider=!0,this.sliderPosition="bottom-left"},(flagwind||(flagwind={})).MinemapSetting=RG,TG=flagwind||(flagwind={}),UG=function(){function a(){}return a.getLength=function(t,e){return turf.distance(t.toJson(),e.toJson(),"kilometers")},a.distance=function(t,e){void 0===e&&(e=100),null==e&&(e=t.length);var n=1;t.length>e&&(n=Math.max(Math.floor(t.length/e),1));var i=0,o=0;for(o=0;o<=t.length-n;o+=n){var r=t[o],s=t[o+n];r&&s&&(i+=a.getLength(r,s))}return o<t.length-1&&(i+=a.getLength(t[o],t[t.length-1])),i},a}(),TG.MinemapUtils=UG,function(flagwind){var Type=function(){function Type(){}return Type.isArray=function(t){return"array"===this.getTypeString(t)},Type.isObject=function(t){return"object"===this.getTypeString(t)},Type.isString=function(t){return"string"==typeof t},Type.isDate=function(t){return"date"===this.getTypeString(t)},Type.isRegExp=function(t){return"regexp"===this.getTypeString(t)},Type.isFunction=function(t){return"function"==typeof t},Type.isBoolean=function(t){return"boolean"==typeof t},Type.isNumber=function(t){return"number"==typeof t},Type.isNull=function(t){return null===t},Type.isUndefined=function(t){return void 0===t},Type.isEmptyObject=function(t){return Type.isNull(t)||Type.isUndefined(t)},Type.isEmptyString=function(t){return Type.isEmptyObject(t)||""===t.trim()},Type.setMetadata=function(t,e){if(!t||!e)throw new Error;this._metadatas.set(t,e)},Type.getMetadata=function(t){return this._metadatas.get(t)||null},Type.getClassType=function(value){if(Type.isNull(value))return null;if(!Type.isUndefined(value)){if(Type.isBoolean(value))return Boolean;if(Type.isNumber(value))return Number;if(!Type.isString(value)){var prototype=value.prototype?value.prototype:Object.getPrototypeOf(value);return prototype.constructor}try{var ctor=eval(value);return Type.isFunction(ctor)?ctor:String}catch(t){return String}}},Type.getClassName=function(t){var e=this.getQualifiedClassName(t).split(".");return e[e.length-1]},Type.getQualifiedClassName=function(t){var e=typeof t;if(!t||"object"!==e&&!t.prototype)return e;var n=t.prototype?t.prototype:Object.getPrototypeOf(t);if(n.hasOwnProperty("__class__"))return n.__class__;var i=n.constructor.toString().trim(),o=i.indexOf("("),r=i.substring(9,o);return Object.defineProperty(n,"__class__",{value:r,enumerable:!1,writable:!0}),r},Type.getSuperclassName=function(t){var e=this.getQualifiedSuperclassName(t).split(".");return e[e.length-1]},Type.getQualifiedSuperclassName=function(t){if(!t||"object"!=typeof t&&!t.prototype)return null;var e=t.prototype?t.prototype:Object.getPrototypeOf(t),n=Object.getPrototypeOf(e);if(!n)return null;var i=this.getQualifiedClassName(n.constructor);return i||null},Type.isAssignableFrom=function(t,e){if(!t||!e)return!1;if(t===e)return!0;if(t===Object||"Object"===t)return!0;var n=e.prototype;if(n.hasOwnProperty("__types__")){var i=Type.isString(t)?t:Type.getQualifiedClassName(t);return-1!==n.__types__.indexOf(i)}var o=Object.getPrototypeOf(n).constructor;if(o===Object)return!1;if(Type.isString(t)){if(Type.getQualifiedClassName(o)===t)return!0}else if(o===t)return!0;return Type.isAssignableFrom(t,o)},Type.getTypeString=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},Type._metadatas=new flagwind.Map,Type}();flagwind.Type=Type}(flagwind||(flagwind={})),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=flagwind});