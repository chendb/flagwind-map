/*!
* flagwind-map v1.0.0 
* 
* Authors:
*      chendebao <hbchendb1985@gmail.com>
* 
* Licensed under the MIT License.
* Copyright (C) 2018-2018 Flagwind Inc. All rights reserved. 
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.flagwind={})}(this,function(t){"use strict";var e,n,o,i,r,a,s,p,h,l,u,c,d,f,y,g,m,v,M,w,L,S,b,E,P,k,_,I,x,G,C,A,O,T,B,F,R,j,N,U,H,W,D,z,J,V,Z,q,K,Y,X,$=this&&this.__extends||(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}),Q=this&&this.__assign||Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};!function(t){var e=function(){return function(){}}();t.Animation=e;var n=function(t){function e(e,n,o){var i=t.call(this)||this;return i.graphic=n,i.options=o,i.attributes=e,i.graphic=n,i._id=e.id,i._alpha=1,i._fadeIn=!1,i.options=o,i}return $(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.updateGraphic=function(){this._fadeIn?(this._alpha+=.01,this._alpha>=1&&(this._alpha=1,this._fadeIn=!1)):(this._alpha-=.01,this._alpha<=0&&(this._alpha=0,this._fadeIn=!0));var t=this.getSymbol(),e=this.getColor();e.push(this._alpha),t.setColor(e),this.graphic.setSymbol(t),this.graphic.draw()},e.prototype.getSymbol=function(){var t=new esri.symbol.SimpleMarkerSymbol;return t.setPath(this.options.path),t.setSize(this.options.size),t.setColor(new dojo.Color(this.getColor())),t.setOutline(null),t},e.prototype.getColor=function(){var t=this.options.color;return t||(t=this.options.getColor(this.attributes)),t.length>3&&t.splice(3,1),t},e}(e);t.LightingAnimation=n;var o=function(t){function e(e,n,o){var i=t.call(this)||this;return i.graphic=n,i.options=o,i.index=0,i.attributes=e,i.graphic=n,i.id=e.id,i.index=0,i.options=o,i}return $(e,t),e.prototype.getRandomNum=function(t,e){var n=e-t,o=Math.random();return t+Math.round(o*n)},e.prototype.updateGraphic=function(){var t=this.options.images[this.index],e=this.options.width||48,n=this.options.height||48,o=new esri.symbol.PictureMarkerSymbol(t,e,n);this.graphic.setSymbol(o),this.index=(this.index+1)%this.options.images.length,this.graphic.draw()},e}(e);t.StarAnimation=o;var i=function(){function t(t){this.options=t,this.isRunning=!1,this.animations=[],this.options=t}return t.prototype.getRandomNum=function(t,e){var n=e-t,o=Math.random();return t+Math.round(o*n)},t.prototype.getAnimationId=function(t){var e=this.animations.filter(function(e){return e.id===t});return e&&e.length>0?e[0]:null},t.prototype.start=function(){this.isRunning=!0;var t=this;this._timer=setInterval(function(){t.animations.forEach(function(e){t.getRandomNum(0,10)>5&&e.updateGraphic()})},this.options.timeout||20)},t.prototype.stop=function(){this.isRunning=!1,this._timer&&clearInterval(this._timer)},t.prototype.add=function(t){this.animations.push(t)},t.prototype.removeAnimationById=function(t){var e=this.getAnimationId(t);if(e){var n=this.animations.indexOf(e);n>=0&&this.animations.splice(n,1)}},t.prototype.clear=function(){this.stop(),this.animations=[]},t}();t.AnimationLayer=i}(K||(K={})),n=K||(K={}),o=function(){function t(t,e){this.id=t,this.title=e,this.isShow=!0,this.id=t,this.layer=this.onCreateGraphicsLayer({id:t})}return Object.defineProperty(t.prototype,"graphics",{get:function(){return this.layer.graphics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this.graphics.map(function(t){return t.attributes})},enumerable:!0,configurable:!0}),t.prototype.appendTo=function(t){this.layer.addToMap(t)},t.prototype.removeLayer=function(t){this.layer.removeFormMap(t)},Object.defineProperty(t.prototype,"count",{get:function(){return this.layer?this.graphics.length:0},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.layer.clear()},t.prototype.show=function(){this.isShow=!0,this.layer.show()},t.prototype.hide=function(){this.isShow=!1,this.layer.hide()},t.prototype.getGraphicById=function(t){for(var e=this.graphics,n=0;n<e.length;n++){if(e[n].attributes.id===t)return e[n]}return null},t.prototype.removeGraphicById=function(t){var e=this.getGraphicById(t);null!=e&&this.layer.remove(e)},t}(),n.FlagwindFeatureLayer=o,i=K||(K={}),r=function(t){function e(e,n){var o=this;if(n=Q({},i.EDIT_LAYER_OPTIONS,n),(o=t.call(this,"edit_"+e.id,"\u7f16\u8f91\u56fe\u5c42")||this).businessLayer=e,o.flagwindMap=e.flagwindMap,o.options=n,o.editObj=new esri.toolbars.Edit(o.flagwindMap.innerMap),o.flagwindMap.addFeatureLayer(o),o.flagwindMap.innerMap.loaded)o.onLoad();else{var r=o;o.flagwindMap.innerMap.on("load",function(){r.onLoad()})}return o}return $(e,t),e.prototype.activateEdit=function(t){var e=this.businessLayer.getGraphicById(t);if(e){this.businessLayer.hide(),this.show();var n=this.businessLayer.creatGraphicByModel(e.attributes);this.layer.add(n),n.attributes.eventName="start";var o=esri.toolbars.Edit.MOVE;this.editObj.activate(o,n,null),this.businessLayer.onShowInfoWindow({graphic:e})}else console.log("\u65e0\u6548\u7684\u4ee3\u7801\uff1a"+t)},e.prototype.cancelEdit=function(t){this.editObj.deactivate(),this.clear(),this.hide(),this.flagwindMap.innerMap.infoWindow.hide(),this.businessLayer.show();var e=this.businessLayer.getGraphicById(t);e.attributes.eventName="delete",this.businessLayer.onShowInfoWindow({graphic:e})},e.prototype.registerModifyEvent=function(t){var e=this;dojo.connect(dojo.byId(t),"onclick",function(t){var n=t.target.attributes.key.value;e.activateEdit(n)})},e.prototype.registerDeleteEvent=function(t){var e=this;dojo.connect(dojo.byId(t),"onclick",function(t){var n=t.target.attributes.key.value;e.cancelEdit(n)})},e.prototype.onLoad=function(){this.layer._map||(this.layer._map=this.flagwindMap.innerMap);try{this.registerEvent()}catch(t){console.error(t)}},Object.defineProperty(e.prototype,"map",{get:function(){return this.flagwindMap.map},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spatial",{get:function(){return this.flagwindMap.spatial},enumerable:!0,configurable:!0}),e.prototype.onCreateGraphicsLayer=function(t){var e=new esri.layers.GraphicsLayer(t);return e.addToMap=function(t){t.addLayer(this)},e.removeFormMap=function(t){t.removeLayer(this)},e},e.prototype.onChanged=function(t,e){return this.options.onEditInfo(t,e)},e.prototype.registerEvent=function(){var t=this;dojo.connect(this.layer,"onClick",function(e){t.onLayerClick(t,e)});var e={};console.log("\u7f16\u8f91\u5bf9\u8c61\uff1a"+this.editObj),dojo.on(this.editObj,"graphic-first-move",function(n){console.log("\u8981\u7d20\u79fb\u52a8---------graphic-first-move"),t.flagwindMap.innerMap.infoWindow.hide(),e=n.graphic.attributes}),dojo.on(this.editObj,"graphic-move-stop",function(n){console.log("\u8981\u7d20\u79fb\u52a8---------graphic-move-stop"),t.editObj.deactivate();var o=n.graphic.attributes.id;window.$Modal.confirm({title:"\u786e\u5b9a\u8981\u8fdb\u884c\u66f4\u6539\u5417\uff1f",content:"\u521d\u59cb\u5750\u6807\u503c\uff08\u7ecf\u5ea6\uff09:"+e.longitude+",\uff08\u7eac\u5ea6\uff09:"+e.latitude+"\r\u5f53\u524d\u5750\u6807\u503c\uff08\u7ecf\u5ea6\uff09:"+n.graphic.geometry.x.toFixed(8)+",\uff08\u7eac\u5ea6\uff09:"+n.graphic.geometry.y.toFixed(8),onOk:function(){var e=n.graphic.geometry,i=t.businessLayer.formPoint(e),r=Q({},n.graphic.attributes,i);t.onChanged({id:o,latitude:r.latitude,longitude:r.longitude},!0).then(function(e){e&&(t.businessLayer.removeGraphicById(r.id),t.businessLayer.addGraphicByModel(r))})},onCancel:function(){t.onChanged({id:o,latitude:e.latitude,longitude:e.longitude},!1)}}),n.graphic.attributes.eventName="stop",t.clear(),t.hide(),t.flagwindMap.innerMap.infoWindow.hide(),t.businessLayer.show()})},e.prototype.onLayerClick=function(t,e){t.businessLayer.options.onLayerClick&&t.businessLayer.options.onLayerClick(e),t.businessLayer.options.showInfoWindow&&t.businessLayer.onShowInfoWindow(e)},e}(i.FlagwindFeatureLayer),i.EsriEditLayer=r,a=K||(K={}),s=function(){function t(t){this.options=t,this.isShow=!0,this.layer=this.onCreateGraphicsLayer(t)}return Object.defineProperty(t.prototype,"graphics",{get:function(){return this.layer.graphics},enumerable:!0,configurable:!0}),t.prototype.appendTo=function(t){this.layer.addToMap(t)},t.prototype.removeLayer=function(t){this.layer.removeFormMap(t)},t.prototype.clear=function(){this.layer.clear()},t.prototype.show=function(){this.isShow=!0,this.layer.show()},t.prototype.hide=function(){this.isShow=!1,this.layer.hide()},t.prototype.setGeometry=function(t,e){this.getGraphicByName(t).forEach(function(t){t.setGeometry(e)})},t.prototype.setSymbol=function(t,e){this.getGraphicByName(t).forEach(function(t){t.setSymbol(e)})},t.prototype.showGraphic=function(t){this.getGraphicByName(t).forEach(function(t){t.show()})},t.prototype.hideGraphic=function(t){this.getGraphicByName(t).forEach(function(t){t.hide()})},t.prototype.addGraphic=function(t){for(var e=this,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];void 0!==n&&n.forEach(function(n,o){if(n){var i=n.attributes;i.__master=0===o,i.__name=t,e.layer.add(n)}})},t.prototype.getMasterGraphicByName=function(t){return this.graphics.forEach(function(e){var n=e.attributes;if(t===n.__name&&n.__master)return e}),null},t.prototype.getGraphicByName=function(t){for(var e=[],n=0;n<this.graphics.length;n++){this.graphics[n].attributes.__name===t&&e.push(this.graphics[n])}return e},t.prototype.removeGraphicByName=function(t){var e=this,n=this.getGraphicByName(t);null!=n&&n.forEach(function(t){e.layer.remove(t)})},t}(),a.FlagwindGroupLayer=s,p=K||(K={}),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $(e,t),e.prototype.onCreateGraphicsLayer=function(t){var e=new esri.layers.GraphicsLayer(t);return e.addToMap=function(t){t.addLayer(this)},e.removeFormMap=function(t){t.removeLayer(this)},e},e}(p.FlagwindGroupLayer),p.EsriGroupLayer=h,function(t){t.MAP_OPTIONS={onMapLoad:function(){console.log("onMapLoad")},onMapZoomEnd:function(t){console.log("onMapZoomEnd")},onMapClick:function(t){console.log("onMapClick")},onCreateContextMenu:function(t){console.log("onCreateContextMenu")}};var e=function(){function e(e,n,o){this.mapSetting=e,this.mapEl=n,this.featureLayers=[],this.baseLayers=[],this.loaded=!1,this.options=Q({},t.MAP_OPTIONS,o)}return e.prototype.onInit=function(){this.onCreateMap(),this.onCreateBaseLayers();var t=this;t.onAddEventListener("onLoad",function(){try{t.loaded=!0,t.goToCenter(),t.onMapLoad()}catch(t){console.error(t)}}),t.onAddEventListener("zoom-end",function(e){t.onMapZoomEnd(e)})},e.prototype.onFormPoint=function(e){var n={lat:e.y,lon:e.x};return e.latitude&&e.longitude&&(n.lon=e.longitude,n.lat=e.latitude),this.spatial.wkid!==this.mapSetting.wkidFromApp&&(3857===this.spatial.wkid&&4326===this.mapSetting.wkidFromApp?this.mapSetting.is25D?(console.log("2.5D\u5750\u6807\uff1a"+n.lon+","+n.lat),n=t.MapUtils.point25To2(n.lon,n.lat),console.log("\u9ad8\u5fb7\u5750\u6807\uff1a"+n.lon+","+n.lat),n=t.MapUtils.gcj_decrypt(n.lat,n.lon),console.log("\u539f\u59cb\u5750\u6807\uff1a"+n.lon+","+n.lat)):n=t.MapUtils.mercator2lonlat(n.lat,n.lon):102100===this.spatial.wkid&&4326===this.mapSetting.wkidFromApp?n=t.MapUtils.mercator_decrypt(n.lat,n.lon):4326===this.spatial.wkid&&3857===this.mapSetting.wkidFromApp&&(n=t.MapUtils.mercator_decrypt(n.lat,n.lon))),{longitude:parseFloat(n.lon.toFixed(8)),latitude:parseFloat(n.lat.toFixed(8))}},e.prototype.onToPoint=function(e){var n={lat:e.latitude||e.lat,lon:e.longitude||e.lon};return t.MapUtils.validGeometryModel(e)||(n.lon=e.x||n.lon,n.lat=e.y||n.lat),this.spatial.wkid!==this.mapSetting.wkidFromApp&&(3857===this.spatial.wkid&&4326===this.mapSetting.wkidFromApp?this.mapSetting.is25D?(console.log("\u539f\u59cb\u5750\u6807\uff1a"+n.lon+","+n.lat),n=t.MapUtils.gcj_encrypt(n.lat,n.lon),console.log("\u9ad8\u5fb7\u5750\u6807\uff1a"+n.lon+","+n.lat),n=t.MapUtils.point2To25(n.lon,n.lat),console.log("2.5D\u5750\u6807\uff1a"+n.lon+","+n.lat)):n=t.MapUtils.lonlat2mercator(n.lat,n.lon):102100===this.spatial.wkid&&4326===this.mapSetting.wkidFromApp?n=t.MapUtils.mercator_encrypt(n.lat,n.lon):4326===this.spatial.wkid&&3857===this.mapSetting.wkidFromApp&&(n=t.MapUtils.mercator_encrypt(n.lat,n.lon))),this.onCreatePoint({x:n.lon,y:n.lat,spatial:this.spatial})},e.prototype.goToCenter=function(){if(this.mapSetting.center&&2===this.mapSetting.center.length){var t=this.getPoint({x:this.mapSetting.center[0],y:this.mapSetting.center[1]});this.onCenterAt(t)}},e.prototype.getBaseLayerById=function(t){var e=this.baseLayers.filter(function(e){return e.id===t});return e&&e.length>0?e[0]:null},e.prototype.centerAt=function(t,e){var n=this.onCreatePoint({x:t,y:e,spatial:this.spatial});this.onCenterAt(n)},e.prototype.getPoint=function(t){return this.onToPoint(t)},e.prototype.addFeatureLayer=function(t){if(this.getFeatureLayerById(t.id))throw Error("\u56fe\u5c42"+t.id+"\u5df2\u5b58\u5728");this.featureLayers.push(t),t.appendTo(this.innerMap)},e.prototype.openInfoWindow=function(t){this.onShowInfoWindow(t)},e.prototype.onMapLoad=function(){this.options.onMapLoad&&this.options.onMapLoad();var t=this;this.onAddEventListener("click",function(e){t.options.onMapClick(e)})},e.prototype.showBaseLayer=function(t){var e=this.getBaseLayerById(t);return!!e&&(e.show(),!0)},e.prototype.getFeatureLayerById=function(t){var e=this.featureLayers.filter(function(e){return e.id===t});return null!=e&&e.length>0?e[0]:null},e.prototype.showFeatureLayer=function(t){var e=this.getFeatureLayerById(t);return!!e&&(e.show(),!0)},e.prototype.removeFeatureLayer=function(t){var e=this.getFeatureLayerById(t);if(e){e.removeLayer(this.innerMap);var n=this.featureLayers.indexOf(e);return this.featureLayers.splice(n,1),!0}return!1},Object.defineProperty(e.prototype,"map",{get:function(){return this.innerMap},enumerable:!0,configurable:!0}),e.prototype.onMapZoomEnd=function(t){this.options.onMapZoomEnd(t.level)},e}();t.FlagwindMap=e}(K||(K={})),l=K||(K={}),u=function(t){function e(e,n,o){var i=t.call(this,e,n,o)||this;return i.mapSetting=e,i.mapEl=n,i.onInit(),i}return $(e,t),e.prototype.onAddEventListener=function(t,e){dojo.on(this.map,t,e)},e.prototype.onCenterAt=function(t){this.map.centerAt(t).then(function(){console.log("centerAt:"+t.x+","+t.y)})},e.prototype.onCreatePoint=function(t){return new esri.geometry.Point(t.x,t.y,t.spatial||this.spatial)},e.prototype.onCreateMap=function(){this.spatial=new esri.SpatialReference({wkid:this.mapSetting.wkid||4326});var t=this.mapSetting,e={logo:t.logo,slider:t.slider,zoom:t.zoom,minZoom:t.minZoom,maxZoom:t.maxZoom};if(t.basemap&&(e.basemap=t.basemap),t.extent&&4===t.extent.length){var n=this.getPoint({x:t.extent[0],y:t.extent[1]}),o=this.getPoint({x:t.extent[2],y:t.extent[3]}),i=new esri.geometry.Extent(n.x,n.y,o.x,o.y,this.spatial);e.extent=i}t.webTiledUrl&&(e.lods=this.getTileInfo().lods),new esri.Map(this.mapEl,e).infoWindow.anchor="top";var r=this.tooltipElement=document.createElement("div");r.classList.add("flagwind-map-tooltip"),this.innerMap.root.parentElement.appendChild(r)},e.prototype.onShowInfoWindow=function(t){throw new Error("Method not implemented.")},e.prototype.onCreateBaseLayers=function(){var t=this,e=new Array;if(this.mapSetting.baseUrl){var n=new l.EsriTiledLayer("base_arcgis_tiled",this.mapSetting.baseUrl,"\u74e6\u7247\u56fe\u5c42");e.push(n)}if(this.mapSetting.webTiledUrl){var o=this.getTileInfo(),i=new esri.layers.WebTiledLayer(this.mapSetting.webTiledUrl,{tileInfo:o});(n=new l.EsriTiledLayer("base_arcgis_tiled",null,"\u74e6\u7247\u56fe\u5c42")).layer=i,e.push(n)}return this.baseLayers=e,this.baseLayers.forEach(function(e){return e.appendTo(t.innerMap)}),e},e.prototype.onShowTooltip=function(t){var e=t.attributes,n=new esri.geometry.Point(e.longitude,e.latitude,this.spatial),o=this.innerMap.toScreen(n),i=e.name;this.tooltipElement.innerHTML="<div>"+i+"</div>",this.tooltipElement.style.left=o.x+8+"px",this.tooltipElement.style.top=o.y+8+"px",this.tooltipElement.style.display="block"},e.prototype.onHideTooltip=function(t){this.tooltipElement.style.display="none"},e.prototype.onCreateContextMenu=function(t){for(var e=t.contextMenu,n=this.ctxMenuForMap=new dijit.Menu({onOpen:function(t){this.currentLocation=this.getMapPointFromMenuPosition(t,this.innerMap)}}),o=0;o<e.length;o++)n.addChild(new dijit.MenuItem({label:e[o],onClick:function(e){t.contextMenuClickEvent(this.label)}}));n.startup(),n.bindDomNode(this.innerMap.container)},e.prototype.getTileInfo=function(){if(this.tileInfo)return this.tileInfo;var t=new esri.layers.TileInfo({dpi:96,spatialReference:this.spatial,rows:256,cols:256,origin:{x:-20037508.342787,y:20037508.342787,spatialReference:this.spatial},lods:[{level:"0",scale:591657527.591555,resolution:156543.03392800014},{level:"1",scale:295828763.795777,resolution:78271.51696399994},{level:"2",scale:147914381.897889,resolution:39135.75848200009},{level:"3",scale:73957190.948944,resolution:19567.87924099992},{level:"4",scale:36978595.474472,resolution:9783.93962049996},{level:"5",scale:18489297.737236,resolution:4891.96981024998},{level:"6",scale:9244648.868618,resolution:2445.98490512499},{level:"7",scale:4622324.434309,resolution:1222.992452562495},{level:"8",scale:2311162.217155,resolution:611.4962262813797},{level:"9",scale:305.74811314055756,resolution:1155581.108577},{level:"10",scale:577790.554289,resolution:152.87405657041106},{level:"11",scale:288895.277144,resolution:76.43702828507324},{level:"12",scale:144447.638572,resolution:38.21851414253662},{level:"13",scale:72223.819286,resolution:19.10925707126831},{level:"14",scale:36111.909643,resolution:9.554628535634155},{level:"15",scale:18055.954822,resolution:4.77731426794937},{level:"16",scale:9027.977411,resolution:2.388657133974685},{level:"17",scale:4513.988705,resolution:1.1943285668550503},{level:"18",scale:2256.994353,resolution:.5971642835598172},{level:"19",scale:1128.497176,resolution:.29858214164761665}]});return this.tileInfo=t,t},e}(l.FlagwindMap),l.EsriMap=u,function(t){t.ROUTE_LAYER_OPTIONS={routeType:"Line",onLineStartEvent:function(t,e,n){console.log("onLineStartEvent")},onLineEndEvent:function(t,e,n){console.log("onLineEndEvent")},onMoveEvent:function(t,e,n,o){console.log("onMoveEvent")},onStationEvent:function(t,e,n,o,i){console.log("onStationEvent")}},t.TRACKLINE_OPTIONS={markerUrl:"",markerLabel:"",markerHeight:48,markerWidth:48};var e=function(){function e(e,n,o){this.flagwindMap=e,this.layerName=n,this.options=o,this.trackLines=[],this.options=Q({},t.ROUTE_LAYER_OPTIONS,o),this.moveLineLayer=this.onCreateLineLayer(n+"LineLayer"),this.moveMarkLayer=this.onCreateMovingLayer(n+"MarkerLayer"),this.onAddLayerBefor(),this.moveLineLayer.appendTo(this.flagwindMap.innerMap),this.moveMarkLayer.appendTo(this.flagwindMap.innerMap),this.onAddLayerAfter();var i=this;this.flagwindMap.loaded?i.onLoad():this.flagwindMap.onAddEventListener("load",function(){i.onLoad()})}return Object.defineProperty(e.prototype,"spatial",{get:function(){return this.flagwindMap.spatial},enumerable:!0,configurable:!0}),e.prototype.show=function(){this.moveMarkLayer&&this.moveMarkLayer.show(),null!=this.moveLineLayer&&this.moveLineLayer.show()},e.prototype.hide=function(){this.moveMarkLayer&&this.moveMarkLayer.hide(),this.moveLineLayer&&this.moveLineLayer.hide()},e.prototype.getTrackLine=function(t){var e=this.trackLines.filter(function(e){return e.name===t});return e&&e.length>0?e[0]:null},e.prototype.addTrackSegment=function(e,n,o){var i=this.getTrackLine(e);i||(i=new t.TrackLine(this.flagwindMap,e,o),this.trackLines.push(i)),i.add(n)},e.prototype.getNextSegmentIndex=function(t){var e=this.getTrackLine(t);return e?e.nextSegmentIndex:0},e.prototype.getNextSegment=function(t,e){var n=this.getTrackLine(t);if(n)return n.getNextSegment(e)},e.prototype.getLastSegment=function(t){var e=this.getTrackLine(t);if(e)return e.lastSegment},e.prototype.getActiveCompletedSegment=function(t){var e=this.getTrackLine(t);if(e)return e.activeCompletedSegment},e.prototype.getIsRunning=function(t){var e=this.getTrackLine(t);return!!e&&e.isRunning},e.prototype.stop=function(t){var e=this.getTrackLine(t);null!=e&&e.stop()},e.prototype.move=function(t){var e=this.getTrackLine(t);e&&e.move()},e.prototype.start=function(t){var e=this.getTrackLine(t);e&&(e.stop(),e.start())},e.prototype.pause=function(t){var e=this.getTrackLine(t);e&&e.pause()},e.prototype.continue=function(t){var e=this.getTrackLine(t);e&&e.continue()},e.prototype.changeSpeed=function(t,e){var n=this.getTrackLine(t);n&&n.changeSpeed(e)},e.prototype.clear=function(t){if(t)if(t){var e=this.getTrackLine(t);if(null==e)return;e.stop(),this.moveMarkLayer.removeGraphicByName(t),this.moveLineLayer.removeGraphicByName(t),e.markerGraphic=null;var n=this.trackLines.indexOf(e);n>=0&&this.trackLines.splice(n,1)}else this.moveMarkLayer.clear(),this.moveLineLayer.clear(),this.trackLines=[];else console.error("\u6ca1\u6709\u6307\u5b9a\u6e05\u9664\u7684\u7ebf\u8def\u540d\u79f0")},e.prototype.clearLine=function(t){t?this.moveLineLayer.removeGraphicByName(t):console.error("\u6ca1\u6709\u6307\u5b9a\u6e05\u9664\u7684\u7ebf\u8def\u540d\u79f0")},e.prototype.clearAll=function(){this.checkMapSetting();for(var t=0;t<this.trackLines.length;t++){var e=this.trackLines[t];e.stop(),e.reset()}this.trackLines=[],this.moveMarkLayer&&this.moveMarkLayer.clear(),this.moveLineLayer&&this.moveLineLayer.clear()},e.prototype.solveSegment=function(e,n,o){if(o=Q({},t.TRACKLINE_OPTIONS,o),this.checkMapSetting(),n.length<1)throw Error("\u7ad9\u70b9\u4e0d\u80fd\u5c11\u4e8e2");var i=this.onGetStandardStops(e,n),r=this.getLastSegment(e),a=r?r.index+1:0;if(r){var s=this.onEqualGraphic(r.endGraphic,i[0]);"NA"===this.options.routeType&&!s&&(this.post(a,e,r.endGraphic,i[0],o),a+=1)}var p=i.splice(0,1)[0],h=i.splice(i.length-1,1)[0],l=i;this.post(a,e,p,h,o,l)},e.prototype.post=function(e,n,o,i,r,a){void 0===a&&(a=[]);var s=this,p=r;p.onShowSegmentLineEvent=function(t){s.onShowSegmentLineEvent(s,t,r)},p.onMoveStartEvent=function(t,e,n){s.onMoveStartEvent(s,t,e,n)},p.onMoveEvent=function(t,e,n){s.onMoveEvent(s,t,e,n)},p.onMoveEndEvent=function(t,e,n){s.onMoveEndEvent(s,t,e,n)};var h=new t.TrackSegment(this,e,n,o,i,p);a&&(h.waypoints=a),this.addTrackSegment(n,h,r),"NA"===this.options.routeType?this.onSolveByService(h,o,i,a):this.onSolveByJoinPoint(h)},e.prototype.solveComplete=function(t,e){var n=t.polyline,o=t.length;e.setPolyLine(n,o),this.onCreateSegmentLineComplete(e)},e.prototype.errorHandler=function(t,e){console.log("\u8def\u7531\u5206\u6790\u5f02\u5e38"+t);var n=[];if(n.push(e.startGraphic.geometry),e.waypoints)for(var o=0;o<e.waypoints.length;o++)n.push(e.waypoints[o].geometry);n.push(e.endGraphic.geometry),e.setMultPoints(n),this.onCreateSegmentLineComplete(e)},e.prototype.onCreateSegmentLineComplete=function(t){console.log()},e.prototype.checkMapSetting=function(){},e.prototype.onShowSegmentLineEvent=function(t,e,n){t.onShowSegmentLine(e)},e.prototype.onMoveStartEvent=function(t,e,n,o){var i=t.getTrackLine(e.name);void 0!==i&&(i.markerGraphic||t.onCreateMoveMark(i,n,o),t.flagwindMap.centerAt(n.geometry.x,n.geometry.y),e.lineGraphic||t.onShowSegmentLine(e),t.options.onStationEvent(e.name,e.index,n,!0,t.getTrackLine(e.name)),0===e.index&&this.options.onLineStartEvent(e.name,e.index,t.getTrackLine(e.name)))},e.prototype.onMoveEndEvent=function(t,e,n,o){var i=t.getNextSegment(e.name,e.index),r=t.getTrackLine(e.name);i?(t.options.onStationEvent(e.name,e.index,n,!1,r),i.start()):(t.options.onStationEvent(e.name,e.index,n,!1,r),e.stop(),t.options.onLineEndEvent(e.name,e.index,r))},e.prototype.onMoveEvent=function(t,e,n,o){var i=this.flagwindMap.onCreatePoint({x:parseFloat(n[0]),y:parseFloat(n[1]),spatial:t.flagwindMap.spatial}),r=t.getTrackLine(e.name);r&&(t.onChangeMovingGraphicSymbol(r,i,o),t.options.onMoveEvent(e.name,e.index,n,o))},e.prototype.onAddLayerBefor=function(){console.log("onAddLayerBefor")},e.prototype.onAddLayerAfter=function(){console.log("onAddLayerAfter")},e.prototype.onLoad=function(){var t=this;this.onAddEventListener(this.moveMarkLayer,"onClick",function(e){t.options.onMovingClick&&t.options.onMovingClick(e)})},e}();t.FlagwindRouteLayer=e}(K||(K={})),c=K||(K={}),d=function(t){function e(e,n,o){var i=t.call(this,e,n,o)||this;return i.flagwindMap=e,i.layerName=n,i.options=o,i.trackLines=[],i}return $(e,t),e.prototype.onSetSegmentByLine=function(t,e){throw new Error("Method not implemented.")},e.prototype.onSetSegmentByPoint=function(t,e){throw new Error("Method not implemented.")},e.prototype.onShowSegmentLine=function(t){var e=new esri.symbol.CartographicLineSymbol(esri.symbol.CartographicLineSymbol.STYLE_SOLID,new esri.Color([38,101,196,.8]),4,esri.symbol.CartographicLineSymbol.CAP_ROUND,esri.symbol.CartographicLineSymbol.JOIN_MITER,2);t.lineGraphic=this.getStandardGraphic(new esri.Graphic(t.polyline,e,{type:"segment",index:t.index,line:t.name})),this.moveLineLayer.addGraphic(t.name,[t.lineGraphic])},e.prototype.onCreateMoveMark=function(t,e,n){var o=t.options.markerUrl,i=t.options.markerHeight||48,r=t.options.markerWidth||48,a=new esri.symbol.PictureMarkerSymbol(o,i,r);return this.getStandardGraphic(new esri.Graphic(e.geometry,a,{type:"marker",line:t.name}))},e.prototype.onCreateLineLayer=function(t){return new c.EsriGroupLayer(t)},e.prototype.onCreateMovingLayer=function(t){return new c.EsriGroupLayer(t)},e.prototype.onEqualGraphic=function(t,e){return c.MapUtils.isEqualPoint(t.geometry,e.geometry)},e.prototype.onGetStandardStops=function(t,e){for(var n=[],o=(new esri.symbol.SimpleMarkerSymbol).setStyle(esri.symbol.SimpleMarkerSymbol.STYLE_CROSS).setSize(15).outline.setWidth(3),i=0;i<e.length;i++)e[i]instanceof Array?n.push(this.getStandardGraphic(new esri.Graphic(new esri.geometry.Point(e[i][0],e[i][1]),o,{type:"stop",line:t}))):(e[i].declaredClass||"").indexOf("Point")>0?n.push(this.getStandardGraphic(new esri.Graphic(e[i],o,{type:"stop",line:t}))):n.push(this.getStandardGraphic(new esri.Graphic(e[i].geometry,o,{type:"stop",model:e[i].attributes,line:t})));return n},e.prototype.onSolveByService=function(t,e,n,o){var i=new esri.tasks.RouteTask(this.options.routeUrl),r=new esri.tasks.RouteParameters;r.stops=new esri.tasks.FeatureSet,r.returnRoutes=!0,r.returnDirections=!0,r.directionsLengthUnits=esri.Units.MILES,r.outSpatialReference=this.getSpatialReferenceFormNA();var a=this;if(i.on("solve-complete",function(e){var n=e.result.routeResults[0],o=n.route.geometry,i=n.directions.totalLength;a.solveComplete({polyline:o,length:i},t)}),i.on("error",function(e){a.errorHandler(e,t)}),r.stops.features.push(this.cloneStopGraphic(e)),o)for(var s=0;s<o.length;s++)r.stops.features.push(this.cloneStopGraphic(o[s]));r.stops.features.push(this.cloneStopGraphic(n)),i.solve(r)},e.prototype.onSolveByJoinPoint=function(t){var e=[];if(e.push(t.startGraphic.geometry),t.waypoints)for(var n=0;n<t.waypoints.length;n++)e.push(t.waypoints[n].geometry);e.push(t.endGraphic.geometry),t.setMultPoints(e)},e.prototype.onAddEventListener=function(t,e,n){t.layer.on(e,n)},e.prototype.getSpatialReferenceFormNA=function(){return new esri.SpatialReference({wkid:this.flagwindMap.spatial.wkid})},e.prototype.getStandardGraphic=function(t){return t.show=function(){console.log("graphic \u7684\u663e\u793a\u65b9\u6cd5\u6ca1\u6709\u5b9e\u73b0")},t.hide=function(){console.log("graphic \u7684\u9690\u85cf\u65b9\u6cd5\u6ca1\u6709\u5b9e\u73b0")},t},e.prototype.cloneStopGraphic=function(t){return this.getStandardGraphic(new esri.Graphic(t.geometry,t.symbol,{type:t.attributes.type,line:t.attributes.line}))},e.prototype.onChangeMovingGraphicSymbol=function(t,e,n){if(void 0!==t){var o=t.markerGraphic.symbol;o.setAngle(360-n),t.markerGraphic.setSymbol(o),t.markerGraphic.setGeometry(e),t.markerGraphic.draw()}},e}(c.FlagwindRouteLayer),c.EsriRouteLayer=d,f=K||(K={}),y=function(){function t(t,e,n){this.id=t,this.url=e,this.title=n,this.isShow=!0,e&&(this.layer=this.onCreateTiledLayer({url:e,id:t,title:n}))}return t.prototype.appendTo=function(t){this.layer&&this.layer.addToMap(t)},t.prototype.removeLayer=function(t){this.layer.removeFormMap(t)},t.prototype.show=function(){this.isShow=!0,this.layer.show()},t.prototype.hide=function(){this.isShow=!1,this.layer.hide()},t}(),f.FlagwindTiledLayer=y,g=K||(K={}),m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $(e,t),e.prototype.onCreateTiledLayer=function(t){var e=new esri.layers.GraphicsLayer(t);return e.addToMap=function(t){t.addLayer(this)},e.removeFormMap=function(t){t.removeLayer(this)},e},e}(g.FlagwindTiledLayer),g.EsriTiledLayer=m,function(t){t.BUSINESS_LAYER_OPTIONS={onLayerClick:function(t){console.log("onLayerClick")},onMapLoad:function(){console.log("onMapLoad")},onEvent:function(t,e){console.log("onEvent")},onCheck:function(t){console.log("onCheck")},onEditInfo:function(t,e){console.log("onEditInfo")},enableEdit:!0,enableSelectMode:!1,selectMode:1,showTooltipOnHover:!0,showInfoWindow:!0};var e=function(e){function n(n,o,i){var r=e.call(this,o,i.title||"\u8bbe\u5907\u56fe\u5c42")||this;return r.flagwindMap=n,r.id=o,r.options=i,i=Q({},t.BUSINESS_LAYER_OPTIONS,i),r.flagwindMap=n,r.options=i,r}return $(n,e),n.prototype.onInit=function(){if(this.onAddLayerBefor(),this.flagwindMap.addFeatureLayer(this),this.onAddLayerAfter(),this.flagwindMap.loaded)this.onLoad();else{var t=this;this.flagwindMap.onAddEventListener("load",function(){t.onLoad()})}},n.prototype.onAddLayerBefor=function(){console.log("onAddLayerBefor")},n.prototype.onAddLayerAfter=function(){console.log("onAddLayerAfter")},Object.defineProperty(n.prototype,"map",{get:function(){return this.flagwindMap.map},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"spatial",{get:function(){return this.flagwindMap.spatial},enumerable:!0,configurable:!0}),n.prototype.gotoCenterById=function(t){var e=this.getGraphicById(t),n=this.getPoint(e.attributes);this.map.centerAt(n).then(function(){console.log(n)})},n.prototype.saveGraphicList=function(t){for(var e=0;e<t.length;e++)this.saveGraphicByModel(t[e])},n.prototype.updateGraphicList=function(t){for(var e=0;e<t.length;e++)this.updateGraphicByModel(t[e])},n.prototype.setSelectStatusByModels=function(t){this.clearSelectStatus();for(var e=0;e<t.length;e++){var n=this.onChangeStandardModel(t[e]),o=this.getGraphicById(n.id);o&&this.setSelectStatus(o,!0)}},n.prototype.saveGraphicByModel=function(t){if((t=this.onChangeStandardModel(t))&&t.id){var e=this.getGraphicById(t.id);return e?this.updateGraphicByModel(t,e):this.addGraphicByModel(t)}},n.prototype.addGraphicByModel=function(t){var e=this.creatGraphicByModel(t);this.layer.add(e)},n.prototype.creatGraphicByModel=function(t){return t=this.onChangeStandardModel(t),this.onValidModel(t)?(t.select=!1,this.onCreatGraphicByModel(t)):null},n.prototype.updateGraphicByModel=function(t,e){if(void 0===e&&(e=null),t=this.onChangeStandardModel(t),this.onValidModel(t)&&(e||(e=this.getGraphicById(t.id)),null!=e)){var n=this.getPoint(t);return this.onUpdateGraphicByModel(t),n}},n.prototype.clearSelectStatus=function(){for(var t=this.layer.graphics,e=0;e<t.length;e++)t[e].attributes.selected&&this.setSelectStatus(t[e],!1)},n.prototype.getSelectedGraphics=function(){return this.layer.graphics.filter(function(t){return t.attributes&&t.attributes.selected})},n.prototype.getPoint=function(t){return this.flagwindMap.getPoint(t)},n.prototype.formPoint=function(t){return this.flagwindMap.onFormPoint(t)},n.prototype.onLoad=function(){this.layer._map||(this.layer._map=this.flagwindMap.innerMap),this.registerEvent(),this.onMapLoad()},n.prototype.onMapLoad=function(){this.options.onMapLoad()},n.prototype.registerEvent=function(){var t=this;this.onAddEventListener("onCliick",function(e){t.onLayerClick(t,e)}),this.options.showTooltipOnHover&&(this.onAddEventListener("onMouseOver",function(e){t.flagwindMap.onShowTooltip(e.graphic)}),this.onAddEventListener("onMouseOut",function(e){t.flagwindMap.onHideTooltip(e.graphic)}))},n.prototype.onLayerClick=function(t,e){if(t.options.onLayerClick&&t.options.onLayerClick(e),t.options.showInfoWindow&&(e.graphic.attributes.eventName="",t.onShowInfoWindow(e)),t.options.enableSelectMode){if(1===t.options.selectMode){var n=e.graphic.attributes;e.graphic.attributes.selected?t.setSelectStatus(n,!1):t.setSelectStatus(n,!0)}else{t.clearSelectStatus();n=e.graphic.attributes;t.setSelectStatus(n,!0)}t.options.onCheck({target:[e.graphic.attributes],check:e.graphic.attributes.selected,selectGraphics:t.getSelectedGraphics()})}},n.prototype.fireEvent=function(t,e){this.options.onEvent(t,e)},n.prototype.setSelectStatus=function(t,e){t.selected=e,this.onUpdateGraphicByModel(t)},n.prototype.onValidModel=function(t){return t.longitude&&t.latitude},n}(t.FlagwindFeatureLayer);t.FlagwindBusinessLayer=e}(K||(K={})),(K||(K={})).EDIT_LAYER_OPTIONS={onEditInfo:function(t,e,n,o){console.log("onEditInfo")}},(K||(K={})).locationLayerOptions={onMapClick:function(t){console.log("onMapClick")}},function(t){t.TRACKSEGMENT_OPTIONS={speed:100,numsOfKilometer:50,autoShowLine:!1,onShowSegmentLineEvent:function(t){console.log("onShowSegmentLineEvent")},onMoveStartEvent:function(t,e,n){console.log("onMoveStartEvent")},onMoveEndEvent:function(t,e,n){console.log("onMoveEndEvent")},onMoveEvent:function(t,e,n){console.log("onMoveEvent")}};var e=function(){function e(e,n,o,i,r,a){this.flagwindRouteLayer=e,this.index=n,this.name=o,this.startGraphic=i,this.endGraphic=r,this.options=a,this.position=-1,this.isCompleted=!1,this.isRunning=!1,this.time=200,this.waypoints=[],this.options=Q({},t.TRACKSEGMENT_OPTIONS,a)}return e.prototype.setPolyLine=function(t,e){this.flagwindRouteLayer.onSetSegmentByLine({polyline:t,length:e},this),this.speed||this.changeSpeed(),this.options.onShowSegmentLineEvent(this)},e.prototype.setMultPoints=function(t){this.flagwindRouteLayer.onSetSegmentByPoint({points:t,spatial:this.flagwindRouteLayer.flagwindMap.spatial},this),this.speed||this.changeSpeed(),console.debug("\u8def\u6bb5"+this.index+"\u957f\u5ea6\uff1a"+this.length+"km"),console.debug("\u8def\u6bb5"+this.index+"\u53d6\u70b9\uff1a"+this.line.length+"\u4e2a"),console.debug("\u8def\u6bb5"+this.index+"\u901f\u5ea6\uff1a"+this.speed+"km/h"),console.debug("\u8def\u6bb5"+this.index+"\u5b9a\u65f6\uff1a"+this.time+"ms"),this.options.onShowSegmentLineEvent(this)},e.prototype.changeSpeed=function(t){void 0===t&&(t=null),0===this.options.numsOfKilometer?(this.speed=1e7,this.time=1):(this.speed=t||this.options.speed,this.time=3600*(this.length||0)/(15*(this.speed||100)*this.line.length)),this.timer&&(this.pause(),this.start())},e.prototype.move=function(e){e.position=e.position+1;var n=0;if(0===e.position)return e.line.length>1&&(n=t.MapUtils.getAngle(e.startGraphic.geometry,{x:e.line[0][0],y:e.line[0][1]})||0),e.options.onMoveStartEvent(e,e.startGraphic,n),void e.options.onMoveEvent(e,[e.startGraphic.geometry.x,e.startGraphic.geometry.y],n);if(e.position>=e.line.length)return this.line.length>1&&(n=t.MapUtils.getAngle({x:this.line[e.line.length-1][0],y:this.line[e.line.length-1][1]},this.endGraphic.geometry)||0),e.isCompleted=!0,e.stop(),e.options.onMoveEvent(e,[e.endGraphic.geometry.x,e.endGraphic.geometry.y],n),void e.options.onMoveEndEvent(e,e.endGraphic,n);n=t.MapUtils.getAngle({x:this.line[this.position-1][0],y:this.line[this.position-1][1]},{x:this.line[this.position][0],y:this.line[this.position][1]});var o=parseFloat(e.line[this.position-1][0]).toFixed(5),i=parseFloat(e.line[this.position-1][1]).toFixed(5);e.options.onMoveEvent(e,[o,i],n)},e.prototype.start=function(){this.isRunning=!0;var t=this;return t.timer=window.setInterval(function(){t.line?t.move(t):console.log("\u7ebf\u8def"+t.name+"\u7684\u7b2c"+(t.index+1)+"\u8def\u6bb5\u7b49\u5f85\u8bbe\u7f6e")},t.time),!0},Object.defineProperty(e.prototype,"isPaused",{get:function(){return!this.timer&&this.isRunning},enumerable:!0,configurable:!0}),e.prototype.pause=function(){window.clearInterval(this.timer),this.timer=null},e.prototype.stop=function(){this.timer&&window.clearInterval(this.timer),this.timer=null,this.isRunning=!1,this.position=-1},e.prototype.reset=function(){this.timer=null,this.isRunning=!1,this.position=-1,this.isCompleted=!1},e}();t.TrackSegment=e;var n=function(){function t(t,e,n){this.flagwindMap=t,this.name=e,this.options=n,this.segments=[],this.isMovingGraphicHide=!1}return t.prototype.hideMovingGraphic=function(){this.isMovingGraphicHide=!0,this.markerGraphic.hide()},t.prototype.showMovingGraphic=function(){this.isMovingGraphicHide&&(this.isMovingGraphicHide=!1,this.markerGraphic.show())},Object.defineProperty(t.prototype,"isRunning",{get:function(){if(0===this.segments.length)return!1;for(var t=0;t<this.segments.length;t++){if(!0===this.segments[t].isRunning)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCompleted",{get:function(){if(0===this.segments.length)return!1;for(var t=0;t<this.segments.length;t++){if(!1===this.segments[t].isCompleted)return!1}return!0},enumerable:!0,configurable:!0}),t.prototype.changeSpeed=function(t){if(0!==this.segments.length)for(var e=0;e<this.segments.length;e++){this.segments[e].changeSpeed(t)}},t.prototype.start=function(){if(!this.isRunning){for(var t=this.segments[0],e=0;e<this.segments.length;e++){var n=this.segments[e];t.index>n.index&&(t=n)}t.start()}},t.prototype.stop=function(){for(var t=0;t<this.segments.length;t++){this.segments[t].stop()}},t.prototype.reset=function(){for(var t=0;t<this.segments.length;t++){this.segments[t].reset()}},t.prototype.pause=function(){for(var t=0;t<this.segments.length;t++){var e=this.segments[t];if(e.isRunning)return void e.pause()}},t.prototype.continue=function(){this.isRunning||this.start();for(var t=0;t<this.segments.length;t++){var e=this.segments[t];if(e.isRunning&&!e.timer)return void e.start()}},t.prototype.move=function(){if(!this.isRunning){var t=this.activeCompletedSegment,e=null;(e=t?this.getSegment(t.index+1):this.getSegment(0))&&e.start()}},t.prototype.add=function(t){this.segments.push(t)},Object.defineProperty(t.prototype,"nextSegmentIndex",{get:function(){if(0===this.segments.length)return 0;for(var t=0,e=0;e<this.segments.length;e++){var n=this.segments[e];n.index>t&&(t=n.index)}return t>0&&(t+=1),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastSegment",{get:function(){if(0===this.segments.length)return null;for(var t=null,e=0;e<this.segments.length;e++){var n=this.segments[e];(!t||n.index>t.index)&&(t=n)}return t},enumerable:!0,configurable:!0}),t.prototype.getNextSegment=function(t){return 0===this.segments.length?null:this.getSegment(t+1)},t.prototype.getSegment=function(t){var e=null;if(0===this.segments.length)return null;for(var n=0;n<this.segments.length;n++){var o=this.segments[n];o.name===name&&o.index===t&&(e=o)}return e},Object.defineProperty(t.prototype,"activeCompletedSegment",{get:function(){var t=null;if(0!==this.segments.length){for(var e=0;e<this.segments.length;e++){var n=this.segments[e];n.isCompleted&&(null==t||n.index>t.index)&&(t=n)}return t}},enumerable:!0,configurable:!0}),t}();t.TrackLine=n}(K||(K={})),v=K||(K={}),M=function(){function t(){}return t.density=function(t,e,n){var o=[];if(0===n)return o.push(t),o.push(e),o;for(var i=(e.x-t.x)/n,r=(e.y-t.y)/n,a=0;a<n;a++)o.push(new v.MinemapPoint(t.x+a*i,t.y+a*r));return o.push({x:e.x,y:e.y}),o},t.vacuate=function(t,e,n){if(0===n){var o=t[0],i=t[t.length-1];return[o[0],i[i.length-1]]}for(var r=[],a=0;a<t.length;a++)r=r.concat(t[a]);var s=e*n;if(r.length>s){for(var p=0,h=Math.max(Math.floor(r.length/s),1),l=[];p<s;)l.push(r[p]),p+=h;return p!==r.length-1&&l.push(r[r.length-1]),l}return r},t.isEqualPoint=function(t,e){return null==t&&null==e&&(t.x===e.x&&t.y===e.y)},t.getAngle=function(t,e){var n=t.x,o=t.y,i=e.x-n,r=e.y-o;return i>0&&r>=0?Math.round(Math.atan(r/i)/Math.PI*180):i>0&&r<0?360+Math.round(Math.atan(r/i)/Math.PI*180):i<0&&r>=0?180+Math.round(Math.atan(r/i)/Math.PI*180):i<0&&r<0?180+Math.round(Math.atan(r/i)/Math.PI*180):0===i?90:0},t.validGeometryModel=function(t){return t.longitude&&t.latitude},t.delta=function(e,n){var o=.006693421622965943,i=t.transformLat(n-105,e-35),r=t.transformLon(n-105,e-35),a=e/180*t.PI,s=Math.sin(a);s=1-o*s*s;var p=Math.sqrt(s);return{lat:i=180*i/(6335552.717000426/(s*p)*t.PI),lon:r=180*r/(6378245/p*Math.cos(a)*t.PI)}},t.point25To2=function(t,e){return{lat:(0-321586.1*t-629486.1*e+0xdb613eebb21-34214413461469.996)/-512844508966.97,lon:(380061.7*t-850786*e+20375618547620+40435790429590)/512844508966.97}},t.point2To25=function(t,e){return{lat:380061.7*e-321586.1*t+23949170,lon:629486.1*t+850786*e-106392700}},t.mercatorUnproject=function(t,e){for(var n=180/Math.PI,o=Math.sqrt(.00669437999014133),i=Math.exp(-e/6378137),r=Math.PI/2-2*Math.atan(i),a=.1,s=0,p=0;p<15&&Math.abs(a)>1e-7;p++)s=o*Math.sin(r),s=Math.pow((1-s)/(1+s),o/2),r+=a=Math.PI/2-2*Math.atan(i*s)-r;return{lat:r*n,lon:t*n/6378137}},t.gcj_encrypt=function(e,n){if(t.outOfChina(e,n))return{lat:e,lon:n};var o=t.delta(e,n);return{lat:e+o.lat,lon:n+o.lon}},t.gcj_decrypt=function(e,n){if(t.outOfChina(e,n))return{lat:e,lon:n};var o=t.delta(e,n);return{lat:e-o.lat,lon:n-o.lon}},t.gcj_decrypt_exact=function(e,n){for(var o,i,r=.01,a=.01,s=e-r,p=n-a,h=e+r,l=n+a,u=0;;){o=(s+h)/2,i=(p+l)/2;var c=t.gcj_encrypt(o,i);if(r=c.lat-e,a=c.lon-n,Math.abs(r)<1e-9&&Math.abs(a)<1e-9)break;if(r>0?h=o:s=o,a>0?l=i:p=i,++u>1e4)break}return{lat:o,lon:i}},t.bd_encrypt=function(e,n){var o=n,i=e,r=Math.sqrt(o*o+i*i)+2e-5*Math.sin(i*t.X_PI),a=Math.atan2(i,o)+3e-6*Math.cos(o*t.X_PI),s=r*Math.cos(a)+.0065;return{lat:r*Math.sin(a)+.006,lon:s}},t.bd_decrypt=function(e,n){var o=n-.0065,i=e-.006,r=Math.sqrt(o*o+i*i)-2e-5*Math.sin(i*t.X_PI),a=Math.atan2(i,o)-3e-6*Math.cos(o*t.X_PI),s=r*Math.cos(a);return{lat:r*Math.sin(a),lon:s}},t.mercator_encrypt=function(e,n){var o=20037508.34*n/180,i=Math.log(Math.tan((90+e)*t.PI/360))/(t.PI/180);return{lat:i=20037508.34*i/180,lon:o}},t.lonlat2mercator=function(t,e){var n={lon:0,lat:0},o=20037508.34*e/180,i=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return i=20037508.34*i/180,n.lon=o,n.lat=i,n},t.mercator2lonlat=function(t,e){var n={lon:0,lat:0},o=e/20037508.34*180,i=t/20037508.34*180;return i=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2),n.lon=o,n.lat=i,n},t.mercator_decrypt=function(e,n){var o=n/20037508.34*180,i=e/20037508.34*180;return{lat:i=180/t.PI*(2*Math.atan(Math.exp(i*t.PI/180))-t.PI/2),lon:o}},t.distance=function(e,n,o,i){var r=Math.cos(e*t.PI/180)*Math.cos(o*t.PI/180)*Math.cos((n-i)*t.PI/180)+Math.sin(e*t.PI/180)*Math.sin(o*t.PI/180);return r>1&&(r=1),r<-1&&(r=-1),6371e3*Math.acos(r)},t.outOfChina=function(t,e){return e<72.004||e>137.8347||(t<.8293||t>55.8271)},t.transformLat=function(e,n){var o=2*e-100+3*n+.2*n*n+.1*e*n+.2*Math.sqrt(Math.abs(e));return o+=2*(20*Math.sin(6*e*t.PI)+20*Math.sin(2*e*t.PI))/3,o+=2*(20*Math.sin(n*t.PI)+40*Math.sin(n/3*t.PI))/3,o+=2*(160*Math.sin(n/12*t.PI)+320*Math.sin(n*t.PI/30))/3},t.transformLon=function(e,n){var o=300+e+2*n+.1*e*e+.1*e*n+.1*Math.sqrt(Math.abs(e));return o+=2*(20*Math.sin(6*e*t.PI)+20*Math.sin(2*e*t.PI))/3,o+=2*(20*Math.sin(e*t.PI)+40*Math.sin(e/3*t.PI))/3,o+=2*(150*Math.sin(e/12*t.PI)+300*Math.sin(e/30*t.PI))/3},t.PI=3.141592653589793,t.X_PI=52.35987755982988,t}(),v.MapUtils=M,w=K||(K={}),L=function(){function t(t){if(!t)throw new w.ArgumentException("items");this._index=0,this._current=void 0,this._items=t}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),t.prototype.next=function(){var t=this._items;return this._index<t.length&&(this._current=t[this._index++],!0)},t}(),w.Enumerator=L,S=K||(K={}),b=function(){function t(t,e){this._key=t,this._value=e}return Object.defineProperty(t.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return"["+(this._key||"")+", "+(this._value||"")+"]"},t}(),S.KeyValuePair=b,E=K||(K={}),P=function(){function t(){this._keys=[],this._values=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){var n=this._keys,o=n.indexOf(t);return-1===o&&(n[o=n.length]=t),this._values[o]=e,this},t.prototype.get=function(t){var e=this._keys.indexOf(t);return-1!==e?this._values[e]:void 0},t.prototype.has=function(t){return-1!==this._keys.indexOf(t)},t.prototype.delete=function(t){var e=this._keys.indexOf(t);return-1!==e&&(this._keys.splice(e,1),this._values.splice(e,1),!0)},t.prototype.clear=function(){this._keys.length=0,this._values.length=0},t.prototype.getEnumerator=function(){var t=this.entries();return new E.Enumerator(t)},t.prototype.forEach=function(t,e){for(var n=this._keys,o=this._values,i=0,r=n.length;i<r;i++)t.call(e,new E.KeyValuePair(n[i],o[i]),this)},t.prototype.keys=function(){return this._keys},t.prototype.values=function(){return this._values},t.prototype.entries=function(){var t=new Array;return this.forEach(function(e,n){t.push(new E.KeyValuePair(e.key,e.value))}),t},t.prototype.toString=function(){var t=Object.create(null);return this.forEach(function(e,n){t[e.key]=e.value}),JSON.stringify(t)},t.of=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(null==e)return null;var o=new t;return e.forEach(function(t){if(!(t instanceof Array))throw new E.Exception("\u53c2\u6570\u4e0d\u6b63\u786e");var e=t;o.set(e[0],e[1])}),o},t}(),E.Map=P,k=K||(K={}),_=function(){function t(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._values=[],(t=this._values).push.apply(t,e)}return Object.defineProperty(t.prototype,"size",{get:function(){return this._values.length},enumerable:!0,configurable:!0}),t.prototype.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,o=t;n<o.length;n++){var i=o[n];this.has(i)||this._values.push(i)}return this},t.prototype.get=function(t){return this._values[t]},t.prototype.set=function(t,e){var n=this._values;t>=0&&t<n.length&&(this.has(e)||(n[t]=e))},t.prototype.delete=function(t){var e=this._values,n=e.indexOf(t);return-1!==n&&(e.splice(n,1),!0)},t.prototype.deleteAt=function(t){var e=this._values;t>=0&&t<e.length&&e.splice(t,1)},t.prototype.clear=function(){this._values.length=0},t.prototype.indexOf=function(t,e){return this._values.indexOf(t,e)},t.prototype.has=function(t){return-1!==this._values.indexOf(t)},t.prototype.getEnumerator=function(){return new k.Enumerator(this._values)},t.prototype.forEach=function(){for(var t=this._values,e=arguments[0],n=arguments[1],o=2===e.length,i=0,r=t.length;i<r;i++)o?e.call(n,t[i],this):e.call(n,t[i],i,this)},t.prototype.find=function(t,e){for(var n=this._values,o=0,i=n.length;o<i;o++)if(t.call(e,n[o],o,this))return n[o]},t.prototype.sort=function(t){var e=this._values;this._values=e.sort(t)},t.prototype.union=function(t){var e=t.values();return e.length>0&&this.add.apply(this,e),this},t.prototype.values=function(){return this._values.concat()},t.prototype.toString=function(){return Array.prototype.toString.call(this._values)},t}(),k.Set=_,I=K||(K={}),x=function(t){function e(e){return t.call(this,e)||this}return $(e,t),e}(Error),I.Exception=x,G=K||(K={}),C=function(t){function e(e){return t.call(this,e)||this}return $(e,t),e}(G.Exception),G.ArgumentException=C,A=K||(K={}),O=function(t){function e(e){return t.call(this,e)||this}return $(e,t),e}(A.Exception),A.InvalidOperationException=O,T=K||(K={}),B=function(){function t(t){this.businessLayer=t,this.draggingFlag=!1,this.cursorOverPointFlag=!1}return Object.defineProperty(t.prototype,"map",{get:function(){return this.businessLayer.flagwindMap.map},enumerable:!0,configurable:!0}),t.prototype.registerEvent=function(t){var e=this;t.on("onMouseOver",function(t){console.log("test---\x3eonMouseOver"),e.cursorOverPointFlag=!0,e.map.dragPan.disable()}),t.on("onMouseOut",function(t){console.log("test---\x3eonMouseOut"),e.cursorOverPointFlag=!1,e.map.dragPan.enable()}),t.on("onMouseDown",function(t){e.cursorOverPointFlag&&(e.draggingFlag=!0,console.log("test---\x3eonMouseDown"),window._editLayer=e,console.log("test---\x3emap.on.mousemove"),e.map.on("mousemove",e.mouseMovePoint))}),t.on("onMouseUp",function(t){console.log("test---\x3eonMouseUp"),e.draggingFlag&&(e.draggingFlag=!1,console.log("test---\x3emap.off.mousemove"),e.map.off("mousemove",e.mouseMovePoint),window._editLayer=null,e.updatePoint(e))})},t.prototype.updatePoint=function(t){var e=confirm("\u786e\u5b9a\u8981\u66f4\u65b0\u5750\u6807\u4e3ax:"+t.graphic.geometry.x+",y:"+t.graphic.geometry.x);e?t.onChanged({key:t.graphic.attributes.id,longitude:t.graphic.geometry.x,latitude:t.graphic.geometry.y},e):this.cancelEdit(this.graphic.attributes.id)},t.prototype.mouseMovePoint=function(t){var e=window._editLayer;if(console.log("test--\x3estatus  over:"+e.cursorOverPointFlag+".drag:"+e.draggingFlag),e.draggingFlag){console.log("test--\x3eupdate  x:"+t.lngLat.lng+".y:"+t.lngLat.lat);var n=new T.MinemapPoint(t.lngLat.lng,t.lngLat.lat);e.graphic.geometry=n}},t.prototype.activateEdit=function(t){var e=this.businessLayer.getGraphicById(t);e&&(this.graphic=e.clone(e.id+"_copy")),this.businessLayer.hide(),this.graphic.addTo(this.map),this.registerEvent(this.graphic)},t.prototype.cancelEdit=function(t){this.graphic.remove(),this.map.off("mousemove",this.mouseMovePoint),this.businessLayer.show(),this.cursorOverPointFlag=!1,this.draggingFlag=!1},t.prototype.onChanged=function(t,e){return new Promise(function(t,e){t(!0)})},t}(),T.MinemapEditLayer=B,F=K||(K={}),R=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $(e,t),e.prototype.onCreateGraphicsLayer=function(t){return"marker"===t.kind?new F.MinemapMarkerLayer(t):"geojson"===t.kind?new F.MinemapGeoJsonLayer(t):(console.log("\u672a\u6307\u5b9a\u56fe\u5c42\u7c7b\u578b"),null)},e}(F.FlagwindGroupLayer),F.MinemapGroupLayer=R,j=K||(K={}),N=function(){function t(t,e){this.flagwindMap=t,this.isShow=!1,this.options=e,this.chartOptions={GLMap:{roam:!0},coordinateSystem:"GLMap",title:{text:e.title||"\u70ed\u529b\u56fe\u5c55\u793a",subtext:"",left:"center",textStyle:{color:"#fff"}},tooltip:{trigger:"item"},visualMap:{show:!1,top:"top",min:0,max:10,seriesIndex:0,calculable:!0,inRange:{color:["blue","blue","green","yellow","red"]}},series:[{type:"heatmap",data:[],coordinateSystem:"GLMap",pointSize:8,blurSize:12}]}}return Object.defineProperty(t.prototype,"echartslayer",{get:function(){return null==this._echartslayer&&(this._echartslayer=minemap.Template.create({map:this.flagwindMap.map,type:"heatmap"})),this._echartslayer},enumerable:!0,configurable:!0}),t.prototype.resize=function(){this.echartslayer.resize()},t.prototype.clear=function(){this.chartOptions.series[0].data=[],this.echartslayer.chart.setOption(this.chartOptions)},t.prototype.show=function(){this.isShow=!0,this.echartslayer._container.style.display=""},t.prototype.hide=function(){this.isShow=!1,this.echartslayer._container.style.display="none"},t.prototype.showDataList=function(t){var e=[];t.forEach(function(t){t instanceof Array?e.push(t):e.push([t.x,t.y,t.count])}),this.chartOptions.series[0].data=t,this.echartslayer.chart.setOption(this.chartOptions)},t}(),j.MinemapHotmapLayer=N,U=K||(K={}),H=U.Map.of(["onLoad","load"]),W=function(t){function e(e,n,o){var i=t.call(this,e,n,o)||this;return i.mapSetting=e,i.mapEl=n,i.onInit(),i}return $(e,t),e.prototype.onAddEventListener=function(t,e){var n=H.get(t)||t;this.innerMap.on(n,e)},e.prototype.onCenterAt=function(t){this.innerMap.flyTo({center:[t.x,t.y]})},e.prototype.onCreatePoint=function(t){return new U.MinemapPoint(t.x,t.y,t.spatial||this.spatial)},e.prototype.onCreateMap=function(){minemap.domainUrl="http://"+this.mapSetting.mapDomain,minemap.spriteUrl="http://"+this.mapSetting.mapDomain+"/minemapapi/"+this.mapSetting.mapVersion+"/sprite/sprite",minemap.serviceUrl="http://"+this.mapSetting.mapDomain+"/service",minemap.accessToken=this.mapSetting.accessToken||"25cc55a69ea7422182d00d6b7c0ffa93",minemap.solution=this.mapSetting.wkid||2365;var t=new minemap.Map({container:this.mapEl,style:"http://"+this.mapSetting.mapDomain+"/service/solu/style/id/"+minemap.solution,center:this.mapSetting.center||[116.46,39.92],zoom:this.mapSetting.zoom,pitch:60,maxZoom:this.mapSetting.maxZoom||17,minZoom:this.mapSetting.minZoom||9});this.spatial=new U.MinemapSpatial(minemap.solution);var e=new minemap.Popup({closeOnClick:!0,closeButton:!0,offset:[0,-35]});t.infoWindow=e;var n=this.tooltipElement=document.createElement("div");return n.id="flagwind-map-tooltip",n.classList.add("flagwind-map-tooltip"),t._container.appendChild(n),this.innerMap=t,t},e.prototype.onShowInfoWindow=function(t){if("boolean"==typeof t.closeButton||"boolean"==typeof t.closeOnClick||t.offset){var e={};"boolean"==typeof t.closeButton&&(e.closeButton=t.closeButton),"boolean"==typeof t.closeOnClick&&(e.closeOnClick=t.closeOnClick),t.offset&&(e.offset=t.offset),this.innerMap.infoWindow.remove(),this.innerMap.infoWindow=new minemap.Popup(e)}switch(t.type){case"dom":this.innerMap.infoWindow.setDOMContent(t.content||"");break;case"html":this.innerMap.infoWindow.setHTML(t.content||"");break;case"text":this.innerMap.infoWindow.setText(t.content||"");break;default:this.innerMap.infoWindow.setHTML(t.content||"")}this.innerMap.infoWindow.setLngLat([t.point.x,t.point.y]).addTo(this.innerMap)},e.prototype.onCreateBaseLayers=function(){var t=new Array;return this.baseLayers=t,t},e.prototype.onShowTooltip=function(t){var e=t.attributes,n=t.geometry,o=this.innerMap.project([n.x,n.y]),i=e.name;this.tooltipElement.innerHTML="<div>"+i+"</div>",this.tooltipElement.style.left=o.x+8+"px",this.tooltipElement.style.top=o.y+8+"px",this.tooltipElement.style.display="block"},e.prototype.onHideTooltip=function(t){this.tooltipElement.style.display="none"},e.prototype.onCreateContextMenu=function(t){this.options.onCreateContextMenu&&this.options.onCreateContextMenu(t)},e}(U.FlagwindMap),U.MinemapMap=W,D=K||(K={}),z=function(t){function e(e,n,o,i){var r=t.call(this,n,o,i)||this;return r.businessService=e,r.isLoading=!1,r.onInit(),r}return $(e,t),e.prototype.onCreateGraphicsLayer=function(t){return"marker"===t.kind?new D.MinemapMarkerLayer(t):"geojson"===t.kind?new D.MinemapGeoJsonLayer(t):(console.warn("\u672a\u6307\u5b9a\u56fe\u5c42\u7c7b\u578b"),new D.MinemapMarkerLayer(t))},e.prototype.onShowInfoWindow=function(t){var e=this.businessService.getInfoWindowContext(t.graphic.attributes),n=this.flagwindMap.innerMap.infoWindow;n.setText("<h4 class='info-window-title'>"+e.title+"</h4"+e.content),n.setLngLat([t.graphic.geometry.x,t.graphic.geometry.y])},e.prototype.onAddEventListener=function(t,e){this.layer.on(t,e)},e.prototype.onChangeStandardModel=function(t){return this.businessService.changeStandardModel(t)},e.prototype.onCreatGraphicByModel=function(t){return new D.MinemapMarker({id:t.id,symbol:{className:this.options.dataType||"graphic-tollgate"},point:{y:t.latitude,x:t.longitude},attributes:t})},e.prototype.onUpdateGraphicByModel=function(t){this.removeGraphicById(t.id),this.addGraphicByModel(t)},e.prototype.openInfoWindow=function(t,e){var n=this.getGraphicById(t),o=this.flagwindMap.innerMap.infoWindow;o.setText("<h4 class='info-window-title'>"+e.title+"</h4"+e.content),o.setLngLat([n.geometry.x,n.geometry.y])},e.prototype.showDataList=function(){var t=this;t.isLoading=!0,t.fireEvent("showDataList",{action:"start"}),this.businessService.getDataList().then(function(e){t.isLoading=!1,t.saveGraphicList(e),t.fireEvent("showDataList",{action:"end",attributes:e})}).catch(function(e){t.isLoading=!1,console.log("\u52a0\u8f7d\u5361\u53e3\u6570\u636e\u65f6\u53d1\u751f\u4e86\u9519\u8bef\uff1a",e),t.fireEvent("showDataList",{action:"error",attributes:e})})},e.prototype.start=function(){var t=this;this.timer=setInterval(function(){t.updateStatus()},this.options.timeout||2e4)},e.prototype.stop=function(){this.timer&&clearInterval(this.timer)},e.prototype.updateStatus=function(){var t=this;t.isLoading=!0,t.fireEvent("updateStatus",{action:"start"}),this.businessService.getLastStatus().then(function(e){t.isLoading=!1,t.saveGraphicList(e),t.fireEvent("updateStatus",{action:"end",attributes:e})}).catch(function(e){t.isLoading=!1,console.log("\u52a0\u8f7d\u5361\u53e3\u72b6\u6001\u65f6\u53d1\u751f\u4e86\u9519\u8bef\uff1a",e),t.fireEvent("updateStatus",{action:"error",attributes:e})})},e}(D.FlagwindBusinessLayer),D.MinemapPointLayer=z,J=K||(K={}),V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $(e,t),e.prototype.onSetSegmentByLine=function(t,e){if(e.polyline=t.polyline,e.length=t.length,e.polyline.path&&e.polyline.path.length>0){var n=e.options.numsOfKilometer;e.line=J.MapUtils.vacuate([e.polyline.path],e.length,n)}},e.prototype.onSetSegmentByPoint=function(t,e){for(var n=t.points,o=t.length||J.MinemapUtils.distance(n),i=e.options.numsOfKilometer,r=new J.MinemapPolyline,a=[],s=0;s<n.length-1;s++){var p=n[s],h=n[s+1];J.MapUtils.density(p,h,o*i).forEach(function(t){a.push([t.x,t.y])})}r.path=a,e.length=o,e.polyline=r,e.line=J.MapUtils.vacuate([e.polyline.path],e.length,i)},e.prototype.onCreateMovingLayer=function(t){return new J.MinemapGroupLayer({id:t,kind:"marker"})},e.prototype.onCreateLineLayer=function(t){return new J.MinemapGroupLayer({id:t,kind:"geojson"})},e.prototype.onEqualGraphic=function(t,e){return null!=t&&null!=e&&(t.geometry.x!==e.geometry.x||t.geometry.y!==e.geometry.y)},e.prototype.onShowSegmentLine=function(t){var e=new J.MinemapGeoJson(this.moveLineLayer.layer,{id:t.name+"_"+t.index,type:"line",geometry:t.polyline,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff0000","line-width":6}});t.lineGraphic=e,this.moveLineLayer.addGraphic(t.name,e)},e.prototype.onGetStandardStops=function(t,e){var n=[];return null==e||0===e.length?n:(e.forEach(function(e){if(!(e instanceof J.MinemapMarker))throw new Error("\u672a\u77e5\u7684\u505c\u9760\u70b9\u5b9a\u4e49.");e.attributes.__type="stop",e.attributes.__line=t,n.push(e)}),e)},e.prototype.onSolveByService=function(t,e,n,o){var i=t.startGraphic.geometry.x+","+t.startGraphic.geometry.y,r=t.endGraphic.geometry.x+","+t.endGraphic.geometry.y,a=null;o&&(a=o.join(","));var s=this;minemap.service.queryRouteDrivingResult2(i,r,a,1,16,1,0,0,function(e,n){if(e)s.errorHandler(e,t);else{var o=new J.RouteResult(n);s.solveComplete({polyline:o.getLine(s.spatial),length:o.data.rows[0].distance},t)}})},e.prototype.onSolveByJoinPoint=function(t){var e=[];if(e.push(t.startGraphic.geometry),t.waypoints)for(var n=0;n<t.waypoints.length;n++)e.push(t.waypoints[n].geometry);e.push(t.endGraphic.geometry),t.setMultPoints(e)},e.prototype.onAddEventListener=function(t,e,n){t.layer.on(e,n)},e.prototype.onCreateMoveMark=function(t,e,n){var o=new J.MinemapMarker({id:t.name,symbol:{className:"graphic-car"},point:e.geometry,attributes:e.attributes});t.markerGraphic=o,this.moveMarkLayer.addGraphic(t.name,o)},e.prototype.onChangeMovingGraphicSymbol=function(t,e,n){void 0!==t&&(t.markerGraphic.setAngle(360-n),t.markerGraphic.setGeometry(e))},e}(J.FlagwindRouteLayer),J.MinemapRouteLayer=V,function(t){var e=function(){function e(t){var e=this;console.log(t),this.success=!t.errcode,this.message=t.message,t.data&&(this.data={error:null,rows:null},t.data.error&&(this.data.error=t.data.error),t.data.rows&&(this.data.rows=[],t.data.rows.forEach(function(t){e.data.rows.push(new o(t))})))}return e.prototype.getLine=function(e){var n=new t.MinemapPolyline(e),o=[];return this.data&&this.data.rows&&this.data.rows.forEach(function(t){var n=t.getPoints(e);o=o.concat(n.map(function(t){return[t.x,t.y]}))}),n.path=o,n},e}();t.RouteResult=e;var n=function(){return function(t){t.strguide&&(this.guide=t.strguide),this.streetName=t.streetName,t.distance&&(this.distance=parseFloat(t.distance)),t.duration&&(this.duration=parseFloat(t.duration))}}();t.RouteItem=n;var o=function(){function e(e){var o=this;if(e.mapinfo){if(e.mapinfo.center){var i=e.mapinfo.center.split(",");this.center=new t.MinemapPoint(parseFloat(i[0]),parseFloat(i[1]),null)}e.mapinfo.scale&&(this.scale=parseFloat(e.mapinfo.scale))}if(e.distance&&(this.distance=parseFloat(e.distance)),e.duration&&(this.duration=parseFloat(e.duration)),e.routelatlon){this.points=[];for(var r=e.routelatlon.split(";"),a=0;a<r.length;a++)if(r[a]){i=r[a].split(",");this.points.push([parseFloat(i[0]),parseFloat(i[1])])}}e.routes&&(this.items=[],e.routes.item.forEach(function(t){o.items.push(new n(t))}))}return e.prototype.getPoints=function(e){var n=[];return this.points.forEach(function(o){n.push(new t.MinemapPoint(o[0],o[1],e))}),n},e.prototype.getLine=function(e){var n=new t.MinemapPolyline(e),o=[];return this.points.forEach(function(t){o.push([t[0],t[1]])}),n.path=o,n},e}();t.RouteRow=o}(K||(K={})),function(t){var e=function(){return function(t,e){this.type=t,this.spatial=e}}();t.MinemapGeometry=e;var n=function(t){function e(e){void 0===e&&(e=null);var n=t.call(this,"Polyline",e)||this;return n.path=[],n}return $(e,t),e.prototype.getPoint=function(t){return this.path[t]},e.prototype.insertPoint=function(t,e){this.path.splice(t,0,e)},e.prototype.removePoint=function(t){this.path.splice(t,1)},e.prototype.toJson=function(){return{type:"geojson",data:{type:"Feature",properties:this.attributes||{},geometry:{type:"LineString",coordinates:this.path}}}},e}(e);t.MinemapPolyline=n;var o=function(t){function e(e){void 0===e&&(e=null);var n=t.call(this,"Line",e)||this;return n.rings=[],n}return $(e,t),e.prototype.addRing=function(t){this.rings.push(t)},e.prototype.removeRing=function(t){if(t>this.rings.length)throw new Error("\u6570\u7ec4\u8d8a\u754c");this.rings=this.rings.splice(t,1)},e.prototype.getPoint=function(t,e){if(t>this.rings.length)throw new Error("\u6570\u7ec4\u8d8a\u754c");return this.rings[t][e]},e.prototype.insertPoint=function(t,e,n){if(t>this.rings.length)throw new Error("\u6570\u7ec4\u8d8a\u754c");this.rings[t].splice(e,0,n)},e.prototype.removePoint=function(t,e){if(t>this.rings.length)throw new Error("\u6570\u7ec4\u8d8a\u754c");this.rings[t].splice(e,1)},e.prototype.toJson=function(){return{type:"geojson",data:{type:"Feature",properties:this.attributes,geometry:{type:"Polygon",coordinates:this.rings}}}},e}(e);t.MinemapPolygon=o;var i=function(t){function e(e,n,o){void 0===o&&(o=null);var i=t.call(this,"Point",o)||this;return i.x=e,i.y=n,i.spatial=o,i}return $(e,t),e.prototype.toJson=function(){return{type:"Feature",properties:this.attributes,geometry:{type:"Point",coordinates:[this.x,this.y]}}},e}(e);t.MinemapPoint=i;var r=function(){return function(t){this.wkid=t}}();t.MinemapSpatial=r;var a=function(){function e(e){this._kind="marker",this._isInsided=!1,this.isShow=!0,this.EVENTS_MAP=new t.Map,this.id=e.id,this.element=document.createElement("div"),this.element.id=this.id,this.symbol=e.symbol,this.attributes=e.attributes,e.symbol&&e.symbol.className&&(this.element.classList=[e.symbol.className]),this.marker=new minemap.Marker(this.element,{offset:[-25,-25]}),e.point&&(this._geometry=new i(e.point.x,e.point.y),this.marker.setLngLat([e.point.x,e.point.y]));var n=this;this.element.onmouseover=function(t){console.log("fire marker onMouseOver"),n.onCallBack("onMouseOver",{graphic:n,mapPoint:n.geometry,orgion:t})},this.element.onmouseout=function(t){console.log("fire marker onMouseOut"),n.onCallBack("onMouseOut",{graphic:n,mapPoint:n.geometry,orgion:t})},this.element.onmousedown=function(t){console.log("fire marker onMouseDown"),n.onCallBack("onMouseDown",{graphic:n,mapPoint:n.geometry,orgion:t})},this.element.onmouseup=function(t){console.log("fire marker onMouseUp"),n.onCallBack("onMouseUp",{graphic:n,mapPoint:n.geometry,orgion:t})},this.element.onclick=function(t){console.log("fire marker onClick"),n.onCallBack("onClick",{graphic:n,mapPoint:n.geometry,orgion:t})}}return e.prototype.clone=function(t){return new e({id:t,symbol:this.symbol,attributes:this.attributes,point:this.geometry})},Object.defineProperty(e.prototype,"kind",{get:function(){return this._kind},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInsided",{get:function(){return this._isInsided},enumerable:!0,configurable:!0}),e.prototype.on=function(t,e){this.EVENTS_MAP.set(t,e)},e.prototype.off=function(t,e){this.EVENTS_MAP.delete(t)},e.prototype.onCallBack=function(t,e){var n=this.EVENTS_MAP.get(t);if(n&&n(e),this.layer){var o=this.layer.getCallBack(t);o&&o(e)}},e.prototype.show=function(){if(!this.layer)throw new t.Exception("\u8be5\u8981\u7d20\u6ca1\u6709\u6dfb\u52a0\u5230\u56fe\u5c42\u4e0a\uff0c\u82e5\u60f3\u663e\u793a\u8be5\u8981\u7d20\u8bf7\u8c03\u7528addToMap\u65b9\u6cd5");this.marker.addTo(this.layer.map),this.isShow=!1},e.prototype.hide=function(){this.marker.remove(),this.isShow=!1},e.prototype.remove=function(){this._isInsided&&(this.marker.remove(),this._isInsided=!1)},e.prototype.delete=function(){this._isInsided&&(this.marker.remove(),this._isInsided=!1),this.layer&&this.layer.remove(this)},e.prototype.setAngle=function(t){this.element.style.transform="rotate("+t+"deg)",this.element.style["-ms-transform"]="rotate("+t+"deg)",this.element.style["-moz-transform"]="rotate("+t+"deg)",this.element.style["-webkit-transform"]="rotate("+t+"deg)",this.element.style["-o-transform"]="rotate("+t+"deg)"},e.prototype.setSymbol=function(t){this.symbol&&this.symbol.className&&this.element.classList.remove(this.symbol.className),t.className&&this.element.classList.push(t.className)},e.prototype.draw=function(){console.log("draw")},Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(t){this._geometry=t,this.marker.setLngLat([t.x,t.y])},enumerable:!0,configurable:!0}),e.prototype.setGeometry=function(t){if(!(t instanceof i))throw new Error("\u4e0d\u5339\u914d\u7c7b\u578b");this.geometry=t},e.prototype.addTo=function(t){this._isInsided=!0,this.marker.addTo(t)},e}();t.MinemapMarker=a;var s=function(){function n(n,o){if(this.layer=n,this._kind="geojson",this._isInsided=!1,this.isShow=!0,this.attributes={},o&&o.id&&(this.id=o.id),o&&o.type&&(this.type=o.type),o&&o.paint&&(this.paint=o.paint),o&&o.layout&&(this.layout=o.layout),o&&o.attributes&&(this.attributes=o.attributes),o&&o.geometry){if(!(o.geometry instanceof e))throw new t.Exception("geometry \u7c7b\u578b\u4e0d\u6b63\u786e");this.geometry=o.geometry}o&&o.symbol&&(o.symbol.layout&&(this.layout=o.symbol.layout),o.symbol.paint&&(this.layout=o.symbol.paint))}return Object.defineProperty(n.prototype,"kind",{get:function(){return this._kind},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isInsided",{get:function(){return this._isInsided},enumerable:!0,configurable:!0}),n.prototype.show=function(){this.isShow||(this.addLayer(this.layer.map),this.isShow=!0)},n.prototype.hide=function(){this.layer.map.removeLayer(this.id),this.isShow=!1},n.prototype.remove=function(){this.layer.map.removeLayer(this.id)},n.prototype.delete=function(){this.isInsided&&(this.layer.map.removeLayer(this.id),this._isInsided=!1,this.layer.remove(this))},n.prototype.setSymbol=function(t){t&&t.paint&&(this.paint=t.paint),t&&t.layout&&(this.layout=t.layout)},Object.defineProperty(n.prototype,"geometry",{get:function(){return this._geometry},set:function(t){this._geometry=t},enumerable:!0,configurable:!0}),n.prototype.setGeometry=function(t){t instanceof n&&(this.geometry=t)},n.prototype.addTo=function(e){if(e){if(!this.id)throw new t.Exception("\u6ca1\u6709\u6307\u5b9aid\uff0c\u65e0\u6cd5\u6dfb\u52a0");var n=this.geometry.toJson();console.log(n),e.addSource(this.id+"_source",n)}},n.prototype.addLayer=function(t){var e={id:this.id,source:this.id+"_source",type:this.type,paint:this.paint,layout:this.layout};t.addLayer(e)},n}();t.MinemapGeoJson=s;var p=function(){function e(e){this.options=e,this.GRAPHICS_MAP=new t.Map,this.EVENTS_MAP=new t.Map,this._isInsided=!1,this.id=e.id}return Object.defineProperty(e.prototype,"isInsided",{get:function(){return this._isInsided},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graphics",{get:function(){return 0===this.GRAPHICS_MAP.size?new Array:this.GRAPHICS_MAP.values()},enumerable:!0,configurable:!0}),e.prototype.getCallBack=function(t){return this.EVENTS_MAP.get(t)},e.prototype.on=function(t,e){this.EVENTS_MAP.set(t,e)},e.prototype.show=function(){this.GRAPHICS_MAP.forEach(function(t){t.value.isShow||t.value.show()})},e.prototype.hide=function(){this.GRAPHICS_MAP.forEach(function(t){t.value.isShow&&t.value.hide()})},e.prototype.remove=function(t){this.GRAPHICS_MAP.delete(t.id),t.isInsided&&t.delete()},e.prototype.clear=function(){this.GRAPHICS_MAP.forEach(function(t){return t.value.remove()}),this.GRAPHICS_MAP.clear()},e.prototype.add=function(t){this.GRAPHICS_MAP.set(t.id,t),t.layer=this,this.map&&t.addTo(this.map)},e.prototype.addToMap=function(t){this.map||this.GRAPHICS_MAP.forEach(function(e){e.value.addTo(t)}),this.map=t,this._isInsided=!0},e.prototype.removeFromMap=function(t){this.GRAPHICS_MAP.forEach(function(t){t.value.remove()}),this._isInsided=!1},e}();t.MinemapMarkerLayer=p;var h=function(){function e(e){this.GRAPHICS_MAP=new t.Map,this._isInsided=!1,this.id=e.id}return Object.defineProperty(e.prototype,"isInsided",{get:function(){return this._isInsided},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graphics",{get:function(){return this.GRAPHICS_MAP.values()},enumerable:!0,configurable:!0}),e.prototype.show=function(){this.GRAPHICS_MAP.forEach(function(t){t.value.isShow||t.value.show()})},e.prototype.hide=function(){this.GRAPHICS_MAP.forEach(function(t){t.value.isShow&&t.value.hide()})},e.prototype.remove=function(t){this.GRAPHICS_MAP.delete(t.id),t.isInsided&&t.delete()},e.prototype.clear=function(){this.GRAPHICS_MAP.forEach(function(t){return t.value.remove()}),this.GRAPHICS_MAP.clear()},e.prototype.add=function(t){this.GRAPHICS_MAP.set(t.id,t),this.map&&(t.addTo(this.map),t.addLayer(this.map))},e.prototype.addToMap=function(t){this.map||this.GRAPHICS_MAP.forEach(function(e){return e.value.addLayer(t)}),this.map=t,this._isInsided=!0},e.prototype.removeFromMap=function(t){this.GRAPHICS_MAP.forEach(function(t){return t.value.delete()}),this._isInsided=!1},e.prototype.on=function(t,e){throw new Error("Method not implemented.")},e}();t.MinemapGeoJsonLayer=h}(K||(K={})),Z=K||(K={}),q=function(){return function(){this.mapDomain="minedata.cn",this.mapVersion="v1.3",this.accessToken="25cc55a69ea7422182d00d6b7c0ffa93",this.units=.03,this.center=[116.46,39.92],this.wkidFromApp=4326,this.is25D=!1,this.minZoom=9,this.maxZoom=17,this.zoom=16,this.logo=!1,this.slider=!0}}(),Z.MinemapSetting=q,Y=K||(K={}),X=function(){function t(){}return t.getLength=function(t,e){return turf.distance(t.toJson(),e.toJson(),"kilometers")},t.distance=function(e,n){void 0===n&&(n=100),null==n&&(n=e.length);var o=1;e.length>n&&(o=Math.max(Math.floor(e.length/n),1));var i=0,r=0;for(r=0;r<=e.length-o;r+=o){var a=e[r],s=e[r+o];i+=t.getLength(a,s)}return r<e.length-1&&(i+=t.getLength(e[r],e[e.length-1])),i},t}(),Y.MinemapUtils=X,Object.defineProperty(t,"__esModule",{value:!0}),t.default=K});