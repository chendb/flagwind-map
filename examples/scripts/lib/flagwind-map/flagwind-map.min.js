/*!
* flagwind-map v1.0.0 
* 
* Authors:
*      chendebao <hbchendb1985@gmail.com>
* 
* Licensed under the MIT License.
* Copyright (C) 2018-2018 Flagwind Inc. All rights reserved. 
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.flagwind={})}(this,function(t){"use strict";var e,i,n,o,r,a,s,p,c,l,h,u,d,y,f,m,g,v,M,S,w,L,b,k,P,_,G,E,I,x,A=this&&this.__extends||(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}),C=this&&this.__assign||Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++){e=arguments[i];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t};!function(t){var e=function(){return function(){}}();t.Animation=e;var i=function(t){function e(e,i,n){var o=t.call(this)||this;return o.graphic=i,o.options=n,o.attributes=e,o.graphic=i,o._id=e.id,o._alpha=1,o._fadeIn=!1,o.options=n,o}return A(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.updateGraphic=function(){this._fadeIn?(this._alpha+=.01,this._alpha>=1&&(this._alpha=1,this._fadeIn=!1)):(this._alpha-=.01,this._alpha<=0&&(this._alpha=0,this._fadeIn=!0));var t=this.getSymbol(),e=this.getColor();e.push(this._alpha),t.setColor(e),this.graphic.setSymbol(t),this.graphic.draw()},e.prototype.getSymbol=function(){var t=new esri.symbol.SimpleMarkerSymbol;return t.setPath(this.options.path),t.setSize(this.options.size),t.setColor(new dojo.Color(this.getColor())),t.setOutline(null),t},e.prototype.getColor=function(){var t=this.options.color;return t||(t=this.options.getColor(this.attributes)),t.length>3&&t.splice(3,1),t},e}(e);t.LightingAnimation=i;var n=function(t){function e(e,i,n){var o=t.call(this)||this;return o.graphic=i,o.options=n,o.index=0,o.attributes=e,o.graphic=i,o.id=e.id,o.index=0,o.options=n,o}return A(e,t),e.prototype.getRandomNum=function(t,e){var i=e-t,n=Math.random();return t+Math.round(n*i)},e.prototype.updateGraphic=function(){var t=this.options.images[this.index],e=this.options.width||48,i=this.options.height||48,n=new esri.symbol.PictureMarkerSymbol(t,e,i);this.graphic.setSymbol(n),this.index=(this.index+1)%this.options.images.length,this.graphic.draw()},e}(e);t.StarAnimation=n;var o=function(){function t(t){this.options=t,this.isRunning=!1,this.animations=[],this.options=t}return t.prototype.getRandomNum=function(t,e){var i=e-t,n=Math.random();return t+Math.round(n*i)},t.prototype.getAnimationId=function(t){var e=this.animations.filter(function(e){return e.id===t});return e&&e.length>0?e[0]:null},t.prototype.start=function(){this.isRunning=!0;var t=this;this._timer=setInterval(function(){t.animations.forEach(function(e){t.getRandomNum(0,10)>5&&e.updateGraphic()})},this.options.timeout||20)},t.prototype.stop=function(){this.isRunning=!1,this._timer&&clearInterval(this._timer)},t.prototype.add=function(t){this.animations.push(t)},t.prototype.removeAnimationById=function(t){var e=this.getAnimationId(t);if(e){var i=this.animations.indexOf(e);i>=0&&this.animations.splice(i,1)}},t.prototype.clear=function(){this.stop(),this.animations=[]},t}();t.AnimationLayer=o}(E||(E={})),function(t){var e=function(){function t(t,e,i,n){this.mapService=t,this.id=e,this.url=i,this.title=n,this.isShow=!0,i&&(this.layer=t.createTiledLayer({url:i,id:e,title:n}))}return t.prototype.appendTo=function(t){this.layer&&this.mapService.addLayer(this.layer,t)},t.prototype.removeLayer=function(t){this.mapService.removeLayer(this.layer,t)},t.prototype.show=function(){this.isShow=!0,this.mapService.showLayer(this.layer)},t.prototype.hide=function(){this.isShow=!1,this.mapService.hideLayer(this.layer)},t}();t.FlagwindTiledLayer=e;var i=function(){function t(t,e,i){this.mapService=t,this.id=e,this.title=i,this.isShow=!0,this.id=e,this.layer=t.createGraphicsLayer({id:e})}return Object.defineProperty(t.prototype,"graphics",{get:function(){return this.mapService.getGraphicListByLayer(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){var t=this;return this.graphics.map(function(e){return t.mapService.getGraphicAttributes(e)})},enumerable:!0,configurable:!0}),t.prototype.appendTo=function(t){this.mapService.addLayer(this.layer,t)},t.prototype.removeLayer=function(t){this.mapService.removeLayer(this.layer,t)},Object.defineProperty(t.prototype,"count",{get:function(){return this.layer?this.graphics.length:0},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.mapService.clearLayer(this.layer)},t.prototype.show=function(){this.isShow=!0,this.mapService.showLayer(this.layer)},t.prototype.hide=function(){this.isShow=!1,this.mapService.hideLayer(this.layer)},t.prototype.getGraphicById=function(t){for(var e=this.graphics,i=0;i<e.length;i++){if(this.mapService.getGraphicAttributes(e[i]).id===t)return e[i]}return null},t.prototype.removeGraphicById=function(t){var e=this.getGraphicById(t);null!=e&&this.mapService.removeGraphic(e,this.layer)},t}();t.FlagwindFeatureLayer=i;var n=function(){function t(t,e){this.mapService=t,this.id=e,this.isShow=!0,this.layer=this.mapService.createGraphicsLayer({id:e})}return Object.defineProperty(t.prototype,"graphics",{get:function(){return this.mapService.getGraphicListByLayer(this.layer)},enumerable:!0,configurable:!0}),t.prototype.appendTo=function(t){this.mapService.addLayer(this.layer,t)},t.prototype.removeLayer=function(t){this.mapService.removeLayer(this.layer,t)},t.prototype.clear=function(){this.mapService.clearLayer(this.layer)},t.prototype.show=function(){this.isShow=!0,this.mapService.showLayer(this.layer)},t.prototype.hide=function(){this.isShow=!1,this.mapService.hideLayer(this.layer)},t.prototype.setGeometry=function(t,e){var i=this;this.getGraphicByName(t).forEach(function(t){i.mapService.setGeometryByGraphic(t,e)})},t.prototype.setSymbol=function(t,e){var i=this;this.getGraphicByName(t).forEach(function(t){i.mapService.setSymbolByGraphic(t,e)})},t.prototype.showGraphice=function(t){var e=this;this.getGraphicByName(t).forEach(function(t){e.mapService.showGraphic(t)})},t.prototype.hideGraphice=function(t){var e=this;this.getGraphicByName(t).forEach(function(t){e.mapService.hideGraphic(t)})},t.prototype.addGraphice=function(t,e){var i=this;void 0!==e&&e.forEach(function(e,n){if(e){var o=i.mapService.getGraphicAttributes(e);o.__master=0===n,o.__name=t,i.mapService.addGraphic(e,i.layer)}})},t.prototype.getMasterGraphicByName=function(t){var e=this;return this.graphics.forEach(function(i){var n=e.mapService.getGraphicAttributes(i);if(t===n.__name&&n.__master)return i}),null},t.prototype.getGraphicByName=function(t){for(var e=[],i=0;i<this.graphics.length;i++){this.mapService.getGraphicAttributes(this.graphics[i]).__name===t&&e.push(this.graphics[i])}return e},t.prototype.removeGraphicByName=function(t){var e=this,i=this.getGraphicByName(t);if(null!=i){var n=this.layer;i.forEach(function(t){e.mapService.removeGraphic(t,n)})}},t}();t.FlagwindGroupLayer=n}(E||(E={})),i=E||(E={}),n=function(t){function e(e,n,o){var r=this;if(o=C({},i.editLayerOptions,o),(r=t.call(this,e.mapService,"edit_"+n.id,"\u7f16\u8f91\u56fe\u5c42")||this).flagwindMap=e,r.mapService=e.mapService,r.deviceLayer=n,r.options=o,r.editObj=new esri.toolbars.Edit(r.flagwindMap.innerMap),r.flagwindMap.addDeviceLayer(r),r.flagwindMap.innerMap.loaded)r.onLoad();else{var a=r;r.flagwindMap.innerMap.on("load",function(){a.onLoad()})}return r}return A(e,t),e.prototype.activateEdit=function(t){var e=this.deviceLayer.getGraphicById(t);if(e){this.deviceLayer.hide(),this.show();var i=this.deviceLayer.creatGraphicByDevice(e.attributes);this.layer.add(i),i.attributes.eventName="start";var n=esri.toolbars.Edit.MOVE;this.editObj.activate(n,i,null),this.deviceLayer.showInfoWindow({graphic:e})}else console.log("\u65e0\u6548\u7684\u4ee3\u7801\uff1a"+t)},e.prototype.cancelEdit=function(t){this.editObj.deactivate(),this.clear(),this.hide(),this.flagwindMap.innerMap.infoWindow.hide(),this.deviceLayer.show();var e=this.deviceLayer.getGraphicById(t);e.attributes.eventName="delete",this.deviceLayer.showInfoWindow({graphic:e})},e.prototype.bindModifyEvent=function(t){var e=this;dojo.connect(dojo.byId(t),"onclick",function(t){var i=t.target.attributes.key.value;e.activateEdit(i)})},e.prototype.bindDeleteEvent=function(t){var e=this;dojo.connect(dojo.byId(t),"onclick",function(t){var i=t.target.attributes.key.value;e.cancelEdit(i)})},e.prototype.onLoad=function(){this.layer._map||(this.layer._map=this.flagwindMap.innerMap);try{this.registerEvent()}catch(t){console.error(t)}},Object.defineProperty(e.prototype,"map",{get:function(){return this.flagwindMap.map},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spatial",{get:function(){return this.flagwindMap.spatial},enumerable:!0,configurable:!0}),e.prototype.onChanged=function(t,e){return this.options.onEditInfo(t,e)},e.prototype.registerEvent=function(){var t=this;dojo.connect(this.layer,"onClick",function(e){t.onLayerClick(t,e)});var e={};console.log("\u7f16\u8f91\u5bf9\u8c61\uff1a"+this.editObj),dojo.on(this.editObj,"graphic-first-move",function(i){console.log("\u8981\u7d20\u79fb\u52a8---------graphic-first-move"),t.flagwindMap.innerMap.infoWindow.hide(),e=i.graphic.attributes}),dojo.on(this.editObj,"graphic-move-stop",function(i){console.log("\u8981\u7d20\u79fb\u52a8---------graphic-move-stop"),t.editObj.deactivate();var n=i.graphic.attributes.id;window.$Modal.confirm({title:"\u786e\u5b9a\u8981\u8fdb\u884c\u66f4\u6539\u5417\uff1f",content:"\u521d\u59cb\u5750\u6807\u503c\uff08\u7ecf\u5ea6\uff09:"+e.longitude+",\uff08\u7eac\u5ea6\uff09:"+e.latitude+"\r\u5f53\u524d\u5750\u6807\u503c\uff08\u7ecf\u5ea6\uff09:"+i.graphic.geometry.x.toFixed(8)+",\uff08\u7eac\u5ea6\uff09:"+i.graphic.geometry.y.toFixed(8),onOk:function(){var e=i.graphic.geometry,o=t.deviceLayer.formPoint(e),r=C({},i.graphic.attributes,o);t.onChanged({id:n,latitude:r.latitude,longitude:r.longitude},!0).then(function(e){e&&(t.deviceLayer.removeGraphicById(r.id),t.deviceLayer.addGraphicByDevice(r))})},onCancel:function(){t.onChanged({id:n,latitude:e.latitude,longitude:e.longitude},!1)}}),i.graphic.attributes.eventName="stop",t.clear(),t.hide(),t.flagwindMap.innerMap.infoWindow.hide(),t.deviceLayer.show()})},e.prototype.onLayerClick=function(t,e){t.deviceLayer.options.onLayerClick&&t.deviceLayer.options.onLayerClick(e),t.deviceLayer.options.showInfoWindow&&t.deviceLayer.showInfoWindow(e)},e}(i.FlagwindFeatureLayer),i.EsriEditLayer=n,o=E||(E={}),r=function(t){function e(e,i){var n=t.call(this,e.mapService,"commonLocationLayer","\u5b9a\u4f4d\u56fe\u5c42")||this;n.flagwindMap=e,n.options=i,n.mapService=e.mapService,i=C({},o.locationLayerOptions,i),n.flagwindMap=e,n.options=i;var r=n;return n.flagwindMap.innerMap.loaded?n.onLoad():n.flagwindMap.innerMap.on("load",function(){r.onLoad()}),n.flagwindMap.addDeviceLayer(n),n}return A(e,t),Object.defineProperty(e.prototype,"map",{get:function(){return this.flagwindMap.map},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spatial",{get:function(){return this.flagwindMap.spatial},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){var t=this;try{this.mapService.addEventListener(this.map,"click",function(e){t.onMapClick(e)})}catch(t){console.error(t)}},e.prototype.createAnimation=function(){this.timer&&clearInterval(this.timer);var t=this,e=this.createSymbol("#de3700"),i=this.createSymbol("#13227a");t.timer=setInterval(function(){t.graphic.__symbol?(t.graphic.__symbol=!1,t.mapService.setSymbolByGraphic(t.graphic,e)):(t.graphic.__symbol=!0,t.mapService.setSymbolByGraphic(t.graphic,i))},300)},e.prototype.onMapClick=function(t){console.log("\u5730\u56fe\u52a0\u8f7d\uff1a"+t);var e=this.graphic=this.creatGraphic(t.mapPoint);this.createAnimation(),this.clear(),this.layer.add(e);var i=this.flagwindMap.formPoint(t.mapPoint);this.options.onMapClick(i)},e.prototype.createSymbol=function(t){return this.mapService.createMarkerSymbol({path:"M511.999488 299.209616m-112.814392 0a110.245 110.245 0 1 0 225.628784 0 110.245 110.245 0 1 0-225.628784 0ZM47.208697 523.662621A0 11.396 0 1 1 47.208697 524.685927ZM511.949346 7.981788c-173.610036 0-314.358641 140.748604-314.358641 314.358641s314.358641 523.932774 314.358641 523.932774 314.358641-350.322737 314.358641-523.932774S685.558359 7.981788 511.949346 7.981788L511.949346 7.981788zM511.949346 453.323623c-86.805018 0-157.177785-70.371744-157.177785-157.176762 0-86.830601 70.372767-157.182902 157.177785-157.182902 86.825484 0 157.201322 70.352301 157.201322 157.182902C669.150668 382.952902 598.774831 453.323623 511.949346 453.323623L511.949346 453.323623zM511.949346 453.323623M583.236949 788.686646l-19.674085 34.075073c201.221908 3.617387 357.506347 30.455639 357.506347 63.026452 0 35.039028-180.857091 63.442938-403.955238 63.442938-309.208341 0-403.962401-28.404933-403.962401-63.442938 0-32.067346 151.486156-58.57507 348.201423-62.841234l-19.780509-34.259268c-214.366276 7.369851-378.251833 47.647183-378.251833 96.232738 0 53.81465 105.338117 97.443309 449.084065 97.443309 248.02077 0 449.082018-43.62559 449.082018-97.443309C961.487759 836.332806 797.602202 796.055474 583.236949 788.686646z",size:40,color:t,outline:null})},e.prototype.creatGraphic=function(t){return new esri.Graphic(t,this.createSymbol("#13227a"))},e}(o.FlagwindFeatureLayer),o.EsriLocationLayer=r,a=E||(E={}),s=function(){function t(){this.ROUTE_MAP=new a.Map,this.GRAPHIC_SYMBOL_MAP=new a.Map}return t.prototype.showInfoWindow=function(t){throw new Error("Method not implemented.")},t.prototype.getTrackLineMarkerGraphic=function(t,e,i){return a.EsriRouteService.getTrackLineMarkerGraphic(t,e,i)},t.prototype.getStandardStops=function(t,e){return a.EsriRouteService.getStandardStops(t,e,null)},t.prototype.showSegmentLine=function(t,e){var i=this.ROUTE_MAP.get(t);null==i&&(i=new a.EsriRouteService(t)),i.showSegmentLine(e)},t.prototype.solveByService=function(t,e,i,n,o){var r=this.ROUTE_MAP.get(t);null==r&&(r=new a.EsriRouteService(t)),r.solveByService(e,i,n,o)},t.prototype.solveByJoinPoint=function(t,e){var i=this.ROUTE_MAP.get(t);null==i&&(i=new a.EsriRouteService(t)),i.solveByJoinPoint(e)},t.prototype.setSegmentByLine=function(t,e,i){var n=this.ROUTE_MAP.get(t);null==n&&(n=new a.EsriRouteService(t)),n.setSegmentByLine(e,i)},t.prototype.setSegmentByPolyLine=function(t,e,i){var n=this.ROUTE_MAP.get(t);null==n&&(n=new a.EsriRouteService(t)),n.setSegmentByPolyLine(e,i)},t.prototype.createMarkerSymbol=function(t){var e=new esri.symbol.SimpleMarkerSymbol;return t.path&&e.setPath(t.path),t.size&&e.setSize(t.size),t.color&&e.setColor(new dojo.Color(t.color)),t.outline&&e.setOutline(t.outline),e},t.prototype.showTitle=function(t,e){var i=t.attributes,n=new esri.geometry.Point(i.longitude,i.latitude,e.spatial),o=e.innerMap.toScreen(n),r=i.name;e.titleDiv.innerHTML="<div>"+r+"</div>",e.titleDiv.style.left=o.x+8+"px",e.titleDiv.style.top=o.y+8+"px",e.titleDiv.style.display="block"},t.prototype.hideTitle=function(t){t.titleDiv.style.display="none"},t.prototype.createTiledLayer=function(t){return new esri.layers.ArcGISTiledMapServiceLayer(t.url,{id:t.id,title:t.title})},t.prototype.clearLayer=function(t){t&&null!=t._map&&t.clear()},t.prototype.removeLayer=function(t,e){e.removeLayer(t)},t.prototype.addLayer=function(t,e){e.addLayer(t)},t.prototype.showLayer=function(t){t.show()},t.prototype.hideLayer=function(t){t.hide()},t.prototype.getGraphicListByLayer=function(t){return t.graphics},t.prototype.createGraphicsLayer=function(t){return new esri.layers.GraphicsLayer(t)},t.prototype.removeGraphic=function(t,e){e.remove(t)},t.prototype.addGraphic=function(t,e){e.add(t)},t.prototype.showGraphic=function(t){var e=this.GRAPHIC_SYMBOL_MAP.get(t);t.setSymbol(e)},t.prototype.hideGraphic=function(t){var e=t.symbol;this.GRAPHIC_SYMBOL_MAP.set(t,e),t.setSymbol(null)},t.prototype.setGeometryByGraphic=function(t,e){t.setGeometry(e)},t.prototype.setSymbolByGraphic=function(t,e){t.setSymbol(e)},t.prototype.getGraphicAttributes=function(t){return t.attributes},t.prototype.addEventListener=function(t,e,i){dojo.on(t,e,i)},t.prototype.centerAt=function(t,e){t.centerAt(e).then(function(){console.log("centerAt:"+e.x+","+e.y)})},t.prototype.createPoint=function(t){return new esri.geometry.Point(t.x,t.y,t.spatial)},t.prototype.createSpatial=function(t){return new esri.SpatialReference({wkid:t})},t.prototype.getInfoWindow=function(t){return t.infoWindow},t.prototype.hideInfoWindow=function(t){t.infoWindow.hide()},t.prototype.formPoint=function(t,e){var i={lat:t.y,lon:t.x};return t.latitude&&t.longitude&&(i.lon=t.longitude,i.lat=t.latitude),e.spatial.wkid!==e.mapSetting.wkidFromApp&&(3857===e.spatial.wkid&&4326===e.mapSetting.wkidFromApp?e.mapSetting.is25D?(console.log("2.5D\u5750\u6807\uff1a"+i.lon+","+i.lat),i=a.MapUtils.point25To2(i.lon,i.lat),console.log("\u9ad8\u5fb7\u5750\u6807\uff1a"+i.lon+","+i.lat),i=a.MapUtils.gcj_decrypt(i.lat,i.lon),console.log("\u539f\u59cb\u5750\u6807\uff1a"+i.lon+","+i.lat)):i=a.MapUtils.mercator2lonlat(i.lat,i.lon):102100===e.spatial.wkid&&4326===e.mapSetting.wkidFromApp?i=a.MapUtils.mercator_decrypt(i.lat,i.lon):4326===e.spatial.wkid&&3857===e.mapSetting.wkidFromApp&&(i=a.MapUtils.mercator_decrypt(i.lat,i.lon))),{longitude:parseFloat(i.lon.toFixed(8)),latitude:parseFloat(i.lat.toFixed(8))}},t.prototype.toPoint=function(t,e){var i={lat:t.latitude||t.lat,lon:t.longitude||t.lon};return a.MapUtils.validDevice(t)||(i.lon=t.x,i.lat=t.y),e.spatial.wkid!==e.mapSetting.wkidFromApp&&(3857===e.spatial.wkid&&4326===e.mapSetting.wkidFromApp?e.mapSetting.is25D?(console.log("\u539f\u59cb\u5750\u6807\uff1a"+i.lon+","+i.lat),i=a.MapUtils.gcj_encrypt(i.lat,i.lon),console.log("\u9ad8\u5fb7\u5750\u6807\uff1a"+i.lon+","+i.lat),i=a.MapUtils.point2To25(i.lon,i.lat),console.log("2.5D\u5750\u6807\uff1a"+i.lon+","+i.lat)):i=a.MapUtils.lonlat2mercator(i.lat,i.lon):102100===e.spatial.wkid&&4326===e.mapSetting.wkidFromApp?i=a.MapUtils.mercator_encrypt(i.lat,i.lon):4326===e.spatial.wkid&&3857===e.mapSetting.wkidFromApp&&(i=a.MapUtils.mercator_encrypt(i.lat,i.lon))),new esri.geometry.Point(i.lon,i.lat,e.spatial)},t.prototype.createBaseLayer=function(t){var e=new Array;if(t.mapSetting.baseUrl){var i=new a.FlagwindTiledLayer(t.mapService,"base_arcgis_tiled",t.mapSetting.baseUrl,"\u74e6\u7247\u56fe\u5c42");e.push(i)}if(t.mapSetting.webTiledUrl){var n=this.getTileInfo(t),o=new esri.layers.WebTiledLayer(t.mapSetting.webTiledUrl,{tileInfo:n});(i=new a.FlagwindTiledLayer(t.mapService,"base_arcgis_tiled",null,"\u74e6\u7247\u56fe\u5c42")).layer=o,e.push(i)}return e},t.prototype.createMap=function(t,e){var i={logo:t.logo,slider:t.slider,zoom:t.zoom,minZoom:t.minZoom,maxZoom:t.maxZoom};if(t.basemap&&(i.basemap=t.basemap),t.extent&&4===t.extent.length){var n=e.getPoint({x:t.extent[0],y:t.extent[1]}),o=e.getPoint({x:t.extent[2],y:t.extent[3]}),r=new esri.geometry.Extent(n.x,n.y,o.x,o.y,e.spatial);i.extent=r}t.webTiledUrl&&(i.lods=this.getTileInfo(e).lods),new esri.Map(e.mapEl,i).infoWindow.anchor="top";var a=e.titleDiv=document.createElement("div");a.classList.add("eg-map-title"),e.innerMap.root.parentElement.appendChild(a)},t.prototype.createContextMenu=function(t,e){for(var i=t.contextMenu,n=e.ctxMenuForMap=new dijit.Menu({onOpen:function(t){e.currentLocation=this.getMapPointFromMenuPosition(t,e.innerMap)}}),o=0;o<i.length;o++)n.addChild(new dijit.MenuItem({label:i[o],onClick:function(e){t.contextMenuClickEvent(this.label)}}));n.startup(),n.bindDomNode(e.innerMap.container)},t.prototype.getMapPointFromMenuPosition=function(t,e){var i=t.x,n=t.y;switch(t.corner){case"TR":i+=t.w;break;case"BL":n+=t.h;break;case"BR":i+=t.w,n+=t.h}var o=new esri.geometry.Point(i-e.position.x,n-e.position.y);return e.toMap(o)},t.prototype.getTileInfo=function(t){if(t.tileInfo)return t.tileInfo;var e=new esri.layers.TileInfo({dpi:96,spatialReference:t.spatial,rows:256,cols:256,origin:{x:-20037508.342787,y:20037508.342787,spatialReference:t.spatial},lods:[{level:"0",scale:591657527.591555,resolution:156543.03392800014},{level:"1",scale:295828763.795777,resolution:78271.51696399994},{level:"2",scale:147914381.897889,resolution:39135.75848200009},{level:"3",scale:73957190.948944,resolution:19567.87924099992},{level:"4",scale:36978595.474472,resolution:9783.93962049996},{level:"5",scale:18489297.737236,resolution:4891.96981024998},{level:"6",scale:9244648.868618,resolution:2445.98490512499},{level:"7",scale:4622324.434309,resolution:1222.992452562495},{level:"8",scale:2311162.217155,resolution:611.4962262813797},{level:"9",scale:305.74811314055756,resolution:1155581.108577},{level:"10",scale:577790.554289,resolution:152.87405657041106},{level:"11",scale:288895.277144,resolution:76.43702828507324},{level:"12",scale:144447.638572,resolution:38.21851414253662},{level:"13",scale:72223.819286,resolution:19.10925707126831},{level:"14",scale:36111.909643,resolution:9.554628535634155},{level:"15",scale:18055.954822,resolution:4.77731426794937},{level:"16",scale:9027.977411,resolution:2.388657133974685},{level:"17",scale:4513.988705,resolution:1.1943285668550503},{level:"18",scale:2256.994353,resolution:.5971642835598172},{level:"19",scale:1128.497176,resolution:.29858214164761665}]});return t.tileInfo=e,console.log(e),e},t}(),a.EsriMapService=s,function(t){t.flagwindRouteOptions={routeType:"Line",onLineStartEvent:function(t,e,i){console.log("onLineStartEvent")},onLineEndEvent:function(t,e,i){console.log("onLineEndEvent")},onMoveEvent:function(t,e,i,n){console.log("onMoveEvent")},onStationEvent:function(t,e,i,n,o){console.log("onStationEvent")}},t.lineOptions={markerUrl:"",markerLabel:"",markerHeight:48,markerWidth:48};var e=function(){function e(e,i,n){this.flagwindMap=e,this.layerName=i,this.options=n,this.trackLines=[],this.options=C({},t.flagwindRouteOptions,n),this.mapService=e.mapService,this.moveLineLayer=new t.FlagwindGroupLayer(e.mapService,i+"LineLayer"),this.moveMarkLayer=new t.FlagwindGroupLayer(e.mapService,i+"MarkerLayer"),this.onAddLayerBefor(),this.moveLineLayer.appendTo(this.flagwindMap.innerMap),this.moveMarkLayer.appendTo(this.flagwindMap.innerMap),this.onAddLayerAfter();var o=this;this.mapService.addEventListener(this.flagwindMap.innerMap,"load",function(){o.onLoad()})}return Object.defineProperty(e.prototype,"spatial",{get:function(){return this.flagwindMap.spatial},enumerable:!0,configurable:!0}),e.prototype.show=function(){this.moveMarkLayer&&this.moveMarkLayer.show(),null!=this.moveLineLayer&&this.moveLineLayer.show()},e.prototype.hide=function(){this.moveMarkLayer&&this.moveMarkLayer.hide(),this.moveLineLayer&&this.moveLineLayer.hide()},e.prototype.getTrackLine=function(t){var e=this.trackLines.filter(function(e){return e.name===t});return e&&e.length>0?e[0]:null},e.prototype.addTrackSegment=function(e,i,n){var o=this.getTrackLine(e);o||(o=new t.TrackLine(this.flagwindMap,e,n),this.trackLines.push(o)),o.add(i)},e.prototype.getNextSegmentIndex=function(t){var e=this.getTrackLine(t);return e?e.nextSegmentIndex:0},e.prototype.getNextSegment=function(t,e){var i=this.getTrackLine(t);if(i)return i.getNextSegment(e)},e.prototype.getLastSegment=function(t){var e=this.getTrackLine(t);if(e)return e.lastSegment},e.prototype.getActiveCompletedSegment=function(t){var e=this.getTrackLine(t);if(e)return e.activeCompletedSegment},e.prototype.getIsRunning=function(t){var e=this.getTrackLine(t);return!!e&&e.isRunning},e.prototype.stop=function(t){var e=this.getTrackLine(t);null!=e&&e.stop()},e.prototype.move=function(t){var e=this.getTrackLine(t);e&&e.move()},e.prototype.start=function(t){var e=this.getTrackLine(t);e&&(e.stop(),e.start())},e.prototype.pause=function(t){var e=this.getTrackLine(t);e&&e.pause()},e.prototype.continue=function(t){var e=this.getTrackLine(t);e&&e.continue()},e.prototype.changeSpeed=function(t,e){var i=this.getTrackLine(t);i&&i.changeSpeed(e)},e.prototype.clear=function(t){if(t){var e=this.getTrackLine(t);null!=e&&(e.stop(),this.moveMarkLayer.removeGraphicByName(t),this.moveLineLayer.removeGraphicByName(t),e.markerGraphic=null)}else console.error("\u6ca1\u6709\u6307\u5b9a\u6e05\u9664\u7684\u7ebf\u8def\u540d\u79f0")},e.prototype.clearLine=function(t){t?this.moveLineLayer.removeGraphicByName(t):console.error("\u6ca1\u6709\u6307\u5b9a\u6e05\u9664\u7684\u7ebf\u8def\u540d\u79f0")},e.prototype.clearAll=function(){this.checkMapSetting();for(var t=0;t<this.trackLines.length;t++){var e=this.trackLines[t];e.stop(),e.reset()}this.trackLines=[],this.moveMarkLayer&&this.moveMarkLayer.clear(),this.moveLineLayer&&this.moveLineLayer.clear()},e.prototype.solveSegment=function(e,i,n){if(n=C({},t.lineOptions,n),this.checkMapSetting(),i.length<1)throw Error("\u7ad9\u70b9\u4e0d\u80fd\u5c11\u4e8e2");var o=this.mapService.getStandardStops(e,i),r=this.getLastSegment(e),a=r?r.index+1:0;if(r){var s=this.equalGraphic(r.endGraphic,o[0]);"NA"===this.options.routeType&&!s&&(this.post(a,e,r.endGraphic,o[0],n),a+=1)}var p=o.splice(0,1)[0],c=o.splice(o.length-1,1)[0],l=o;this.post(a,e,p,c,n,l)},e.prototype.post=function(e,i,n,o,r,a){void 0===a&&(a=[]);var s=this,p=new t.TrackSegmentOptions(r.numsOfKilometer,r.speed,r.autoShowLine);p.onShowSegmentLineEvent=function(t){s.onShowSegmentLineEvent(s,t,r)},p.onMoveStartEvent=function(t,e,i){s.onMoveStartEvent(s,t,e,i)},p.onMoveEvent=function(t,e,i){s.onMoveEvent(s,t,e,i)},p.onMoveEndEvent=function(t,e,i){s.onMoveEndEvent(s,t,e,i)};var c=new t.TrackSegment(this,e,i,n,o,p);a&&(c.waypoints=a),this.addTrackSegment(i,c,r),"NA"===this.options.routeType?this.solveByService(c,n,o,a):this.solveByJoinPoint(c)},e.prototype.solveByService=function(t,e,i,n){this.mapService.solveByService(this,t,e,i,n)},e.prototype.solveByJoinPoint=function(t){this.mapService.solveByJoinPoint(this,t)},e.prototype.solveComplete=function(t,e){var i=t.polyline,n=t.length;e.setPolyLine(i,n),this.onCreateSegmentLineComplete(e)},e.prototype.errorHandler=function(t,e){console.log("\u8def\u7531\u5206\u6790\u5f02\u5e38"+t);var i=[];if(i.push(e.startGraphic.geometry),e.waypoints)for(var n=0;n<e.waypoints.length;n++)i.push(e.waypoints[n].geometry);i.push(e.endGraphic.geometry),e.setLine(i),this.onCreateSegmentLineComplete(e)},e.prototype.onCreateSegmentLineComplete=function(t){console.log()},e.prototype.checkMapSetting=function(){},e.prototype.changeMovingGraphicSymbol=function(t,e,i){if(void 0!==t){var n=t.markerGraphic.symbol;n.setAngle(360-i),t.markerGraphic.setSymbol(n),t.markerGraphic.setGeometry(e),t.markerGraphic.draw()}},e.prototype.onShowSegmentLineEvent=function(t,e,i){i.autoShowSegmentLine&&(e.lineGraphic||t.showSegmentLine(e)),i.onShowSegmentLineEvent&&i.onShowSegmentLineEvent(e)},e.prototype.onMoveStartEvent=function(t,e,i,n){var o=t.getTrackLine(e.name);void 0!==o&&(o.markerGraphic||t.createMoveMark(o,i,n),t.flagwindMap.centerAt(i.geometry.x,i.geometry.y),e.lineGraphic||t.showSegmentLine(e),t.options.onStationEvent(e.name,e.index,i,!0,t.getTrackLine(e.name)),0===e.index&&this.options.onLineStartEvent(e.name,e.index,t.getTrackLine(e.name)))},e.prototype.onMoveEndEvent=function(t,e,i,n){var o=t.getNextSegment(e.name,e.index),r=t.getTrackLine(e.name);o?(t.options.onStationEvent(e.name,e.index,i,!1,r),o.start()):(t.options.onStationEvent(e.name,e.index,i,!1,r),e.stop(),t.options.onLineEndEvent(e.name,e.index,r))},e.prototype.onMoveEvent=function(t,e,i,n){var o=this.mapService.createPoint({x:parseFloat(i[0]),y:parseFloat(i[1]),spatial:t.flagwindMap.spatial}),r=t.getTrackLine(e.name);r&&(t.changeMovingGraphicSymbol(r,o,n),t.options.onMoveEvent(e.name,e.index,i,n))},e.prototype.onAddLayerBefor=function(){console.log("onAddLayerBefor")},e.prototype.onAddLayerAfter=function(){console.log("onAddLayerAfter")},e.prototype.onLoad=function(){var t=this;this.mapService.addEventListener(this.moveMarkLayer,"onClick",function(e){t.options.onMovingClick&&t.options.onMovingClick(e)})},e}();t.FlagwindRouteLayer=e}(E||(E={})),p=E||(E={}),c=function(t){function e(e,i,n){var o=t.call(this,e,i,n)||this;return o.flagwindMap=e,o.layerName=i,o.options=n,o.trackLines=[],o}return A(e,t),e.prototype.showSegmentLine=function(t){var e=new esri.symbol.CartographicLineSymbol(esri.symbol.CartographicLineSymbol.STYLE_SOLID,new esri.Color([38,101,196,.8]),4,esri.symbol.CartographicLineSymbol.CAP_ROUND,esri.symbol.CartographicLineSymbol.JOIN_MITER,2);t.lineGraphic=new esri.Graphic(t.polyline,e,{type:"segment",index:t.index,line:t.name}),this.moveLineLayer.addGraphice(t.name,[t.lineGraphic])},e.prototype.createMoveMark=function(t,e,i){return this.mapService.getTrackLineMarkerGraphic(t,e,i)},e.prototype.equalGraphic=function(t,e){return p.MapUtils.isEqualPoint(t.geometry,e.geometry)},e.prototype.solveByService=function(t,e,i,n){this.mapService.solveByService(this,t,e,i,n)},e.prototype.solveByJoinPoint=function(t){this.mapService.solveByJoinPoint(this,t)},e}(p.FlagwindRouteLayer),p.EsriRouteLayer=c,l=E||(E={}),h=function(){function t(t){this.flagwindRouteLayer=t}return t.prototype.showSegmentLine=function(t){var e=new esri.symbol.CartographicLineSymbol(esri.symbol.CartographicLineSymbol.STYLE_SOLID,new esri.Color([38,101,196,.8]),4,esri.symbol.CartographicLineSymbol.CAP_ROUND,esri.symbol.CartographicLineSymbol.JOIN_MITER,2);t.lineGraphic=new esri.Graphic(t.polyline,e,{type:"segment",index:t.index,line:t.name}),this.flagwindRouteLayer.moveLineLayer.addGraphice(t.name,[t.lineGraphic])},t.prototype.solveByJoinPoint=function(t){var e=[];if(e.push(t.startGraphic.geometry),t.waypoints)for(var i=0;i<t.waypoints.length;i++)e.push(t.waypoints[i].geometry);e.push(t.endGraphic.geometry),t.setLine(e)},t.prototype.solveByService=function(t,e,i,n){var o=new esri.tasks.RouteTask(this.flagwindRouteLayer.options.routeUrl),r=new esri.tasks.RouteParameters;r.stops=new esri.tasks.FeatureSet,r.returnRoutes=!0,r.returnDirections=!0,r.directionsLengthUnits=esri.Units.MILES,r.outSpatialReference=this.getSpatialReferenceFormNA();var a=this.flagwindRouteLayer;if(o.on("solve-complete",function(e){var i=e.result.routeResults[0],n=i.route.geometry,o=i.directions.totalLength;a.solveComplete({polyline:n,length:o},t)}),o.on("error",function(e){a.errorHandler(e,t)}),r.stops.features.push(this.cloneStopGraphic(e)),n)for(var s=0;s<n.length;s++)r.stops.features.push(this.cloneStopGraphic(n[s]));r.stops.features.push(this.cloneStopGraphic(i)),o.solve(r)},t.prototype.setSegmentByLine=function(e,i){var n=e.points,o=e.spatial||i.flagwindRouteLayer.spatial,r=i.options.numsOfKilometer;void 0===r&&(r=20);for(var a=new esri.geometry.Polyline(o),s=0;s<n.length-1;s++){var p=n[s],c=n[s+1],l=new esri.geometry.Polyline(o).addPath([p,c]),h=this.getLength(l,esri.Units.KILOMETERS),u=t.extractPoints(p,c,h*r);a.addPath(u)}i.polyline=a,i.length=this.getLength(a,esri.Units.KILOMETERS),i.line=t.vacuate(a.paths,i.length,r)},t.prototype.setSegmentByPolyLine=function(e,i){if(i.polyline=e.polyline,i.length=length,i.polyline.paths.length>0){var n=i.polyline.paths,o=i.options.numsOfKilometer;void 0===o&&(o=100),i.line=t.vacuate(n,i.length,o)}},t.prototype.getSpatialReferenceFormNA=function(){return new esri.SpatialReference({wkid:this.flagwindRouteLayer.flagwindMap.spatial.wkid})},t.prototype.cloneStopGraphic=function(t){return new esri.Graphic(t.geometry,t.symbol,{type:t.attributes.type,line:t.attributes.line})},t.prototype.getLength=function(t,e){var i=esri.geometry.geodesicLengths([t],e)[0];return this.flagwindRouteLayer.flagwindMap.mapSetting.units*i},t.extractPoints=function(t,e,i){var n=[];if(0===i)return n.push({x:t.x,y:t.y}),n.push({x:e.x,y:e.y}),n;for(var o=(e.x-t.x)/i,r=(e.y-t.y)/i,a=0;a<i;a++)n.push({x:t.x+a*o,y:t.y+a*r});return n.push({x:e.x,y:e.y}),n},t.vacuate=function(t,e,i){if(0===i){var n=t[0],o=t[t.length-1];return[n[0],o[o.length-1]]}for(var r=[],a=0;a<t.length;a++)r=r.concat(t[a]);var s=e*i;if(r.length>s){for(var p=0,c=Math.max(Math.floor(r.length/s),1),l=[];p<s;)l.push(r[p]),p+=c;return p!==r.length-1&&l.push(r[r.length-1]),l}return r},t.getTrackLineMarkerGraphic=function(t,e,i){var n=t.options.markerUrl,o=t.options.markerHeight||48,r=t.options.markerWidth||48,a=new esri.symbol.PictureMarkerSymbol(n,o,r);return new esri.Graphic(e.geometry,a,{type:"marker",line:t.name})},t.getStandardStops=function(t,e,i){null==i&&(i=(new esri.symbol.SimpleMarkerSymbol).setStyle(esri.symbol.SimpleMarkerSymbol.STYLE_CROSS).setSize(15).outline.setWidth(3));for(var n=[],o=0;o<e.length;o++)e[o]instanceof Array?n.push(new esri.Graphic(new esri.geometry.Point(e[o][0],e[o][1]),i,{type:"stop",line:t})):(e[o].declaredClass||"").indexOf("Point")>0?n.push(new esri.Graphic(e[o],i,{type:"stop",line:t})):n.push(new esri.Graphic(e[o].geometry,i,{type:"stop",model:e[o].attributes,line:t}));return n},t}(),l.EsriRouteService=h,function(t){t.deviceLayerOptions={onLayerClick:function(t){console.log("onLayerClick")},onMapLoad:function(){console.log("onMapLoad")},onEvent:function(t,e){console.log("onEvent")},onCheck:function(t){console.log("onCheck")},onEditInfo:function(t,e){console.log("onEditInfo")},enableEdit:!0,enableSelectMode:!1,selectMode:1,showTooltipOnHover:!0,showInfoWindow:!0};var e=function(e){function i(i,n,o){var r=e.call(this,i.mapService,n,o.title||"\u8bbe\u5907\u56fe\u5c42")||this;if(r.flagwindMap=i,r.id=n,r.options=o,o=C({},t.deviceLayerOptions,o),r.flagwindMap=i,r.options=o,r.onInit(),r.onAddLayerBefor(),r.flagwindMap.addDeviceLayer(r),r.onAddLayerAfter(),r.flagwindMap.innerMap.loaded)r.onLoad();else{var a=r;r.flagwindMap.innerMap.on("load",function(){a.onLoad()})}return r}return A(i,e),Object.defineProperty(i.prototype,"map",{get:function(){return this.flagwindMap.map},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"spatial",{get:function(){return this.flagwindMap.spatial},enumerable:!0,configurable:!0}),i.prototype.gotoCenterById=function(t){var e=this.getGraphicById(t),i=this.getPoint(e.attributes);this.map.centerAt(i).then(function(){console.log(i)})},i.prototype.saveGraphicList=function(t){for(var e=0;e<t.length;e++)this.saveGraphicByDevice(t[e])},i.prototype.updateGraphicList=function(t){for(var e=0;e<t.length;e++)this.updateGraphicByDevice(t[e])},i.prototype.setSelectStatusByDevices=function(t){this.clearSelectStatus();for(var e=0;e<t.length;e++){var i=this.changeStandardModel(t[e]),n=this.getGraphicById(i.id);n&&this.setSelectStatus(n,!0)}},i.prototype.saveGraphicByDevice=function(t){var e=this.getGraphicById(t.id);return e?this.updateGraphicByDevice(t,e):this.addGraphicByDevice(t)},i.prototype.addGraphicByDevice=function(t){var e=this.creatGraphicByDevice(t);this.layer.add(e)},i.prototype.creatGraphicByDevice=function(t){return t=this.changeStandardModel(t),this.validDevice(t)?(t.select=!1,this.onCreatGraphicByDevice(t)):null},i.prototype.updateGraphicByDevice=function(t,e){if(void 0===e&&(e=null),t=this.changeStandardModel(t),this.validDevice(t)&&(e||(e=this.getGraphicById(t.id)),null!=e)){var i=this.getPoint(t);return this.onUpdateGraphicByDevice(t),i}},i.prototype.clearSelectStatus=function(){for(var t=this.layer.graphics,e=0;e<t.length;e++)t[e].attributes.selected&&this.setSelectStatus(t[e],!1)},i.prototype.getSelectedGraphics=function(){return this.layer.graphics.filter(function(t){return t.attributes&&t.attributes.selected})},i.prototype.getPoint=function(t){return this.flagwindMap.getPoint(t)},i.prototype.formPoint=function(t){return this.flagwindMap.formPoint(t)},i.prototype.onAddLayerBefor=function(){console.log("onAddLayerBefor")},i.prototype.onAddLayerAfter=function(){console.log("onAddLayerAfter")},i.prototype.onInit=function(){console.log("onInit")},i.prototype.onLoad=function(){this.layer._map||(this.layer._map=this.flagwindMap.innerMap),this.registerEvent(),this.onMapLoad()},i.prototype.onMapLoad=function(){this.options.onMapLoad()},i.prototype.registerEvent=function(){var t=this;this.addEventListener(this.layer,"onClick",function(e){t.onLayerClick(t,e)}),this.options.showTooltipOnHover&&(this.addEventListener(this.layer,"onMouseOver",function(e){t.flagwindMap.showTitle(e.graphic)}),this.addEventListener(this.layer,"onMouseOut",function(e){t.flagwindMap.hideTitle()}))},i.prototype.onLayerClick=function(t,e){if(t.options.onLayerClick&&t.options.onLayerClick(e),t.options.showInfoWindow&&(e.graphic.attributes.eventName="",t.showInfoWindow(e)),t.options.enableSelectMode){if(1===t.options.selectMode){var i=e.graphic.attributes;e.graphic.attributes.selected?t.setSelectStatus(i,!1):t.setSelectStatus(i,!0)}else{t.clearSelectStatus();i=e.graphic.attributes;t.setSelectStatus(i,!0)}console.log("check-------"+e.graphic.attributes),t.options.onCheck({target:[e.graphic.attributes],check:e.graphic.attributes.selected,selectGraphics:t.getSelectedGraphics()})}},i.prototype.fireEvent=function(t,e){this.options.onEvent(t,e)},i.prototype.validDevice=function(t){return t.longitude&&t.latitude},i.prototype.changeStandardModel=function(t){return t.tollLongitude&&t.tollLatitude&&(t.id=t.tollCode,t.name=t.tollName,t.longitude=t.tollLongitude,t.latitude=t.tollLatitude),t},i.prototype.setSelectStatus=function(t,e){t.selected=e,this.onUpdateGraphicByDevice(t)},i}(t.FlagwindFeatureLayer);t.DeviceLayer=e}(E||(E={})),(E||(E={})).editLayerOptions={onEditInfo:function(t,e,i,n){console.log("onEditInfo")}},function(t){t.flagwindMapOptions={onMapLoad:function(){console.log("onMapLoad")},onMapZoomEnd:function(t){console.log("onMapZoomEnd")},onMapClick:function(t){console.log("onMapClick")}};var e=function(){function e(e,i,n,o){this.mapService=e,this.mapSetting=i,this.baseLayers=[],this.featureLayers=[],this.mapEl=n,this.options=C({},t.flagwindMapOptions,o),this.createMap(),this.createBaseLayer();var r=this;e.addEventListener(r.innerMap,"onLoad",function(){try{r.goToCenter(),r.onMapLoad()}catch(t){console.error(t)}}),e.addEventListener(r.innerMap,"zoom-end",function(t){r.onMapZoomEnd(t)})}return e.prototype.goToCenter=function(){if(this.mapSetting.center&&2===this.mapSetting.center.length){var t=this.getPoint({x:this.mapSetting.center[0],y:this.mapSetting.center[1]});this.mapService.centerAt(t,this.innerMap)}},e.prototype.getBaseLayerById=function(t){var e=this.baseLayers.filter(function(e){return e.id===t});return e&&e.length>0?e[0]:null},e.prototype.formPoint=function(t){var e={lat:t.y,lon:t.x};return t.latitude&&t.longitude&&(e.lon=t.longitude,e.lat=t.latitude),this.mapService.formPoint(e,this)},e.prototype.centerAt=function(t,e){var i=this.mapService.createPoint({x:t,y:e,spatial:this.spatial});this.mapService.centerAt(i,this.innerMap)},e.prototype.createContextMenu=function(t){this.mapService.createContextMenu(t,this)},e.prototype.getPoint=function(e){var i={lat:e.latitude||e.lat,lon:e.longitude||e.lon};return t.MapUtils.validDevice(e)||(i.lon=e.x,i.lat=e.y),this.mapService.toPoint(i,this)},e.prototype.createBaseLayer=function(){var t=this;this.mapService.createBaseLayer(this).forEach(function(e){e.appendTo(t.innerMap)})},e.prototype.addDeviceLayer=function(t){if(this.getFeatureLayerById(t.id))throw Error("\u56fe\u5c42"+t.id+"\u5df2\u5b58\u5728");this.featureLayers.push(t),t.appendTo(this.innerMap)},e.prototype.showTitle=function(t){this.mapService.showTitle(t,this)},e.prototype.hideTitle=function(){this.mapService.hideTitle(this)},e.prototype.onMapLoad=function(){this.options.onMapLoad&&this.options.onMapLoad();var t=this;this.mapService.addEventListener(this.innerMap,"click",function(e){t.options.onMapClick(e)})},e.prototype.showBaseLayer=function(t){var e=this.getBaseLayerById(t);return!!e&&(e.show(),!0)},e.prototype.getFeatureLayerById=function(t){var e=this.featureLayers.filter(function(e){return e.id===t});return null!=e&&e.length>0?e[0]:null},e.prototype.addFeatureLayer=function(e,i){if(this.getFeatureLayerById(e))throw Error("\u56fe\u5c42"+e+"\u5df2\u5b58\u5728");var n=new t.FlagwindFeatureLayer(this.mapService,e,i);this.featureLayers.push(n),n.appendTo(this.innerMap)},e.prototype.showFeatureLayer=function(t){var e=this.getFeatureLayerById(t);return!!e&&(e.show(),!0)},e.prototype.removeFeatureLayer=function(t){var e=this.getFeatureLayerById(t);if(e){e.removeLayer(this.innerMap);var i=this.featureLayers.indexOf(e);return this.featureLayers.splice(i,1),!0}return!1},Object.defineProperty(e.prototype,"map",{get:function(){return this.innerMap},enumerable:!0,configurable:!0}),e.prototype.onMapZoomEnd=function(t){this.options.onMapZoomEnd(t.level)},e.prototype.createMap=function(){this.spatial=this.mapService.createSpatial(this.mapSetting.wkid);var t=this.mapService.createMap(this.mapSetting,this);this.innerMap=t},e}();t.FlagwindMap=e}(E||(E={})),function(t){var e=function(){function t(t,e,i){void 0===e&&(e=100),void 0===i&&(i=!1),this.numsOfKilometer=t,this.speed=e,this.autoShowLine=i}return t.prototype.onShowSegmentLineEvent=function(t){console.log("onShowSegmentLineEvent")},t.prototype.onMoveStartEvent=function(t,e,i){console.log("onMoveStartEvent")},t.prototype.onMoveEndEvent=function(t,e,i){console.log("onMoveEndEvent")},t.prototype.onMoveEvent=function(t,e,i){console.log("onMoveEvent")},t}();t.TrackSegmentOptions=e;var i=function(){function e(t,e,i,n,o,r){this.flagwindRouteLayer=t,this.index=e,this.name=i,this.startGraphic=n,this.endGraphic=o,this.options=r,this.position=-1,this.isCompleted=!1,this.isRunning=!1,this.time=200,this.waypoints=[],this.options=r,this.mapService=t.mapService}return e.prototype.setPolyLine=function(t,e){this.mapService.setSegmentByPolyLine(this.flagwindRouteLayer,{polyline:t,length:e},this),this.speed||this.changeSpeed(),this.options.onShowSegmentLineEvent(this)},e.prototype.setLine=function(t){this.mapService.setSegmentByLine(this.flagwindRouteLayer,{points:t,spatial:this.flagwindRouteLayer.flagwindMap.spatial},this),this.speed||this.changeSpeed(),console.debug("\u8def\u6bb5"+this.index+"\u957f\u5ea6\uff1a"+this.length+"km"),console.debug("\u8def\u6bb5"+this.index+"\u53d6\u70b9\uff1a"+this.line.length+"\u4e2a"),console.debug("\u8def\u6bb5"+this.index+"\u901f\u5ea6\uff1a"+this.speed+"km/h"),console.debug("\u8def\u6bb5"+this.index+"\u5b9a\u65f6\uff1a"+this.time+"ms"),this.options.onShowSegmentLineEvent(this)},e.prototype.changeSpeed=function(t){void 0===t&&(t=null),0===this.options.numsOfKilometer?(this.speed=1e7,this.time=1):(this.speed=t||this.options.speed,this.time=3600*(this.length||0)/(15*(this.speed||100)*this.line.length)),this.timer&&(this.pause(),this.start())},e.prototype.move=function(e){e.position=e.position+1;var i=0;if(0===e.position)return e.line.length>1&&(i=t.MapUtils.getAngle(e.startGraphic.geometry,{x:e.line[0][0],y:e.line[0][1]})||0),e.options.onMoveStartEvent(e,e.startGraphic,i),void e.options.onMoveEvent(e,[e.startGraphic.geometry.x,e.startGraphic.geometry.y],i);if(e.position>=e.line.length)return this.line.length>1&&(i=t.MapUtils.getAngle({x:this.line[e.line.length-1][0],y:this.line[e.line.length-1][1]},this.endGraphic.geometry)||0),e.isCompleted=!0,e.stop(),e.options.onMoveEvent(e,[e.endGraphic.geometry.x,e.endGraphic.geometry.y],i),void e.options.onMoveEndEvent(e,e.endGraphic,i);i=t.MapUtils.getAngle({x:this.line[this.position-1][0],y:this.line[this.position-1][1]},{x:this.line[this.position][0],y:this.line[this.position][1]});var n=parseFloat(e.line[this.position-1][0]).toFixed(5),o=parseFloat(e.line[this.position-1][1]).toFixed(5);e.options.onMoveEvent(e,[n,o],i)},e.prototype.start=function(){this.isRunning=!0;var t=this;return t.timer=window.setInterval(function(){t.line?t.move(t):console.log("\u7ebf\u8def"+t.name+"\u7684\u7b2c"+(t.index+1)+"\u8def\u6bb5\u7b49\u5f85\u8bbe\u7f6e")},t.time),!0},Object.defineProperty(e.prototype,"isPaused",{get:function(){return!this.timer&&this.isRunning},enumerable:!0,configurable:!0}),e.prototype.pause=function(){window.clearInterval(this.timer),this.timer=null},e.prototype.stop=function(){this.timer&&window.clearInterval(this.timer),this.timer=null,this.isRunning=!1,this.position=-1},e.prototype.reset=function(){this.timer=null,this.isRunning=!1,this.position=-1,this.isCompleted=!1},e}();t.TrackSegment=i;var n=function(){function t(t,e,i){this.flagwindMap=t,this.name=e,this.options=i,this.segments=[],this.isMovingGraphicHide=!1,this.mapService=t.mapService}return t.prototype.hideMovingGraphic=function(){this.isMovingGraphicHide=!0,this.mapService.hideGraphic(this.markerGraphic)},t.prototype.showMovingGraphic=function(){this.isMovingGraphicHide&&(this.isMovingGraphicHide=!1,this.mapService.showGraphic(this.markerGraphic))},Object.defineProperty(t.prototype,"isRunning",{get:function(){if(0===this.segments.length)return!1;for(var t=0;t<this.segments.length;t++){if(!0===this.segments[t].isRunning)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCompleted",{get:function(){if(0===this.segments.length)return!1;for(var t=0;t<this.segments.length;t++){if(!1===this.segments[t].isCompleted)return!1}return!0},enumerable:!0,configurable:!0}),t.prototype.changeSpeed=function(t){if(0!==this.segments.length)for(var e=0;e<this.segments.length;e++){this.segments[e].changeSpeed(t)}},t.prototype.start=function(){if(!this.isRunning){for(var t=this.segments[0],e=0;e<this.segments.length;e++){var i=this.segments[e];t.index>i.index&&(t=i)}t.start()}},t.prototype.stop=function(){for(var t=0;t<this.segments.length;t++){this.segments[t].stop()}},t.prototype.reset=function(){for(var t=0;t<this.segments.length;t++){this.segments[t].reset()}},t.prototype.pause=function(){for(var t=0;t<this.segments.length;t++){var e=this.segments[t];if(e.isRunning)return void e.pause()}},t.prototype.continue=function(){this.isRunning||this.start();for(var t=0;t<this.segments.length;t++){var e=this.segments[t];if(e.isRunning&&!e.timer)return void e.start()}},t.prototype.move=function(){if(!this.isRunning){var t=this.activeCompletedSegment,e=null;(e=t?this.getSegment(t.index+1):this.getSegment(0))&&e.start()}},t.prototype.add=function(t){this.segments.push(t)},Object.defineProperty(t.prototype,"nextSegmentIndex",{get:function(){if(0===this.segments.length)return 0;for(var t=0,e=0;e<this.segments.length;e++){var i=this.segments[e];i.index>t&&(t=i.index)}return t>0&&(t+=1),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastSegment",{get:function(){if(0===this.segments.length)return null;for(var t=null,e=0;e<this.segments.length;e++){var i=this.segments[e];(!t||i.index>t.index)&&(t=i)}return t},enumerable:!0,configurable:!0}),t.prototype.getNextSegment=function(t){return 0===this.segments.length?null:this.getSegment(t+1)},t.prototype.getSegment=function(t){var e=null;if(0===this.segments.length)return null;for(var i=0;i<this.segments.length;i++){var n=this.segments[i];n.name===name&&n.index===t&&(e=n)}return e},Object.defineProperty(t.prototype,"activeCompletedSegment",{get:function(){var t=null;if(0!==this.segments.length){for(var e=0;e<this.segments.length;e++){var i=this.segments[e];i.isCompleted&&(null==t||i.index>t.index)&&(t=i)}return t}},enumerable:!0,configurable:!0}),t}();t.TrackLine=n}(E||(E={})),(E||(E={})).locationLayerOptions={onMapClick:function(t){console.log("onMapClick")}},u=E||(E={}),d=function(){function t(){}return t.isEqualPoint=function(t,e){return null==t&&null==e&&(t.x===e.x&&t.y===e.y)},t.getAngle=function(t,e){var i=t.x,n=t.y,o=e.x-i,r=e.y-n;return o>0&&r>=0?Math.round(Math.atan(r/o)/Math.PI*180):o>0&&r<0?360+Math.round(Math.atan(r/o)/Math.PI*180):o<0&&r>=0?180+Math.round(Math.atan(r/o)/Math.PI*180):o<0&&r<0?180+Math.round(Math.atan(r/o)/Math.PI*180):0===o?90:0},t.validDevice=function(t){return t.longitude&&t.latitude},t.delta=function(e,i){var n=.006693421622965943,o=t.transformLat(i-105,e-35),r=t.transformLon(i-105,e-35),a=e/180*t.PI,s=Math.sin(a);s=1-n*s*s;var p=Math.sqrt(s);return{lat:o=180*o/(6335552.717000426/(s*p)*t.PI),lon:r=180*r/(6378245/p*Math.cos(a)*t.PI)}},t.point25To2=function(t,e){return{lat:(0-321586.1*t-629486.1*e+0xdb613eebb21-34214413461469.996)/-512844508966.97,lon:(380061.7*t-850786*e+20375618547620+40435790429590)/512844508966.97}},t.point2To25=function(t,e){return{lat:380061.7*e-321586.1*t+23949170,lon:629486.1*t+850786*e-106392700}},t.mercatorUnproject=function(t,e){for(var i=180/Math.PI,n=Math.sqrt(.00669437999014133),o=Math.exp(-e/6378137),r=Math.PI/2-2*Math.atan(o),a=.1,s=0,p=0;p<15&&Math.abs(a)>1e-7;p++)s=n*Math.sin(r),s=Math.pow((1-s)/(1+s),n/2),r+=a=Math.PI/2-2*Math.atan(o*s)-r;return{lat:r*i,lon:t*i/6378137}},t.gcj_encrypt=function(e,i){if(t.outOfChina(e,i))return{lat:e,lon:i};var n=t.delta(e,i);return{lat:e+n.lat,lon:i+n.lon}},t.gcj_decrypt=function(e,i){if(t.outOfChina(e,i))return{lat:e,lon:i};var n=t.delta(e,i);return{lat:e-n.lat,lon:i-n.lon}},t.gcj_decrypt_exact=function(e,i){for(var n,o,r=.01,a=.01,s=e-r,p=i-a,c=e+r,l=i+a,h=0;;){n=(s+c)/2,o=(p+l)/2;var u=t.gcj_encrypt(n,o);if(r=u.lat-e,a=u.lon-i,Math.abs(r)<1e-9&&Math.abs(a)<1e-9)break;if(r>0?c=n:s=n,a>0?l=o:p=o,++h>1e4)break}return{lat:n,lon:o}},t.bd_encrypt=function(e,i){var n=i,o=e,r=Math.sqrt(n*n+o*o)+2e-5*Math.sin(o*t.X_PI),a=Math.atan2(o,n)+3e-6*Math.cos(n*t.X_PI),s=r*Math.cos(a)+.0065;return{lat:r*Math.sin(a)+.006,lon:s}},t.bd_decrypt=function(e,i){var n=i-.0065,o=e-.006,r=Math.sqrt(n*n+o*o)-2e-5*Math.sin(o*t.X_PI),a=Math.atan2(o,n)-3e-6*Math.cos(n*t.X_PI),s=r*Math.cos(a);return{lat:r*Math.sin(a),lon:s}},t.mercator_encrypt=function(e,i){var n=20037508.34*i/180,o=Math.log(Math.tan((90+e)*t.PI/360))/(t.PI/180);return{lat:o=20037508.34*o/180,lon:n}},t.lonlat2mercator=function(t,e){var i={lon:0,lat:0},n=20037508.34*e/180,o=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return o=20037508.34*o/180,i.lon=n,i.lat=o,i},t.mercator2lonlat=function(t,e){var i={lon:0,lat:0},n=e/20037508.34*180,o=t/20037508.34*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),i.lon=n,i.lat=o,i},t.mercator_decrypt=function(e,i){var n=i/20037508.34*180,o=e/20037508.34*180;return{lat:o=180/t.PI*(2*Math.atan(Math.exp(o*t.PI/180))-t.PI/2),lon:n}},t.distance=function(e,i,n,o){var r=Math.cos(e*t.PI/180)*Math.cos(n*t.PI/180)*Math.cos((i-o)*t.PI/180)+Math.sin(e*t.PI/180)*Math.sin(n*t.PI/180);return r>1&&(r=1),r<-1&&(r=-1),6371e3*Math.acos(r)},t.outOfChina=function(t,e){return e<72.004||e>137.8347||(t<.8293||t>55.8271)},t.transformLat=function(e,i){var n=2*e-100+3*i+.2*i*i+.1*e*i+.2*Math.sqrt(Math.abs(e));return n+=2*(20*Math.sin(6*e*t.PI)+20*Math.sin(2*e*t.PI))/3,n+=2*(20*Math.sin(i*t.PI)+40*Math.sin(i/3*t.PI))/3,n+=2*(160*Math.sin(i/12*t.PI)+320*Math.sin(i*t.PI/30))/3},t.transformLon=function(e,i){var n=300+e+2*i+.1*e*e+.1*e*i+.1*Math.sqrt(Math.abs(e));return n+=2*(20*Math.sin(6*e*t.PI)+20*Math.sin(2*e*t.PI))/3,n+=2*(20*Math.sin(e*t.PI)+40*Math.sin(e/3*t.PI))/3,n+=2*(150*Math.sin(e/12*t.PI)+300*Math.sin(e/30*t.PI))/3},t.PI=3.141592653589793,t.X_PI=52.35987755982988,t}(),u.MapUtils=d,y=E||(E={}),f=function(){function t(t){if(!t)throw new y.ArgumentException("items");this._index=0,this._current=void 0,this._items=t}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),t.prototype.next=function(){var t=this._items;return this._index<t.length&&(this._current=t[this._index++],!0)},t}(),y.Enumerator=f,m=E||(E={}),g=function(){function t(t,e){this._key=t,this._value=e}return Object.defineProperty(t.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return"["+(this._key||"")+", "+(this._value||"")+"]"},t}(),m.KeyValuePair=g,v=E||(E={}),M=function(){function t(){this._keys=[],this._values=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){var i=this._keys,n=i.indexOf(t);return-1===n&&(i[n=i.length]=t),this._values[n]=e,this},t.prototype.get=function(t){var e=this._keys.indexOf(t);return-1!==e?this._values[e]:void 0},t.prototype.has=function(t){return-1!==this._keys.indexOf(t)},t.prototype.delete=function(t){var e=this._keys.indexOf(t);return-1!==e&&(this._keys.splice(e,1),this._values.splice(e,1),!0)},t.prototype.clear=function(){this._keys.length=0,this._values.length=0},t.prototype.getEnumerator=function(){var t=this.entries();return new v.Enumerator(t)},t.prototype.forEach=function(t,e){for(var i=this._keys,n=this._values,o=0,r=i.length;o<r;o++)t.call(e,new v.KeyValuePair(i[o],n[o]),this)},t.prototype.keys=function(){return this._keys.concat()},t.prototype.values=function(){return this._values.concat()},t.prototype.entries=function(){var t=new Array;return this.forEach(function(e,i){t.push(new v.KeyValuePair(e.key,e.value))}),t},t.prototype.toString=function(){var t=Object.create(null);return this.forEach(function(e,i){t[e.key]=e.value}),JSON.stringify(t)},t}(),v.Map=M,S=E||(E={}),w=function(){function t(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._values=[],(t=this._values).push.apply(t,e)}return Object.defineProperty(t.prototype,"size",{get:function(){return this._values.length},enumerable:!0,configurable:!0}),t.prototype.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0,n=t;i<n.length;i++){var o=n[i];this.has(o)||this._values.push(o)}return this},t.prototype.get=function(t){return this._values[t]},t.prototype.set=function(t,e){var i=this._values;t>=0&&t<i.length&&(this.has(e)||(i[t]=e))},t.prototype.delete=function(t){var e=this._values,i=e.indexOf(t);return-1!==i&&(e.splice(i,1),!0)},t.prototype.deleteAt=function(t){var e=this._values;t>=0&&t<e.length&&e.splice(t,1)},t.prototype.clear=function(){this._values.length=0},t.prototype.indexOf=function(t,e){return this._values.indexOf(t,e)},t.prototype.has=function(t){return-1!==this._values.indexOf(t)},t.prototype.getEnumerator=function(){return new S.Enumerator(this._values)},t.prototype.forEach=function(){for(var t=this._values,e=arguments[0],i=arguments[1],n=2===e.length,o=0,r=t.length;o<r;o++)n?e.call(i,t[o],this):e.call(i,t[o],o,this)},t.prototype.find=function(t,e){for(var i=this._values,n=0,o=i.length;n<o;n++)if(t.call(e,i[n],n,this))return i[n]},t.prototype.sort=function(t){var e=this._values;this._values=e.sort(t)},t.prototype.union=function(t){var e=t.values();return e.length>0&&this.add.apply(this,e),this},t.prototype.values=function(){return this._values.concat()},t.prototype.toString=function(){return Array.prototype.toString.call(this._values)},t}(),S.Set=w,L=E||(E={}),b=function(t){function e(e){return t.call(this,e)||this}return A(e,t),e}(Error),L.Exception=b,k=E||(E={}),P=function(t){function e(e){return t.call(this,e)||this}return A(e,t),e}(k.Exception),k.ArgumentException=P,_=E||(E={}),G=function(t){function e(e){return t.call(this,e)||this}return A(e,t),e}(_.Exception),_.InvalidOperationException=G,function(t){var e=function(){function t(t,e,i){this.x=t,this.y=e,this.spatial=i}return Object.defineProperty(t.prototype,"geometry",{get:function(){return new i("Point",[this.x,this.y])},set:function(t){this.x=t.coordinates[0],this.y=t.coordinates[1]},enumerable:!0,configurable:!0}),t}();t.MinemapPoint=e;var i=function(){return function(t,e){this.type=t,this.coordinates=e}}();t.MinemapGeometry=i;var n=function(){return function(t){this.wkid=t}}();t.MinemapSpatial=n;var o=function(){function t(t){this._kind="marker",this._isInsided=!1,this.isShow=!0,this.id=t.id,this.element=document.createElement("div"),this.element.id=this.id,t.symbol&&t.symbol.className&&(this.element.classList=[t.symbol.className]),this.marker=new minemap.Marker(this.element,{offset:[-25,-25]}),t.point&&(this._geometry=new i("Point",[t.point.x,t.point.y]),this.marker.setLngLat([t.point.x,t.point.y]))}return Object.defineProperty(t.prototype,"kind",{get:function(){return this._kind},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isInsided",{get:function(){return this._isInsided},enumerable:!0,configurable:!0}),t.prototype.show=function(){this.marker.addTo(this.layer.map),this.isShow=!1},t.prototype.hide=function(){this.marker.remove(),this.isShow=!1},t.prototype.remove=function(){this._isInsided&&(this.marker.remove(),this._isInsided=!1)},t.prototype.delete=function(){this._isInsided&&(this.marker.remove(),this._isInsided=!1),this.layer.remove(this)},t.prototype.setSymbol=function(t){t.className&&this.element.classList.add(t.className)},Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},set:function(t){this._geometry=t,this.marker.setLngLat(t.coordinates)},enumerable:!0,configurable:!0}),t.prototype.setGeometry=function(t){this._geometry=t,this.marker.setLngLat(t.coordinates)},t.prototype.addTo=function(t){this._isInsided=!0,this.marker.addTo(t)},t}();t.MinemapMarker=o;var r=function(){function e(){this._kind="geojson",this._isInsided=!1,this.isShow=!0}return Object.defineProperty(e.prototype,"kind",{get:function(){return this._kind},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInsided",{get:function(){return this._isInsided},enumerable:!0,configurable:!0}),e.prototype.show=function(){this.isShow||(this.addLayer(this.layer.map),this.isShow=!0)},e.prototype.hide=function(){this.layer.map.removeLayer(this.id),this.isShow=!1},e.prototype.remove=function(){this.layer.map.removeLayer(this.id)},e.prototype.delete=function(){this.isInsided&&(this.layer.map.removeLayer(this.id),this._isInsided=!1,this.layer.remove(this))},e.prototype.setSymbol=function(e){throw new t.Exception("\u5c1a\u672a\u5b9e\u73b0")},e.prototype.setGeometry=function(t){this.data&&this.data.geometry&&(this.data.geometry=t)},e.prototype.addTo=function(t){t&&t.addSource(this.id+"_source",{type:this.kind,data:this.data})},e.prototype.addLayer=function(t){t.addLayer({id:this.id,source:this.id+"_source",type:this.type,paint:this.paint,layout:this.layout})},e}();t.MinemapGeoJson=r;var a=function(){function e(e){this.options=e,this.GRAPHICS_MAP=new t.Map,this._isInsided=!1,this.id=e.id}return Object.defineProperty(e.prototype,"isInsided",{get:function(){return this._isInsided},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graphics",{get:function(){return new Array(this.GRAPHICS_MAP.values)},enumerable:!0,configurable:!0}),e.prototype.show=function(){this.GRAPHICS_MAP.forEach(function(t){t.value.isShow||t.value.show()})},e.prototype.hide=function(){this.GRAPHICS_MAP.forEach(function(t){t.value.isShow&&t.value.hide()})},e.prototype.remove=function(t){this.GRAPHICS_MAP.delete(t.id),t.isInsided&&t.delete()},e.prototype.clear=function(){this.GRAPHICS_MAP.forEach(function(t){return t.value.remove()}),this.GRAPHICS_MAP.clear()},e.prototype.add=function(t){this.GRAPHICS_MAP.set(t.id,t),t.layer=this,this.map&&t.addTo(this.map)},e.prototype.addToMap=function(t){this.map||this.GRAPHICS_MAP.forEach(function(e){e.value.addTo(t)}),this.map=t,this._isInsided=!0},e.prototype.removeFromMap=function(t){this.GRAPHICS_MAP.forEach(function(t){t.value.remove()}),this._isInsided=!1},e}();t.MinemapMarkerLayer=a;var s=function(){function e(e){this.GRAPHICS_MAP=new t.Map,this._isInsided=!1,this.id=e.id}return Object.defineProperty(e.prototype,"isInsided",{get:function(){return this._isInsided},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graphics",{get:function(){return new Array(this.GRAPHICS_MAP.values)},enumerable:!0,configurable:!0}),e.prototype.show=function(){this.GRAPHICS_MAP.forEach(function(t){t.value.isShow||t.value.show()})},e.prototype.hide=function(){this.GRAPHICS_MAP.forEach(function(t){t.value.isShow&&t.value.hide()})},e.prototype.remove=function(t){this.GRAPHICS_MAP.delete(t.id),t.isInsided&&t.delete()},e.prototype.clear=function(){this.GRAPHICS_MAP.forEach(function(t){return t.value.remove()}),this.GRAPHICS_MAP.clear()},e.prototype.add=function(t){this.GRAPHICS_MAP.set(t.id,t),this.map&&(t.addTo(this.map),t.addLayer(this.map))},e.prototype.addToMap=function(t){this.map||this.GRAPHICS_MAP.forEach(function(e){return e.value.addLayer(t)}),this.map=t,this._isInsided=!0},e.prototype.removeFromMap=function(t){this.GRAPHICS_MAP.forEach(function(t){return t.value.delete()}),this._isInsided=!1},e}();t.MinemapGeoJsonLayer=s}(E||(E={})),function(t){var e=new t.Map;e.set("onLoad","load");var i=function(){function i(){}return i.prototype.createTiledLayer=function(t){throw new Error("Method not implemented.")},i.prototype.createBaseLayer=function(t){return new Array},i.prototype.createGraphicsLayer=function(e){if("marker"===e.kind)return new t.MinemapMarkerLayer(e);if("geojson"===e.kind)return new t.MinemapGeoJsonLayer(e);throw new Error("\u4e0d\u652f\u6301\u7684\u56fe\u5c42\u7c7b\u578b")},i.prototype.clearLayer=function(t){t.clear&&t.clear()},i.prototype.removeLayer=function(t,e){t.removeFromMap(e)},i.prototype.addLayer=function(t,e){t.addToMap(e)},i.prototype.showLayer=function(t){t.show()},i.prototype.hideLayer=function(t){t.hide()},i.prototype.getGraphicListByLayer=function(t){var e=t.graphics,i=new Array;return i.push(e),i},i.prototype.removeGraphic=function(t,e){e.remove(t)},i.prototype.addGraphic=function(t,e){e.add(t)},i.prototype.showGraphic=function(t){t.show()},i.prototype.hideGraphic=function(t){t.hide()},i.prototype.setGeometryByGraphic=function(t,e){t.setGeometry(e)},i.prototype.setSymbolByGraphic=function(t,e){t.setSymbol(e)},i.prototype.createMarkerSymbol=function(t){throw new Error("Method not implemented.")},i.prototype.getGraphicAttributes=function(t){return t.attributers},i.prototype.addEventListener=function(t,i,n){var o=e.get(i)||i;t.on(o,n)},i.prototype.centerAt=function(t,e){e.flyTo({center:[t.x,t.y]})},i.prototype.createPoint=function(e){return new t.MinemapPoint(e.x,e.y,e.spatial)},i.prototype.createSpatial=function(e){return new t.MinemapSpatial(e)},i.prototype.getInfoWindow=function(t){throw new Error("Method not implemented.")},i.prototype.showInfoWindow=function(t){throw new Error("Method not implemented.")},i.prototype.formPoint=function(e,i){var n={lat:e.y,lon:e.x};return e.latitude&&e.longitude&&(n.lon=e.longitude,n.lat=e.latitude),i.spatial.wkid!==i.mapSetting.wkidFromApp&&(3857===i.spatial.wkid&&4326===i.mapSetting.wkidFromApp?i.mapSetting.is25D?(console.log("2.5D\u5750\u6807\uff1a"+n.lon+","+n.lat),n=t.MapUtils.point25To2(n.lon,n.lat),console.log("\u9ad8\u5fb7\u5750\u6807\uff1a"+n.lon+","+n.lat),n=t.MapUtils.gcj_decrypt(n.lat,n.lon),console.log("\u539f\u59cb\u5750\u6807\uff1a"+n.lon+","+n.lat)):n=t.MapUtils.mercator2lonlat(n.lat,n.lon):102100===i.spatial.wkid&&4326===i.mapSetting.wkidFromApp?n=t.MapUtils.mercator_decrypt(n.lat,n.lon):4326===i.spatial.wkid&&3857===i.mapSetting.wkidFromApp&&(n=t.MapUtils.mercator_decrypt(n.lat,n.lon))),{longitude:parseFloat(n.lon.toFixed(8)),latitude:parseFloat(n.lat.toFixed(8))}},i.prototype.toPoint=function(e,i){var n={latitude:e.latitude||e.lat,longitude:e.longitude||e.lon};return t.MapUtils.validDevice(n)||(n.longitude=e.x,n.latitude=e.y),i.spatial.wkid!==i.mapSetting.wkidFromApp&&(3857===i.spatial.wkid&&4326===i.mapSetting.wkidFromApp?i.mapSetting.is25D?(console.log("\u539f\u59cb\u5750\u6807\uff1a"+n.longitude+","+n.latitude),n=t.MapUtils.gcj_encrypt(n.latitude,n.longitude),console.log("\u9ad8\u5fb7\u5750\u6807\uff1a"+n.longitude+","+n.latitude),n=t.MapUtils.point2To25(n.longitude,n.latitude),console.log("2.5D\u5750\u6807\uff1a"+n.longitude+","+n.latitude)):n=t.MapUtils.lonlat2mercator(n.latitude,n.longitude):102100===i.spatial.wkid&&4326===i.mapSetting.wkidFromApp?n=t.MapUtils.mercator_encrypt(n.latitude,n.longitude):4326===i.spatial.wkid&&3857===i.mapSetting.wkidFromApp&&(n=t.MapUtils.mercator_encrypt(n.latitude,n.longitude))),new t.MinemapPoint(n.longitude,n.latitude,i.spatial)},i.prototype.createMap=function(t,e){minemap.domainUrl="http://"+t.mapDomain,minemap.spriteUrl="http://"+t.mapDomain+"/minemapapi/"+t.mapVersion+"/sprite/sprite",minemap.serviceUrl="http://"+t.mapDomain+"/service",minemap.accessToken=t.accessToken||"25cc55a69ea7422182d00d6b7c0ffa93",minemap.solution=2365;var i=new minemap.Map({container:e.mapEl,style:"http://"+t.mapDomain+"/service/solu/style/id/2365",center:t.center||[116.46,39.92],zoom:t.zoom,pitch:60,maxZoom:t.maxZoom||17,minZoom:t.minZoom||9}),n=new minemap.Popup({closeOnClick:!1}).addTo(i);return i.infoWindow=n,i},i.prototype.createContextMenu=function(t,e){throw new Error("Method not implemented.")},i.prototype.showTitle=function(t,e){throw new Error("Method not implemented.")},i.prototype.hideTitle=function(t){throw new Error("Method not implemented.")},i.prototype.setSegmentByLine=function(t,e,i){throw new Error("Method not implemented.")},i.prototype.setSegmentByPolyLine=function(t,e,i){throw new Error("Method not implemented.")},i.prototype.solveByService=function(t,e,i,n,o){throw new Error("Method not implemented.")},i.prototype.solveByJoinPoint=function(t,e){throw new Error("Method not implemented.")},i.prototype.getTrackLineMarkerGraphic=function(t,e,i){throw new Error("Method not implemented.")},i.prototype.getStandardStops=function(t,e){throw new Error("Method not implemented.")},i.prototype.showSegmentLine=function(t,e){throw new Error("Method not implemented.")},i}();t.MinemapService=i}(E||(E={})),I=E||(E={}),x=function(){return function(){this.mapDomain="minedata.cn",this.mapVersion="v1.3",this.accessToken="25cc55a69ea7422182d00d6b7c0ffa93",this.units=.03,this.center=[116.46,39.92],this.wkidFromApp=4326,this.is25D=!1,this.minZoom=9,this.maxZoom=17,this.zoom=16,this.logo=!1,this.slider=!0}}(),I.MinemapSetting=x,Object.defineProperty(t,"__esModule",{value:!0}),t.default=E});